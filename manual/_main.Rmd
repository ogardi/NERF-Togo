---
title: "SystÃ¨me Nationale de Surveillance des ForÃªts au Togo"
subtile: "Manuel d'operation"
author: "Oliver Gardi, Fifonsi Dangbo, Sophie Dzigbod, Ditorgue Bakabima"
date: "`r Sys.Date()`"
cover-image: "images/NERF-Togo.png"
github-repo: "ogardi/NERF-Togo"
url: "https://ogardi.github.io/NERF-Togo"
site: bookdown::bookdown_site
documentclass: book
output:
  bookdown::gitbook:
    split_by: "rmd"
    config:
      toc:
        collapse: subsection
        scroll_highlight: yes
        before: <li><a href="https://github.com/ogardi/NERF-Togo"><b>SNSF Togo</b><br>v 1.0 / en dÃ©veloppement</a></li>
        after: <li><a href="https://github.com/rstudio/bookdown">FiÃ¨rement publiÃ© avec bookdown</a></li>
      toolbar:
        position: fixed
      edit : null
      download: null
      search: yes
      fontsettings:
        theme: white
        family: sans
        size: 2
      sharing:
        facebook: no
        github: no
        twitter: no
        linkedin: no
        weibo: no
        instapaper: no
        vk: no
        all: ['facebook', 'twitter', 'linkedin', 'weibo', 'instapaper']
      info: yes
---


# PrÃ©face {-}

![](images/NERF-Togo.png)

Ce manuel d'opÃ©ration Ã  comme objectif de dÃ©crire le fonctionnement du **SystÃ¨me National de Surveillance des ForÃªts au Togo (SNSF)**. Les Ã©lÃ©ments Ã  traiter sont les arrangements instutitionelles, l'implÃ©mentation de l'Inventaires Forestier National (IFN) et de SystÃ¨me Surveillance Terrestres par Satellite (SSTS) et l'approche technique pour en sortir les informations nÃ©cessaires pour le Niveau des emissions de rÃ©fÃ©rence pour les forÃªts du Togo (NERF) ainsi que pour le Monitoring, Reporting et Verification (MRV) dans le cadre de l'engagement du Togo pour le REDD+.

Le manuel NERF/MRV dÃ©crit en dÃ©tail les outils utilisÃ©s pour Ã©tablir et le **Niveau des emissions de rÃ©fÃ©rence pour les forÃªts du Togo** et pour mettre Ã  jour les analyses dans le cadre d'une surveillance de la biomasse forestier dans la cadre du Monitoring, Reporting et Verification pour la REDD+. Il dÃ©crit Ã©galement l'acquistion des donnÃ©es nÃ©cessaires, notamment l'acquisition des images satellitaies, la dÃ©finition des parcelles d'entraÃ®nement de validation dans la cadre du SystÃ¨me de surveillance des terres par satellites (SSTS) et les inventaires forestiers.

Les rÃ©sultats de ces analyses sont publiÃ©s ailleurs (liens sur les rapports sur le site CCNUCC et gÃ©oportail).

Les outils peuvent Ãªtre utilisÃ© pour faire autres projets de classification des changements d'utilisation des terres et cartographie de la biomasse. 

En cas de questions, veuillez contacter la [Coordination nationale REDD+ du Togo](http://www.reddtogo.tg/index.php/contacts)

<!--chapter:end:index.Rmd-->

# SystÃ¨me nationale de surveillance des forÃªts (SNSF)

## Arrangements institutionelles

L'arrangement institutionnel propose pour le systÃ¨me national de suivi des forÃªts se presente comme ci-dessous. 

.	Le MinistÃ¨re de l'Environnement, du Developpement Durable et de la Protection de la Nature (MEDDPN) &agrave travers la direction de l'environnement (DE) est chargee de la soumission des rapports (Communication Nationale et rapports biennaux) a la Convention cadre des nations unies sur le changement climatique

.	La cellule MRV de la Coordination nationale REDD+ situee a l'ODEF est responsable de la coordination de toutes les institutions et organisations impliquees dans l'alimentation du système MRV. Cette cellule est l'entité clé chargé de faciliter et de soutenir les communications sur NRF/NERF du Togo. 

.	Le Groupe de travail (GT) NERF/MRV et l'équipe nationale de suivi des forêts sont chargés du travail et des décisions et choix techniques sur les données, résultats et méthodologie adoptés pour le NRF/MRV. C'est la cheville ouvrière de la cellule MRV. Elles sont constituées des cadres des institutions qui interviennent dans le système national de suivi des forêts (SNSF).

.	La Direction de l'Environnement (DE) se charge des inventaires de gaz à effet de serre (I-GES) de tous les secteurs mais assure la cohérence des données d'I-GES du secteur Agriculture, foresterie et autres affectations des terres (AFAT) avec les rapports qui seront soumis à la CCNUCC. La DE se chargera d'assurer la cohérence entre la méthodologie utilisée dans le cadre du NRF avec les données d'I-GES du secteur AFAT.

.	L'Unité de gestion de bases de données cartographiques (UGBDC) de la Direction des études et de la planification (DEP), chargée de la gestion de la cartographie des domaines forestiers du Togo ainsi que la Division cartographie et Télédétection (DCT) de l'Officie de développement et d'exploitation des forêts (ODEF) chargée de la cartographie des forêts classées et plantations étatique se chargeront de produire les données d'activités à travers le système de suivi des terres par satellite (SSTS).

.	La Ccellule de gestion de la base des données des ressources forestières et des résultats de l'inventaire forestier national (CBDR-IFN) de la Direction des ressources forestières (DRF) et la Division cartographie et télédétection (DCT) de l'ODEF sont chargé de produire les facteurs d'émission à travers les inventaires forestier nationaux et les inventaires des plantations.

.	L'Agence nationale de gestion de l'environnement (ANGE) est chargée de fournir les données sur les feux de végétation, 

.	la Direction générale de l'énergie du ministère des mines et énergie DGE/MME se chargera de fournir les données sur la consommation en bois énergie, 

.	la Direction de la Statistique agricole de l'Informatique et de la Documentation (DCID) et l'Institut Togolais de Recherche Agronomique (ITRA) produiront des données sur l'agriculture (superficie emblavées et le cheptel), 

.	les données de recherche des universités du Togo alimenteront le mécanisme MRV ainsi que le NRF 

.	L'Institut national de la statistique et des études économiques et démographiques (INSEED) donnera des compléments d'informations sur la démographie et autres. 
L'assurance qualité et le contrôle qualité se fera à travers l'évaluation indépendante interne du Laboratoire de biologie et écologie végétale (LBEV) et le Laboratoire de recherche forestière (LRF) de l'université de Lomé (LBEV/UL) ainsi que la Direction générale de la cartographie (DGC). Les laboratoires universitaires LRF et LBEV évalueront les méthodes et nouveaux données au fur et à mesure qu'ils seront générés.


## Inventaire forestier national (IFN)

Le premier inventaire forestier national a ete realise la GIZ. Le deuxiÃ¨me inventaire sera realise par la direction de l'environnment du MininstÃ¨re de l'environnment, du developpement durable et de la protection de la nature. 

## SystÃ¨me de surveillance terrestre par satellite (SSTS)








<!--chapter:end:2-1_arrangements.Rmd-->

# Analyses NERF / MRV

## Organisation du travail 

### Logiciel et serveur

La cartographie des surfaces forestier et de la biomasse aÃ©rienne des arbres se fait avec le logiciel [R](https://www.r-project.org), dirigÃ© Ã  travers [RStudio](https://rstudio.com). Les scripts R sont mis Ã  disposition dans un [dÃ©pot GitHub](https://github.com/ogardi/NERF-Togo). Les scripts dÃ©pendent des outils GDAL disponible dans l'environnement, Ã  installer pour les systÃ¨mes Linux avec `apt-get install python-gdal`. 

Le traitement et l'analyse des images satellitaires demande des ressources intensives en terme de stockage de donnÃ©es (plusieurs TB) et capacitÃ© de calcul (plusieurs processeurs en parallÃ¨le). Pour le moment les analyses pour le Niveau des emissions de rÃ©fÃ©rence pour les forÃªts du Togo (NERF-Togo) sont Ã©ffÃ©ctuÃ©s sur l'infrastructure informatique centrale de la BFH-HAFL. L'interface R-Studio est disponible Ã  http://r.gro1.bfh.science.

### Structure des fichiers

Le repertoire de base `NERF_Togo` est structurÃ© comme suivant: 

```
NERF_Togo
â”œâ”€â”€ data                                    # DonnÃ©es de base
â”‚   â”œâ”€â”€ GADM                                  # frontiÃ¨res administratives
â”‚   â”œâ”€â”€ IFN                                   # inventaire forestier national
â”‚   â”œâ”€â”€ Landsat                               # images satellitaires
â”‚   â”œâ”€â”€ SRTM                                  # donnÃ©es topographiques
â”‚   â””â”€â”€ Worldclim                             # donnÃ©es climatiques
â””â”€â”€ NERF_v1                                 # RÃ©pÃ©toire projet
    â”œâ”€â”€ input                                 # donnÃ©es spÃ©cifiques du projet
    â”‚   â”œâ”€â”€ 1_images                            # images pre-traitÃ©s                              
    â”‚   â”œâ”€â”€ 2_train-plots                       # donnÃ©es d'entraÃ®nement                       
    â”‚   â””â”€â”€ 3_val-plots                         # donnÃ©es de validation
    â”œâ”€â”€ src                                 # scripts
    â”‚   â”œâ”€â”€ 0_set-up.R                          # initialisation
    â”‚   â”œâ”€â”€ 1_prepare-images.R                  # prÃ©paration des images  
    â”‚   â”œâ”€â”€ AGB                                 # cartographie biomasse
    â”‚   â”‚   â”œâ”€â”€ 2_compile-IFN.R                   # Ã©valuer inventaire
    â”‚   â”‚   â”œâ”€â”€ 3_create-AGB-maps.R               # calibration des cartes
    â”‚   â”‚   â”œâ”€â”€ 4_clean-AGB-maps.R                # nettoyage des cartes
    â”‚   â”‚   â””â”€â”€ 5_analyze-AGB.R                   # analyse des cartes
    â”‚   â””â”€â”€ FCC                                 # cartographie surfaces forestiers
    â”‚       â”œâ”€â”€ 2_create-train-points.R           # crÃ©ation des point d'entraÃ®nement
    â”‚       â”œâ”€â”€ 3_create-fc-maps.R                # calibration des cartes
    â”‚       â”œâ”€â”€ 4_clean-fc-maps.R                 # nettoyage des cartes
    â”‚       â”œâ”€â”€ 5_create-val-points.R             # crÃ©ation des points de validation
    â”‚       â”œâ”€â”€ 6_validate-fc-maps.R              # validation des cartes
    â”‚       â”œâ”€â”€ 7_fc-maps-accuracy.R              # analyse de la prÃ©cision des cartes
    â”‚       â””â”€â”€ 8_analyse-fc-maps.R               # analyse des cartes  
    â”œâ”€â”€ output                                # rÃ©sultats
    â”‚   â”œâ”€â”€ 1_forest-cover                      # cartes surfaces forestiers
    â”‚   â”‚   â”œâ”€â”€ 1_ref-maps                        # cartes rÃ©fÃ©rence
    â”‚   â”‚   â”œâ”€â”€ 2_raw-maps                        # cartes brutes
    â”‚   â”‚   â”œâ”€â”€ 3_clean-maps                      # cartes nettoyÃ©es
    â”‚   â”‚   â”œâ”€â”€ 4_validation                      # rÃ©sultats validation
    â”‚   â”‚   â””â”€â”€ 5_results                         # rÃ©sultats surfaces
    â”‚   â””â”€â”€ 2_biomass                           # cartes biomasse
    â”‚       â”œâ”€â”€ 1_ref-maps                        # cartes de rÃ©fÃ©rence
    â”‚       â””â”€â”€ 5_results                         # rÃ©sultats biomasse
    â”œâ”€â”€ report                                # rapport des rÃ©sultats
    â””â”€â”€ manuel                                # ce manuel
```

C'est seulement les rÃ©pÃ©toires `src` et `manual` qui sont mis Ã  diposition dans le dÃ©pÃ´t [GitHub](https://github.com/ogardi/NERF-Togo). Les autres rÃ©pÃ©toires et donnÃ©es doivent Ãªtre installÃ©s manuellement.

<!--chapter:end:3-1_organisation.Rmd-->


## PrÃ©paration

### DÃ©finition des variables

#### Description {-}

Le traitement des images ce fait par executer les scripts R, un aprÃ¨s l'autre. Tout d'abord on ouvre et execute le script `0_set-up.R` pour charger les librairies et dÃ©finir des variables qu'on utilise Ã©galement dans les autres scripts.

#### _0_set-up.R_ {-}

```{r, code=readLines("../src/0_set-up.R"), eval=FALSE}
```



<!--chapter:end:3-3-1_set-up.Rmd-->


### PrÃ©traitement des images

#### Description {-}

Le premier traitement est la prÃ©paration des nouveaux images. On ouvre le script `1_prepare-images.R` et on ajoute les nouveaux images dans la liste des images:

```{r eval=FALSE, tidy=FALSE}
p192.2019 = list(
  paste0(DATA.DIR, "/Landsat/192_054/2019/LC081920542018122301T1-SC20190405164258/"),
  paste0(DATA.DIR, "/Landsat/192_055/2019/LC081920552018122301T1-SC20190405163359/"),
  paste0(DATA.DIR, "/Landsat/192_056/2019/LC081920562018122301T1-SC20190405163342/"))
...
p193.2019 = list(
  paste0(DATA.DIR, "/Landsat/193_052/2019/LC081930522019021601T1-SC20190405183839/"),
  paste0(DATA.DIR, "/Landsat/193_053/2019/LC081930532019021601T1-SC20190405181518/"),
  paste0(DATA.DIR, "/Landsat/193_054/2019/LC081930542019021601T1-SC20190405183609/"),
  paste0(DATA.DIR, "/Landsat/193_055/2019/LC081930552019021601T1-SC20190405181507/"))
...
p194.2019 = list(
  paste0(DATA.DIR, "/Landsat/194_052/2019/LC081940522019012201T1-SC20190405172019/"),
  paste0(DATA.DIR, "/Landsat/194_053/2019/LC081940532019012201T1-SC20190405172055/"))
```

Le script dÃ©finit une fonction pour stacker, masquer et couper les images Landsat chemin par chemin. Par dÃ©faut, les images qui ont dÃ©jÃ  Ã©tÃ© traitÃ© (`filename` existe dÃ©jÃ ) ne sont plus traitÃ© (`overwrite=FALSE`).

```{r eval=FALSE} 
prepare.image(in.image.dirs, ext=NULL, filename=NULL, overwrite=FALSE, log=TRUE)
```

Ã€ la fin du script `1_prepare-images.R`, oÃ¹ c'est notÃ© `# DO THE WORK ---------`, on commence avec le traitement des images. Les images prÃ©traitÃ©s sont sauveguarder dans le rÃ©pÃ©toire `input/1_images` du projet, ensemble avec des Thumbnails des chemins. Dans une prochaÃ®ne Ã©tape, les images sont nÃ©ttoyÃ©es de l'eau, nuages et ombres en utilisant les bandes Landsat de qualitÃ© des pixels. Finalement Ã©galement les donnÃ©es topographiques (SRTM) et climatiques (Worldclim v2) sont prÃ©parÃ©s.

#### Example {-}

![Chemin 193 de l'annÃ©e 2019 (composÃ© de 4 scÃ¨nes Landsat du 16 FÃ©vrier 2019)](images/p193_2019.jpeg)

#### _1_prepare-images.R_ {-}

```{r, code=readLines("../src/1_prepare-images.R"), eval=FALSE}
```


<!--chapter:end:3-3-2_prepare-images.Rmd-->


## Cartographie des surfaces forestiers

Description gÃ©nÃ©rale de l'approche / mÃ©thodologies



<!--chapter:end:3-4-1_FCC.Rmd-->


### Parcelles d'entraÃ®nement

#### Description {-}

Description de la mÃ©thodologie / script

#### _FCC/2_create-train-points.R_ {-}

```{r, code=readLines("../src/FCC/2_create-train-points.R"), eval=FALSE}
```



<!--chapter:end:3-4-2_create-train-points.Rmd-->


# Introduction

Blah, blah, blah

<!--chapter:end:01_introduction/00_introduction.Rmd-->


## Arrangements institutionelles

Blah, blah


<!--chapter:end:01_introduction/01_arrangements.Rmd-->


# SystÃ¨me de Surveillance Terrestre

Blah, blah, blah

<!--chapter:end:02_STSS/00_STSS.Rmd-->


# Inventaire Forestier National

Blah, blah, blah

<!--chapter:end:03_IFN/00_IFN.Rmd-->


# Analyses NERF/MRV

Le Togo a soumis son premier **Niveau d'Ã©missions de rÃ©fÃ©rence pour les forÃªts (NERF 1.0)** en Janvier 2020 ([*Lien sur le site CCNUCC*](TODO)). Il est basÃ© sur l'Ã©volution de la couverture forestier entre 2003 -- 2018 (pertes et gains des forÃªts Ã  une couverture du houppier â‰¥ 30%) et le stockage de carbone dans la biomasse aÃ©rienne des arbres (incl. bois mort sur pied)

Les donnÃ©es de base qu'on a utilisÃ© pour effectuer ce travail sont: 

- **les images Landsat de l'archive USGS (1985 -- 2019)** et les **donnÃ©es climatiques Worldclim v2** pour la la cartographie de l'Ã©volution des surfaces forestiers et la cartographie de la biomasse
- **les donnÃ©es du SSTS (Ã©tat 2019)** sur la couverture du houppier et l'utilisation des terres pour la calibration et la validation des cartes sur l'Ã©volution des surfaces forestier
- **les donnÃ©es dendromÃ©triques du IFN-1 (2015/16)** pour dÃ©terminer le stockage de carbone dans la biomasse aÃ©rienne par parcelle et la calibration des cartes de la biomasse

Ce chapitre dÃ©crit **l'approche mÃ©thodologique et les outils techniques** utilisÃ©s pour Ã©tablir ce NERF. C'est un travail en cours. Le mÃªme approche sera utilisÃ©s a) pour amÃ©liorer le NERF avec des nouvelles donnÃ©es et/ou mÃ¨thodes et b) pour mettre Ã  jour rÃ©guliÃ¨rement les analyses dans le cadre du Monitoring, reporting et vÃ©rification (MRV). 

Chaque section commence par une description de la mÃ©thodologie utilisÃ©e et des rÃ©fÃ©rences aux points clÃ©s dans le script R correspondant, suivie par une prÃ©sentation exemplaire des rÃ©sultats de cette Ã©tappe et enfin du code R commentÃ©.

- **Section \@ref(NERF-organisation)** dÃ©crit les logiciels et les infrastructures utilisÃ©s ainsi que la structure de donnÃ©es sur laquelle les analyses sont basÃ©es.
- **Section \@ref(NERF-preparation)** couvre les diffÃ©rentes Ã©tapes de la prÃ©paration des donnÃ©es, en particulier la crÃ©ation d'un nouveau projet basÃ© sur un projet existant, l'acquisition de nouvelles images satellites et leur prÃ©paration pour les analyses.
- **Section \@ref(NERF-analyse-FCC)** dÃ©crit les diffÃ©rentes Ã©tapes nÃ©cessaires pour la cartographie des surfaces forestiÃ¨res et leur Ã©volution, de la sÃ©lÃ©ction des parcelles d'entraÃ®nements Ã  la classification des sÃ©ries de cartes, leur nÃ©ttoyage et validation.
- **Section \@ref(NERF-analyse-AGB)** dÃ©crit les diffÃ©rentes Ã©tapes nÃ©cessaires pour la cartographie des la biomasse aÃ©rienne, de l'Ã©valuation des donnÃ©es de l'IFN, Ã  la calibration des cartes de biomasse leur nÃ©ttoyage et l'analyse de l'Ã©volution de la biomasse dans le temps.

<!--chapter:end:04_NERF-MRV/00_NERF-MRV.Rmd-->


## Organisation du travail {#NERF-organisation}

### Logiciel et serveur

La cartographie des surfaces forestier et de la biomasse aÃ©rienne des arbres se fait avec le logiciel [R](https://www.r-project.org), dirigÃ© Ã  travers [RStudio](https://rstudio.com). Les scripts R sont mis Ã  disposition dans un [dÃ©pot GitHub](https://github.com/ogardi/NERF-Togo). Les scripts dÃ©pendent des fois des outils GDAL disponible dans l'environnement, Ã  installer pour les systÃ¨mes Linux avec `apt-get install python-gdal`.

Le traitement et l'analyse des images satellitaires demande des ressources intensives en terme de stockage de donnÃ©es (plusieurs TB) et capacitÃ© de calcul (plusieurs processeurs en parallÃ¨le). Les analyses pour le Niveau des emissions de rÃ©fÃ©rence pour les forÃªts du Togo (NERF 1.0) ont Ã©tÃ© Ã©ffÃ©ctuÃ©s sur l'infrastructure informatique centrale de la BFH-HAFL (http://r.gro1.bfh.science, accÃ¨s limitÃ©). Une fois la nouvelle infrastructure informatique puissante avec un serveur central au MinistÃ¨re pour l'Environnement et ForÃªts (MERF) est  installÃ© et disponible, les travaux peuvent Ãªtre Ã©ffectuÃ©s lÃ . 

### Structure du rÃ©petoire

Les outils R dÃ©pendent d'une certaine structure des fichiers. Le repertoire de base `NERF_Togo` est structurÃ© comme suivant: 

```
NERF_Togo

â”œâ”€â”€ data                                    # DonnÃ©es de base ########################
    â”œâ”€â”€ GADM                                  # frontiÃ¨res administratives
    â”œâ”€â”€ IFN                                   # inventaire forestier national
    â”œâ”€â”€ Landsat                               # images satellitaires
    â”œâ”€â”€ SRTM                                  # donnÃ©es topographiques
    â””â”€â”€ Worldclim                             # donnÃ©es climatiques
    
â””â”€â”€ NERF_v1.0                               # RÃ©pÃ©toire projet NERF v1.0 #############
    â”œâ”€â”€ input                                 # donnÃ©es spÃ©cifiques du projet
        â”œâ”€â”€ 1_images                            # images pre-traitÃ©s                              
        â”œâ”€â”€ 2_train-plots                       # donnÃ©es d'entraÃ®nement                       
        â””â”€â”€ 3_val-plots                         # donnÃ©es de validation
    â”œâ”€â”€ src                                   # scripts R ----------------------------
        â”œâ”€â”€ 0_set-up.R                          # initialisation
        â”œâ”€â”€ 1_prepare-images.R                  # prÃ©paration des images  
        â”œâ”€â”€ AGB                                 # cartographie biomasse
            â”œâ”€â”€ 2_compile-IFN.R                   # Ã©valuer inventaire
            â”œâ”€â”€ 3_create-AGB-maps.R               # calibration des cartes
            â”œâ”€â”€ 4_clean-AGB-maps.R                # nettoyage des cartes
            â””â”€â”€ 5_analyze-AGB.R                   # analyse des cartes
        â””â”€â”€ FCC                                 # cartographie surfaces forestiers
            â”œâ”€â”€ 2_create-train-points.R           # crÃ©ation des point d'entraÃ®nement
            â”œâ”€â”€ 3_create-fc-maps.R                # calibration des cartes
            â”œâ”€â”€ 4_clean-fc-maps.R                 # nettoyage des cartes
            â”œâ”€â”€ 5_create-val-points.R             # crÃ©ation des points de validation
            â”œâ”€â”€ 6_validate-fc-maps.R              # validation des cartes
            â”œâ”€â”€ 7_fc-maps-accuracy.R              # analyse de la prÃ©cision des cartes
            â””â”€â”€ 8_analyse-fc-maps.R               # analyse des cartes  
    â”œâ”€â”€ output                                # rÃ©sultats / cartes -------------------
        â”œâ”€â”€ 1_forest-cover                      # cartes surfaces forestiers
            â”œâ”€â”€ 1_ref-maps                        # cartes rÃ©fÃ©rence
            â”œâ”€â”€ 2_raw-maps                        # cartes brutes
            â”œâ”€â”€ 3_clean-maps                      # cartes nettoyÃ©es
            â”œâ”€â”€ 4_validation                      # rÃ©sultats validation
            â””â”€â”€ 5_results                         # rÃ©sultats surfaces
        â””â”€â”€ 2_biomass                           # cartes biomasse
            â”œâ”€â”€ 1_ref-maps                        # cartes de rÃ©fÃ©rence
            â””â”€â”€ 5_results                         # rÃ©sultats biomasse
    â”œâ”€â”€ report                                # rapport des rÃ©sultats ----------------
    â””â”€â”€ manuel                                # cette documentation ------------------
    
â””â”€â”€ NERF_v1.x                               # Un autre rÃ©pÃ©toire projet #########
```

La structure du rÃ©pertoire est dÃ©finit dans le script [0_set-up.R](#NERF-set-up.R) et peut Ãªtre ajoustÃ©.

C'est seulement les rÃ©pÃ©toires `src` et `manual` qui sont mis Ã  diposition dans le dÃ©pÃ´t [GitHub](https://github.com/ogardi/NERF-Togo). Les autres rÃ©pÃ©toires et donnÃ©es doivent Ãªtre installÃ©s manuellement.

<!--chapter:end:04_NERF-MRV/01-organisation.Rmd-->


## PrÃ©paration des donnÃ©es {#NERF-preparation}

Blah, blah, blah ...

<!--chapter:end:04_NERF-MRV/02_preparation/00_preparation.Rmd-->


### CrÃ©ation d'un nouveau projet

Pour la crÃ©ation d'un nouveau projet, le plus simple est de copier un projet existant, normalement le projet sur lequel on aimeriait continuer le travail. On peut faire Ã§a Ã  travers RStudio, SFTP ou directement sur le server par exemple `cp -r 2019_NERF_v1 2020_MNV_v0`. AprÃ¨s on efface les rÃ©sultat de l'ancien projet `rm -r 2020_MNV_v0/output/*`. Les rapports on peut laisser, mais il faut les rÃ©diger Ã  la fin.  

### Acquisition des images

Ouvrir le site [USGS Earthexplorer](https://earthexplorer.usgs.gov). Dans la fenÃªtre `Search Criteria` il faut selectionner la pÃ©riode pour laquelle on cherche des images (Nov - Jan). Dans la fenÃªtre `Data Sets`, il faut sÃ©lectionner les produits Landsat Level-2 (Surface Reflectance). Dans la fenÃªtre `Additional Criteria` il faut choisir les scÃ¨nes (chemin 192: 054-056 /  chemin 193: 052-055 / chemin 194: 052-053).

![](images/Acq-EE.png)

On prend le date sur les images de tout le chemin sont de meilleure qualitÃ©. On copie les identifier des images Ã  tÃ©lÃ©charger dans un fichier text.

Ensuite on ouvre le site [USGS ESPA](https://espa.cr.usgs.gov/ordering/new/) pour commander les scÃ¨nes.  On charge le fichier text avec les scÃ¨nes et on commande les bandes surface reflectances et les indices. Pour commander des images, il faut qu'on a un compte USGS.

![](images/Acq-ESPA.png)

Une fois on est notifiÃ© par eMail que les images sont prÃªts, on les tÃ©lÃ©chargent manuellement ou tous ensemble avec le [USGS bulkdownloader](https://github.com/USGS-EROS/espa-bulk-downloader) et la commande `download_espa_order.py -u oliver.gardi@gmail.com -o ALL -d NERF_Togo/data/Landsat`. On dÃ©zip les images et les rangent dans le rÃ©pÃ©toire `data/Landsat` sous la scÃ¨ne et l'annÃ©e correspondante. Pour des images de l'hiver 2019/20, l'annÃ©e correspondante est 2020.

<!--chapter:end:04_NERF-MRV/02_preparation/01_nouveau-projet.Rmd-->


### DÃ©finition des variables {#NERF-set-up.R}

#### Description {-}

Le traitement des images ce fait par executer les scripts R, un aprÃ¨s l'autre. Tout d'abord on ouvre et execute le script `0_set-up.R` pour charger les librairies et dÃ©finir des variables qu'on utilise Ã©galement dans les autres scripts. On peut Ã©galement Ã©xÃ©cuter l'ensemble du script par la commande R `source(0_set-up.R)`.

Les noms des variables dÃ©finies dans le script `0_set-up.R` sont Ã©crits en majuscules. Ils sont stockÃ©s dans l'environnement R et sont disponibles pour tous les autres scripts aprÃ¨s l'exÃ©cution du script.

Avant l'exÃ©cution du script, les variables sont ajustÃ©es si nÃ©cessaire, notamment les informations sur la pÃ©riode analysÃ©e `PERIOD` et les annÃ©es Ã  prendre en compte pour les diffÃ©rentes Ã©valuations `JNT.YEARS`, `VAL.YEARS` et `REF.YEARS`.

#### *0_set-up.R* {-}

```{r, code=readLines("../src/0_set-up.R"), eval=FALSE}
```


<!--chapter:end:04_NERF-MRV/02_preparation/02_set-up.Rmd-->


### PrÃ©traitement des images

#### Description {-}

Le premier traitement est la prÃ©paration des images Landsat et autres variables utilisÃ©s pour modÃ©liser la surface forestier ou la biomasse aÃ©rienne comme les donnÃ©es topographique et climatiques. L'objectif est qu'on prÃ©pare avec les donnÃ©es brutes un jeu de donnÃ©es raster complet sur le mÃªme extent (territoir du Togo) et avec la mÃªme rÃ©solution spatiale de 30 mÃ¨tres (rÃ©solution de base des images Landsat).

On ouvre le script `1_prepare-images.R` et on modifie la liste des images Landsat Ã  utiliser (`in.image.list`), par exemple par ajouter les nouveaux image Ã  considÃ©rer dans les analyses:

```{r eval=FALSE, tidy=FALSE}
p192.2019 = list(
  paste0(DATA.DIR, "/Landsat/192_054/2019/LC081920542018122301T1-SC20190405164258/"),
  paste0(DATA.DIR, "/Landsat/192_055/2019/LC081920552018122301T1-SC20190405163359/"),
  paste0(DATA.DIR, "/Landsat/192_056/2019/LC081920562018122301T1-SC20190405163342/"))
...
p193.2019 = list(
  paste0(DATA.DIR, "/Landsat/193_052/2019/LC081930522019021601T1-SC20190405183839/"),
  paste0(DATA.DIR, "/Landsat/193_053/2019/LC081930532019021601T1-SC20190405181518/"),
  paste0(DATA.DIR, "/Landsat/193_054/2019/LC081930542019021601T1-SC20190405183609/"),
  paste0(DATA.DIR, "/Landsat/193_055/2019/LC081930552019021601T1-SC20190405181507/"))
...
p194.2019 = list(
  paste0(DATA.DIR, "/Landsat/194_052/2019/LC081940522019012201T1-SC20190405172019/"),
  paste0(DATA.DIR, "/Landsat/194_053/2019/LC081940532019012201T1-SC20190405172055/"))
```

Outre la dÃ©finition des images Ã  traiter, le script dÃ©finit une fonction `prepare.image` pour stacker les diffÃ©rentes bandes des images Landsat, pour les fusioner, masquer et couper les images Landsat chemin par chemin  (WRS2 paths 192, 193 et 194 pour Togo). Par dÃ©faut, les images qui ont dÃ©jÃ  Ã©tÃ© traitÃ© (`filename` existe dÃ©jÃ ) ne sont plus traitÃ© (`overwrite=FALSE`).

```{r eval=FALSE} 
prepare.image(in.image.dirs, ext=NULL, filename=NULL, overwrite=FALSE, log=TRUE)
```

Dans la deuxiÃ¨me partie du script, lÃ  oÃ¹ c'est notÃ© `# DO THE WORK ---------`, on lance le traitement des images. Avec le code `foreach(...) %dopar% { ... }` on lance le traitement de chaque chemin pour chaque annÃ©e sur des diffÃ©rents processeurs au parallÃ¨le. Ã€ la fin du script on 

- transforme les images du chemin 194 du systÃ¨me de coordonnÃ©es UTM 30 vers UTM 31
- prÃ©pare les donnÃ©es topographiques SRTM et les donnÃ©es climatiques Worldclim v2
- produit des thumbnails des images Landsat et Worldclim v2 en format JPEG (voir example au-dessous)


Les images prÃ©traitÃ©s sont sauveguarder dans le rÃ©pÃ©toire `input/1_images` du projet, ensemble avec des Thumbnails des chemins. Dans une prochaÃ®ne Ã©tape, les images sont nÃ©ttoyÃ©es de l'eau, nuages et ombres en utilisant les bandes Landsat de qualitÃ© des pixels. Finalement Ã©galement les donnÃ©es topographiques (SRTM) et climatiques (Worldclim v2) sont prÃ©parÃ©s.

#### Example {-}

```{r, echo=FALSE, out.width="33%"}
knitr::include_graphics(c("images/p194_2019.jpeg","images/p193_2019.jpeg", "images/p192_2019.jpeg"))
``` 
**Images Landsat de l'annÃ©e 2019:** chemin p194 composÃ© de 2 scÃ©nes du 22.01.2019 / p193 avec 4 scÃ¨nes du 16.02.2019 / p192 avec 3 scÃ¨nes du 23.12.2018

```{r, echo=FALSE, out.width="25%", fig.show='hold', fig.align='default'}
knitr::include_graphics(c("images/wc2.0_30s_bio_Togo-01.jpeg","images/wc2.0_30s_bio_Togo-04.jpeg", "images/wc2.0_30s_bio_Togo-12.jpeg", "images/wc2.0_30s_bio_Togo-15.jpeg"))
``` 
**DonnÃ©es bioclimatiques Worldclim v2:** tempÃ©rature annuelle  moyenne (BIO1) / saisonalitÃ© de la tempÃ©rature (BIO4) / prÃ©cipitation annuelle (BIO12) / saisonalitÃ© de la prÃ©cipitation (BIO15)

#### _1_prepare-images.R_ {-}

```{r, code=readLines("../src/1_prepare-images.R"), eval=FALSE}
```


<!--chapter:end:04_NERF-MRV/02_preparation/03_prepare-images.Rmd-->


## Analyse surfaces forestiers {#NERF-analyse-FCC}

L'analyse des surfaces forestiers est fait par une **classification supervisÃ©e**. Les donnÃ©es du SSTS sur la couverture des houppier est utilisÃ© pour calibrer un modÃ¨le de classification Random Forest sur base des images satellitaires Landsat et les donnÃ©es climatiques Worldclim v2. Tous les parcelles d'entraÃ®nement avec une **couverture des houppiers â‰¥ 30%** sont considÃ©rÃ©es comme forÃªt, les autres comme non-forÃªts. 

Le schÃ©ma suivant montre les Ã©tapes pour la production des cartes forÃªt/non-forÃªt sur toute la pÃ©riode 1986 -- 2019:

![](images/FCC-Schema.png)

Vue que les donnÃ©es sur la couverture des houppier et seulement disponible pour les annÃ©es rÃ©centes (Ã  cause d'une disponibilitÃ© limitÃ© des images de trÃ¨s haute rÃ©solution), c'est seulement la carte forÃªt/non-forÃªt 2018 qui a Ã©tÃ© produit sur base des parcelles d'entraÃ®nement du SSTS. Cette **carte de rÃ©fÃ©rence 2018 est utilisÃ© comme base pour la calibration des modÃ¨les de classification pour les autres dates** pour lesquelles des images Landsat sont disponible.

Tout d'abord la carte de rÃ©fÃ©rence 2018 est utilisÃ© pour calibrer la classification d'une carte forÃªt/non-forÃªt en 2003. C'est cette **carte de rÃ©fÃ©rence 2003 qu'on a utilisÃ© pour calibrer les autres cartes de 1986 -- 2018**. On a choisi de faire la classification de toute la serie des images sur la carte de rÃ©fÃ©rence 2003, parce que les images Landsat 2003 sont de trÃ¨s bonne qualitÃ© (et donc la carte est probablement aussi de bonne qualitÃ©) et parce que l'annÃ©e 2003 se trouve au milieu de la pÃ©riode analysÃ©e. Si on prend directement la carte forÃªt/non-forÃªt 2018 comme rÃ©fÃ©rence pour la calibration de la sÃ©rie 1986 -- 2018, on observe une gÃ©nÃ©ralisation de la surface forestier le plus on s'Ã©loigne de la date 2018, donc un changement de la surface forestier qui est plutÃ´t un artefact de la mÃ©thode que une changement d'occupation des terres.








<!--chapter:end:04_NERF-MRV/03_analyse-FCC/00_analyse-FCC.Rmd-->


### Parcelles d'entraÃ®nement

#### Description {-}

Description de la mÃ©thodologie / script

#### _FCC/2_create-train-points.R_ {-}

```{r, code=readLines("../src/FCC/2_create-train-points.R"), eval=FALSE}
```



<!--chapter:end:04_NERF-MRV/03_analyse-FCC/01_create-train-points.Rmd-->


### Calibration et classification

#### Description {-}

Description de la mÃ©thodologie / script

#### _FCC/3_create-fc-maps.R_ {-}

```{r, code=readLines("../src/FCC/3_create-fc-maps.R"), eval=FALSE}
```



<!--chapter:end:04_NERF-MRV/03_analyse-FCC/02_create-fc-maps.Rmd-->


### Nettoyage des cartes brutes

#### Description {-}

Description de la mÃ©thodologie / script

#### _FCC/4_clean-fc-maps.R_ {-}

```{r, code=readLines("../src/FCC/4_clean-fc-maps.R"), eval=FALSE}
```



<!--chapter:end:04_NERF-MRV/03_analyse-FCC/03_clean-fc-maps.Rmd-->


### Parcelles de validation

#### Description {-}

Description de la mÃ©thodologie / script

#### _FCC/5_create-val-points.R_ {-}

```{r, code=readLines("../src/FCC/5_create-val-points.R"), eval=FALSE}
```



<!--chapter:end:04_NERF-MRV/03_analyse-FCC/04_create-val-points.Rmd-->


### Validation des cartes

#### Description {-}

Description de la mÃ©thodologie / script

#### _FCC/6_validate-fc-maps.R_ {-}

```{r, code=readLines("../src/FCC/6_validate-fc-maps.R"), eval=FALSE}
```



<!--chapter:end:04_NERF-MRV/03_analyse-FCC/05_validate-fc-maps.Rmd-->


### Analyse de la prÃ©cision

#### Description {-}

Description de la mÃ©thodologie / script

#### _FCC/7_fc-maps-accuracy.R_ {-}

```{r, code=readLines("../src/FCC/7_fc-maps-accuracy.R"), eval=FALSE}
```



<!--chapter:end:04_NERF-MRV/03_analyse-FCC/06_fc-maps-accuracy.Rmd-->


### Production des rÃ©sultats

#### Description {-}

Description de la mÃ©thodologie / script

#### _FCC/8_analyse-fc-maps.R_ {-}

```{r, code=readLines("../src/FCC/8_analyse-fc-maps.R"), eval=FALSE}
```



<!--chapter:end:04_NERF-MRV/03_analyse-FCC/07_analyse-fc-maps.Rmd-->


## Analyse biomasse aÃ©rienne {#NERF-analyse-AGB}

![](images/AGB-Schema.png)



<!--chapter:end:04_NERF-MRV/04_analyse-AGB/00_analyse-AGB.Rmd-->


### Analyse des donnÃ©es IFN

#### Description {-}

Description de la mÃ©thodologie / script

#### _AGB/2_compile-IFN.R_ {-}

```{r, code=readLines("../src/AGB/2_compile-IFN.R"), eval=FALSE}
```



<!--chapter:end:04_NERF-MRV/04_analyse-AGB/01_compile-IFN.Rmd-->


### Calibration et prÃ©diction

#### Description {-}

Description de la mÃ©thodologie / script

#### _AGB/3_create-AGB-maps.R_ {-}

```{r, code=readLines("../src/AGB/3_create-AGB-maps.R"), eval=FALSE}
```



<!--chapter:end:04_NERF-MRV/04_analyse-AGB/02_create-AGB-maps.Rmd-->


### Nettoyage des cartes brutes

#### Description {-}

Description de la mÃ©thodologie / script

#### _AGB/4_clean-AGB-maps.R_ {-}

```{r, code=readLines("../src/AGB/4_clean-AGB-maps.R"), eval=FALSE}
```



<!--chapter:end:04_NERF-MRV/04_analyse-AGB/03_clean-AGB-maps.Rmd-->


### Production des rÃ©sultats

#### Description {-}

Description de la mÃ©thodologie / script

#### _AGB/5_analyze-AGB.R_ {-}

```{r, code=readLines("../src/AGB/5_analyze-AGB.R"), eval=FALSE}
```



<!--chapter:end:04_NERF-MRV/04_analyse-AGB/04_analyze-AGB.Rmd-->

