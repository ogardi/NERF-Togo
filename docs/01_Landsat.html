<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2.1 Données de base | SNSF-Togo_Manuel.utf8</title>
  <meta name="description" content="République Togolaise —<br />
Système Nationale de Surveillance des Forêts</div>" />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="2.1 Données de base | SNSF-Togo_Manuel.utf8" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://ogardi.github.io/SNSF-Togo" />
  <meta property="og:image" content="https://ogardi.github.io/SNSF-Togoimages/NERF-Togo.png" />
  
  <meta name="github-repo" content="ogardi/NERF-Togo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2.1 Données de base | SNSF-Togo_Manuel.utf8" />
  
  
  <meta name="twitter:image" content="https://ogardi.github.io/SNSF-Togoimages/NERF-Togo.png" />

<meta name="author" content="Oliver Gardi, Fifonsi Dangbo, Sophie Dzigbod, Ditorgue Bakabima" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="00_STSS.html"/>
<link rel="next" href="02_Worldclim.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/kePrint-0.0.1/kePrint.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { background-color: #f8f8f8; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://ogardi.github.io/SNSF-Togo"><b>Manuel SNSF Togo</b><br>NRF v1.1 ( <i>en révision</i> )</a></li>
<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Préface</a></li>
<li class="chapter" data-level="1" data-path="00_introduction.html"><a href="00_introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="01_arrangements.html"><a href="01_arrangements.html"><i class="fa fa-check"></i><b>1.1</b> Arrangements institutionelles</a></li>
<li class="chapter" data-level="1.2" data-path="02_how-to.html"><a href="02_how-to.html"><i class="fa fa-check"></i><b>1.2</b> Pour commencer</a><ul>
<li class="chapter" data-level="1.2.1" data-path="02_how-to.html"><a href="02_how-to.html#travailler-avec-le-snsf"><i class="fa fa-check"></i><b>1.2.1</b> Travailler avec le SNSF</a></li>
<li class="chapter" data-level="1.2.2" data-path="03_commencer.html"><a href="03_commencer.html"><i class="fa fa-check"></i><b>1.2.2</b> Structure du répértoire</a></li>
<li class="chapter" data-level="1.2.3" data-path="03_commencer.html"><a href="03_commencer.html#creation-dun-nouveau-projet"><i class="fa fa-check"></i><b>1.2.3</b> Création d’un nouveau projet</a></li>
<li class="chapter" data-level="1.2.4" data-path="03_commencer.html"><a href="03_commencer.html#NRF-set-up.R"><i class="fa fa-check"></i><b>1.2.4</b> Définition des variables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="00_STSS.html"><a href="00_STSS.html"><i class="fa fa-check"></i><b>2</b> Système de Surveillance Terrestre</a><ul>
<li class="chapter" data-level="2.1" data-path="01_Landsat.html"><a href="01_Landsat.html"><i class="fa fa-check"></i><b>2.1</b> Données de base</a><ul>
<li class="chapter" data-level="2.1.1" data-path="01_Landsat.html"><a href="01_Landsat.html#SSTS-Landsat"><i class="fa fa-check"></i><b>2.1.1</b> Images Landsat</a></li>
<li class="chapter" data-level="2.1.2" data-path="02_Worldclim.html"><a href="02_Worldclim.html"><i class="fa fa-check"></i><b>2.1.2</b> WorldClim</a></li>
<li class="chapter" data-level="2.1.3" data-path="03_SRTM.html"><a href="03_SRTM.html"><i class="fa fa-check"></i><b>2.1.3</b> SRTM</a></li>
<li class="chapter" data-level="2.1.4" data-path="04_SoilGrids.html"><a href="04_SoilGrids.html"><i class="fa fa-check"></i><b>2.1.4</b> SoilGrids</a></li>
<li class="chapter" data-level="2.1.5" data-path="05_ProREDD.html"><a href="05_ProREDD.html"><i class="fa fa-check"></i><b>2.1.5</b> ProREDD</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="01_sampling-grid.html"><a href="01_sampling-grid.html"><i class="fa fa-check"></i><b>2.2</b> Collecte des données</a><ul>
<li class="chapter" data-level="2.2.1" data-path="01_sampling-grid.html"><a href="01_sampling-grid.html#reseau-dechantillonnage"><i class="fa fa-check"></i><b>2.2.1</b> Réseau d’échantillonnage</a></li>
<li class="chapter" data-level="2.2.2" data-path="02_training-plots.html"><a href="02_training-plots.html"><i class="fa fa-check"></i><b>2.2.2</b> Parcelles d’entraînement</a></li>
<li class="chapter" data-level="2.2.3" data-path="03_validation-plots.html"><a href="03_validation-plots.html"><i class="fa fa-check"></i><b>2.2.3</b> Parcelles de validation</a></li>
<li class="chapter" data-level="2.2.4" data-path="04_outil-QGIS.html"><a href="04_outil-QGIS.html"><i class="fa fa-check"></i><b>2.2.4</b> Outil QGIS</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="00_IFN.html"><a href="00_IFN.html"><i class="fa fa-check"></i><b>3</b> Inventaire Forestier National</a><ul>
<li class="chapter" data-level="3.1" data-path="01_IFN-1.html"><a href="01_IFN-1.html"><i class="fa fa-check"></i><b>3.1</b> IFN-1 (2015/16)</a><ul>
<li class="chapter" data-level="3.1.1" data-path="01_IFN-1.html"><a href="01_IFN-1.html#methode"><i class="fa fa-check"></i><b>3.1.1</b> <span>Méthode</span></a></li>
<li class="chapter" data-level="3.1.2" data-path="01_IFN-1.html"><a href="01_IFN-1.html#donnees"><i class="fa fa-check"></i><b>3.1.2</b> Données</a></li>
<li class="chapter" data-level="3.1.3" data-path="01_IFN-1.html"><a href="01_IFN-1.html#resultats"><i class="fa fa-check"></i><b>3.1.3</b> <span>Résultats</span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="00_NRF-MRV.html"><a href="00_NRF-MRV.html"><i class="fa fa-check"></i><b>4</b> Analyses NRF/MRV</a><ul>
<li class="chapter" data-level="4.1" data-path="00_analyse-FCC.html"><a href="00_analyse-FCC.html"><i class="fa fa-check"></i><b>4.1</b> Analyse surfaces forestiers</a><ul>
<li class="chapter" data-level="4.1.1" data-path="01_create-FC-maps.html"><a href="01_create-FC-maps.html"><i class="fa fa-check"></i><b>4.1.1</b> Production des cartes Forêt/Non-Forêt</a></li>
<li class="chapter" data-level="4.1.2" data-path="02_clean-FC-maps.html"><a href="02_clean-FC-maps.html"><i class="fa fa-check"></i><b>4.1.2</b> Nettoyage des cartes brutes</a></li>
<li class="chapter" data-level="4.1.3" data-path="03_validate-FC-maps.html"><a href="03_validate-FC-maps.html"><i class="fa fa-check"></i><b>4.1.3</b> Validation des cartes</a></li>
<li class="chapter" data-level="4.1.4" data-path="04_FC-maps-accuracy.html"><a href="04_FC-maps-accuracy.html"><i class="fa fa-check"></i><b>4.1.4</b> Analyse de la précision</a></li>
<li class="chapter" data-level="4.1.5" data-path="05_analyse-FC-maps.html"><a href="05_analyse-FC-maps.html"><i class="fa fa-check"></i><b>4.1.5</b> Analyse des cartes</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="00_analyse-AGB.html"><a href="00_analyse-AGB.html"><i class="fa fa-check"></i><b>4.2</b> Analyse biomasse aérienne</a><ul>
<li class="chapter" data-level="4.2.1" data-path="01_compile-IFN.html"><a href="01_compile-IFN.html"><i class="fa fa-check"></i><b>4.2.1</b> Analyse des données IFN</a></li>
<li class="chapter" data-level="4.2.2" data-path="02_create-AGB-maps.html"><a href="02_create-AGB-maps.html"><i class="fa fa-check"></i><b>4.2.2</b> Calibration et prédiction</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="00_analyse-ER.html"><a href="00_analyse-ER.html"><i class="fa fa-check"></i><b>4.3</b> Analyse émissions/séquestrations</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/ogardi/SNSF-Togo">Dépôt du code sur GitHub</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><div class="line-block">République Togolaise —<br />
Système Nationale de Surveillance des Forêts</div></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="SSTS-BdD" class="section level2">
<h2><span class="header-section-number">2.1</span> Données de base</h2>
<div id="SSTS-Landsat" class="section level3">
<h3><span class="header-section-number">2.1.1</span> Images Landsat</h3>
<p>Actuellement, l’analyse de l’évolution du couvert forestier est principalement basée sur les <strong>images satellitaires Landsat</strong>, qui sont disponibles gratuitement dans les archives de l’USGS. Les missions Landsat-4 à Landsat-8 produisent des images de résolution spatiale et radiométrique comparable depuis les années 1980. Les images brutes sont corrigées géométriquement et radiométriquement par l’USGS (<a href="https://www.usgs.gov/land-resources/nli/landsat/landsat-surface-reflectance">USGS Collection 1 Level-2 Surface Reflection Product</a>).</p>
<p>La résolution spatiale des images est de <strong>30 mètres</strong>. Les bandes spectrales utilisées sont <strong>B, G, R, NIR, SWIR-1 et SWIR-2</strong> (voir les désignations des bandes dans la figure ci-dessous).</p>
<p><img src="images/Acq-band-designations.png" /></p>
<p>Le territoire du Togo est couvert par un total de 9 images Landsat (scènes WRS 2). Les zones couvertes par les différentes scènes sont indiquées dans la figure ci-dessous.</p>
<p><img src="images/Acq-scenes-Togo.png" /></p>
<p>Les images Landsat utilisées pour l’évaluation du couvert forestier ont été prises idéalement à la <strong>fin de la saison sèche, c’est-à-dire de (Nov), Déc, Jan, (Fév)</strong> et sont disponibles en <strong>bonne qualité</strong> (sans nuages ou seulement légèrement couvertes par des nuages et des ombres) <strong>pour la même date sur l’ensemble du chemin WRS 2</strong> respectif. Pour les années de référence, là ou on aimerait des cartes qui couvrent l’ensemble du territoire du Togo, des images correspondantes sont nécessaires pour tous les trois chemins WRS 2.</p>
<p>Le tableau ci-dessous présente les images satellites utilisées pour l’analyse du couvert forestier au Togo. Les <strong>années de référence</strong> utilisées pour le NRF et les images correspondantes sont indiquées en caractères gras. Ce n’est que pour l’année 1991 que les images de différentes dates d’enregistrement ont été combinées pour le chemin WRS 193. L7* marque les images Landsat-7 avec des lacunes dans les données (SLC-off). La colonne <strong>GoogleEarth</strong> montre la répartition des dates des images de très haute résolution disponibles sur <a href="https://www.google.com/maps/place/Togo/@6.8865979,0.6126023,1079m/data=!3m1!1e3!4m5!3m4!1s0x1023e1c113185419:0xfaae5b301ad19360!8m2!3d8.619543!4d0.824782">GoogleEarth</a>. Seules les images de référence GoogleEarth de 2017 – 2018 ont été utilisées pour la calibration de la carte forêt/non-forêt 2018.</p>
<table>
<colgroup>
<col width="7%" />
<col width="23%" />
<col width="23%" />
<col width="23%" />
<col width="21%" />
</colgroup>
<thead>
<tr class="header">
<th align="right"></th>
<th align="right">WRS 192<br><sup>054,055,056</sup></th>
<th align="right">WRS 193<br><sup>052,053,054,055</sup></th>
<th align="right">WRS 194<br><sup>052,053</sup></th>
<th align="right">GoogleEarth<br><sup>Référence</sup></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2019</td>
<td align="right">L8 / 23.12.18</td>
<td align="right">L8 / 16.02.19</td>
<td align="right">L8 / 22.01.19</td>
<td align="right"><strong>++</strong></td>
</tr>
<tr class="even">
<td align="right"><strong>2018</strong></td>
<td align="right"><strong>L8 / 05.01.18</strong></td>
<td align="right"><strong>L8 / 12.01.18</strong></td>
<td align="right"><strong>L8 / 18.12.17</strong></td>
<td align="right"><strong>+++++++</strong></td>
</tr>
<tr class="odd">
<td align="right">2017</td>
<td align="right">L8 / 19.02.17</td>
<td align="right">L8 / 25.01.17</td>
<td align="right">L8 / 31.12.16</td>
<td align="right"><strong>+++</strong></td>
</tr>
<tr class="even">
<td align="right">2016</td>
<td align="right">—</td>
<td align="right">—</td>
<td align="right">—</td>
<td align="right">(+)</td>
</tr>
<tr class="odd">
<td align="right"><strong>2015</strong></td>
<td align="right"><strong>L8 / 13.01.15</strong></td>
<td align="right"><strong>L8 / 04.01.15</strong></td>
<td align="right"><strong>L8 / 27.01.15</strong></td>
<td align="right">(+)</td>
</tr>
<tr class="even">
<td align="right">2014</td>
<td align="right">—</td>
<td align="right">—</td>
<td align="right">—</td>
<td align="right">(++)</td>
</tr>
<tr class="odd">
<td align="right">2013</td>
<td align="right">L7* / 31.01.13</td>
<td align="right">L7* / 23.02.13</td>
<td align="right">—</td>
<td align="right">(+)</td>
</tr>
<tr class="even">
<td align="right">2012</td>
<td align="right">—</td>
<td align="right">—</td>
<td align="right">L7* / 11.01.12</td>
<td align="right">(++)</td>
</tr>
<tr class="odd">
<td align="right">2011</td>
<td align="right">L7* / 10.01.11</td>
<td align="right">—</td>
<td align="right">—</td>
<td align="right">(+)</td>
</tr>
<tr class="even">
<td align="right">2010</td>
<td align="right">—</td>
<td align="right">—</td>
<td align="right">L7* / 21.01.10</td>
<td align="right">(+)</td>
</tr>
<tr class="odd">
<td align="right">2009</td>
<td align="right">—</td>
<td align="right">L7* / 27.01.09</td>
<td align="right">—</td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="right">2008</td>
<td align="right">—</td>
<td align="right">—</td>
<td align="right">—</td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="right">2007</td>
<td align="right">L7* / 30.12.06</td>
<td align="right">L7* / 22.01.07</td>
<td align="right">L5 / 05.01.07</td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="right">2006</td>
<td align="right">—</td>
<td align="right">—</td>
<td align="right">—</td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="right">2005</td>
<td align="right">L7* / 24.12.04</td>
<td align="right">L7* / 17.02.05</td>
<td align="right">L7* / 22.12.04</td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="right">2004</td>
<td align="right">—</td>
<td align="right">—</td>
<td align="right">—</td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="right"><strong>2003</strong></td>
<td align="right"><strong>L7 / 04.01.03</strong></td>
<td align="right"><strong>L7 / 26.12.02</strong></td>
<td align="right"><strong>L7 / 17.12.02</strong></td>
<td align="right">(.)</td>
</tr>
<tr class="even">
<td align="right">2002</td>
<td align="right">—</td>
<td align="right">—</td>
<td align="right">—</td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="right">2001</td>
<td align="right">L7 / 13.12.00</td>
<td align="right">—</td>
<td align="right">—</td>
<td align="right">(.)</td>
</tr>
<tr class="even">
<td align="right">2000</td>
<td align="right">—</td>
<td align="right">L7 / 04.02.00</td>
<td align="right">L7 / 26.01.00</td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="right">…</td>
<td align="right">…</td>
<td align="right">…</td>
<td align="right">…</td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="right">1997</td>
<td align="right">—</td>
<td align="right">—</td>
<td align="right">L5 / 10.02.97</td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="right">…</td>
<td align="right">…</td>
<td align="right">…</td>
<td align="right">…</td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="right">1991</td>
<td align="right">L4 / 03.01.91</td>
<td align="right">L4 / 10.01.91 &amp; L5 / 28.11.89</td>
<td align="right">—</td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="right">…</td>
<td align="right">…</td>
<td align="right">…</td>
<td align="right">…</td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="right"><strong>1987</strong></td>
<td align="right"><strong>L5 / 31.12.86</strong></td>
<td align="right"><strong>L5 / 23.01.87</strong></td>
<td align="right"><strong>L5 / 29.12.86</strong></td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="right">1986</td>
<td align="right">L5 / 13.01.86</td>
<td align="right">L5 / 06.03.85</td>
<td align="right">L5 / 11.01.86</td>
<td align="right"></td>
</tr>
</tbody>
</table>
<div id="acquisition-des-images" class="section level4">
<h4><span class="header-section-number">2.1.1.1</span> Acquisition des images</h4>
<p>Ouvrir le site <a href="https://earthexplorer.usgs.gov">USGS Earthexplorer</a>. Dans la fenêtre <code>Search Criteria</code> il faut selectionner la période pour laquelle on cherche des images (Nov - Jan). Dans la fenêtre <code>Data Sets</code>, les produits Landsat Level-2 (Surface Reflectance) sont séléctionnés. Dans la fenêtre <code>Additional Criteria</code> il faut choisir les scènes (chemin 192: 054-056 / chemin 193: 052-055 / chemin 194: 052-053).</p>
<p><img src="images/Acq-EE.png" /></p>
<p>Parmi les images disponibles, on sélectionne celles qui sont disponibles à la même date et en bonne qualité pour l’ensemble du chemin WRS.
On copie les identifier des images à télécharger dans un fichier txt.</p>
<p>Ensuite on ouvre le site <a href="https://espa.cr.usgs.gov/ordering/new/">USGS ESPA</a> pour commander les images choisi. On charge le fichier txt avec les identifier des images et on commande les bandes <code>Surface Reflectance</code> et les indices spéctrales (voir image au-dessous). Pour commander des images, il faut qu’on a un compte USGS.</p>
<p><img src="images/Acq-ESPA.png" /></p>
<p>Une fois on est notifié par eMail que les images sont prêts, on les téléchargent manuellement ou tous ensemble avec le <a href="https://github.com/USGS-EROS/espa-bulk-downloader">USGS bulkdownloader</a> et la commande <code>download_espa_order.py -u [nom d'utilisateur] -o ALL -d [répértoire]</code>. On dézip les images et les rangent dans le répétoire <code>data/Landsat</code> sous la scène et l’année correspondante. Pour des images de l’hiver 2019/20, l’année correspondante est 2020.</p>
</div>
<div id="pretraitement-des-images" class="section level4">
<h4><span class="header-section-number">2.1.1.2</span> Prétraitement des images</h4>
<p>Le premier traitement est la préparation des images Landsat et autres variables utilisés pour modéliser la surface forestier ou la biomasse aérienne comme les données topographique et climatiques. L’objectif est qu’on prépare avec les données brutes un jeu de données raster complet sur le même extent (territoir du Togo) et avec la même résolution spatiale de 30 mètres (résolution de base des images Landsat).</p>
<p>On ouvre le script <code>1_prepare-images.R</code> et on modifie la liste des images Landsat à utiliser (<code>in.image.list</code>), par exemple par ajouter les nouveaux image à considérer dans les analyses:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">p192<span class="fl">.2019</span> =<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">  <span class="kw">paste0</span>(DATA.DIR, <span class="st">&quot;/Landsat/192_054/2019/LC081920542018122301T1-SC20190405164258/&quot;</span>),</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">  <span class="kw">paste0</span>(DATA.DIR, <span class="st">&quot;/Landsat/192_055/2019/LC081920552018122301T1-SC20190405163359/&quot;</span>),</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">  <span class="kw">paste0</span>(DATA.DIR, <span class="st">&quot;/Landsat/192_056/2019/LC081920562018122301T1-SC20190405163342/&quot;</span>))</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">...</a>
<a class="sourceLine" id="cb5-6" data-line-number="6">p193<span class="fl">.2019</span> =<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb5-7" data-line-number="7">  <span class="kw">paste0</span>(DATA.DIR, <span class="st">&quot;/Landsat/193_052/2019/LC081930522019021601T1-SC20190405183839/&quot;</span>),</a>
<a class="sourceLine" id="cb5-8" data-line-number="8">  <span class="kw">paste0</span>(DATA.DIR, <span class="st">&quot;/Landsat/193_053/2019/LC081930532019021601T1-SC20190405181518/&quot;</span>),</a>
<a class="sourceLine" id="cb5-9" data-line-number="9">  <span class="kw">paste0</span>(DATA.DIR, <span class="st">&quot;/Landsat/193_054/2019/LC081930542019021601T1-SC20190405183609/&quot;</span>),</a>
<a class="sourceLine" id="cb5-10" data-line-number="10">  <span class="kw">paste0</span>(DATA.DIR, <span class="st">&quot;/Landsat/193_055/2019/LC081930552019021601T1-SC20190405181507/&quot;</span>))</a>
<a class="sourceLine" id="cb5-11" data-line-number="11">...</a>
<a class="sourceLine" id="cb5-12" data-line-number="12">p194<span class="fl">.2019</span> =<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb5-13" data-line-number="13">  <span class="kw">paste0</span>(DATA.DIR, <span class="st">&quot;/Landsat/194_052/2019/LC081940522019012201T1-SC20190405172019/&quot;</span>),</a>
<a class="sourceLine" id="cb5-14" data-line-number="14">  <span class="kw">paste0</span>(DATA.DIR, <span class="st">&quot;/Landsat/194_053/2019/LC081940532019012201T1-SC20190405172055/&quot;</span>))</a></code></pre></div>
<p>Outre la définition des images à traiter, le script définit une fonction <code>prepare.image</code> pour stacker les différentes bandes des images Landsat, pour les fusioner, masquer et couper les images Landsat chemin par chemin (WRS2 paths 192, 193 et 194 pour Togo). Par défaut, les images qui ont déjà été traité (<code>filename</code> existe déjà) ne sont plus traité (<code>overwrite=FALSE</code>).</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">prepare.image</span>(in.image.dirs, <span class="dt">ext=</span><span class="ot">NULL</span>, <span class="dt">filename=</span><span class="ot">NULL</span>, <span class="dt">overwrite=</span><span class="ot">FALSE</span>, <span class="dt">log=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<p>Dans la deuxième partie du script, là où c’est noté <code># DO THE WORK ---------</code>, on lance le traitement des images. Avec le code <code>foreach(...) %dopar% { ... }</code> on lance le traitement de chaque chemin pour chaque année sur des différents processeurs au parallèle. À la fin du script on</p>
<ul>
<li>transforme les images du chemin 194 du système de coordonnées UTM 30 vers UTM 31</li>
<li>produit des thumbnails des images Landsat</li>
</ul>
<p>Les images prétraités sont sauveguarder dans le répétoire <code>input/1_images</code> du projet, ensemble avec des Thumbnails des chemins. Dans une prochaîne étape, les images sont néttoyées de l’eau, nuages et ombres en utilisant les bandes Landsat de qualité des pixels.</p>
<div id="example" class="section level5 unnumbered">
<h5>Example</h5>
<p><img src="images/p194_2019.jpeg" width="33%" /><img src="images/p193_2019.jpeg" width="33%" /><img src="images/p192_2019.jpeg" width="33%" />
<strong>Images Landsat de l’année 2019:</strong> chemin p194 composé de 2 scénes du 22.01.2019 / p193 avec 4 scènes du 16.02.2019 / p192 avec 3 scènes du 23.12.2018</p>
</div>
</div>
<div id="script-r-01_ssts01_data_srcprep-landsat.r" class="section level4 unnumbered">
<h4>Script R: <code>01_SSTS/01_data/_src/prep-Landsat.R</code></h4>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="co">###############################################################################</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="co"># prep-Landsat.R: lire, nettoyer et empiler des images Landsat</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="co"># -----------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co"># Bern University of Applied Sciences</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="co"># Oliver Gardi, &lt;oliver.gardi@bfh.ch&gt;</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co"># 13 Mai 2020</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="co"># Définitions des variables ===================================================</span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9">IN.DIR  &lt;-<span class="st"> </span><span class="kw">paste0</span>(DIR.RAW.DAT, <span class="st">&quot;/Landsat&quot;</span>)</a>
<a class="sourceLine" id="cb7-10" data-line-number="10"></a>
<a class="sourceLine" id="cb7-11" data-line-number="11">OUT.DIR &lt;-<span class="st"> </span><span class="kw">paste0</span>(DIR.SST.DAT, <span class="st">&quot;/Landsat&quot;</span>)</a>
<a class="sourceLine" id="cb7-12" data-line-number="12"><span class="cf">if</span>(<span class="op">!</span><span class="kw">dir.exists</span>(OUT.DIR)) <span class="kw">dir.create</span>(OUT.DIR)</a>
<a class="sourceLine" id="cb7-13" data-line-number="13"></a>
<a class="sourceLine" id="cb7-14" data-line-number="14">WRS     &lt;-<span class="st"> </span><span class="kw">readOGR</span>(<span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/WRS2/WRS2_descending.shp&quot;</span>))    <span class="co"># Scènes WRS</span></a>
<a class="sourceLine" id="cb7-15" data-line-number="15"></a>
<a class="sourceLine" id="cb7-16" data-line-number="16"><span class="co"># Masques de nuages et d&#39;eau pour Landsat 4-7 et Landsat 8   ------------------</span></a>
<a class="sourceLine" id="cb7-17" data-line-number="17"><span class="co"># voir les guides des produits de réflexion de surface Landsat 4-7 et Landsat 8</span></a>
<a class="sourceLine" id="cb7-18" data-line-number="18"><span class="co"># https://www.usgs.gov/land-resources/nli/landsat/landsat-surface-reflectance</span></a>
<a class="sourceLine" id="cb7-19" data-line-number="19"></a>
<a class="sourceLine" id="cb7-20" data-line-number="20">QA.WATER &lt;-<span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb7-21" data-line-number="21">  <span class="dv">68</span>, <span class="dv">132</span>,                      <span class="co"># Landsat 4-7</span></a>
<a class="sourceLine" id="cb7-22" data-line-number="22">  <span class="dv">324</span>, <span class="dv">388</span>, <span class="dv">836</span>, <span class="dv">900</span>, <span class="dv">1348</span>      <span class="co"># Landsat 8</span></a>
<a class="sourceLine" id="cb7-23" data-line-number="23">)</a>
<a class="sourceLine" id="cb7-24" data-line-number="24"></a>
<a class="sourceLine" id="cb7-25" data-line-number="25">QA.SHADOW &lt;-<span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb7-26" data-line-number="26">  <span class="dv">72</span>, <span class="dv">136</span>,</a>
<a class="sourceLine" id="cb7-27" data-line-number="27">  <span class="dv">328</span>, <span class="dv">392</span>, <span class="dv">840</span>, <span class="dv">904</span>, <span class="dv">1350</span></a>
<a class="sourceLine" id="cb7-28" data-line-number="28">)</a>
<a class="sourceLine" id="cb7-29" data-line-number="29"></a>
<a class="sourceLine" id="cb7-30" data-line-number="30">QA.ICE &lt;-<span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb7-31" data-line-number="31">  <span class="dv">80</span>, <span class="dv">112</span>, <span class="dv">144</span>, <span class="dv">176</span>,</a>
<a class="sourceLine" id="cb7-32" data-line-number="32">  <span class="dv">336</span>, <span class="dv">368</span>, <span class="dv">400</span>, <span class="dv">432</span>, <span class="dv">848</span>, <span class="dv">880</span>, <span class="dv">912</span>, <span class="dv">944</span>, <span class="dv">1352</span></a>
<a class="sourceLine" id="cb7-33" data-line-number="33">)</a>
<a class="sourceLine" id="cb7-34" data-line-number="34"></a>
<a class="sourceLine" id="cb7-35" data-line-number="35">QA.CLOUD &lt;-<span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb7-36" data-line-number="36">  <span class="dv">96</span>, <span class="dv">112</span>, <span class="dv">160</span>, <span class="dv">176</span>, <span class="dv">224</span>,</a>
<a class="sourceLine" id="cb7-37" data-line-number="37">  <span class="dv">352</span>, <span class="dv">368</span>, <span class="dv">416</span>, <span class="dv">432</span>, <span class="dv">480</span>, <span class="dv">864</span>, <span class="dv">880</span>, <span class="dv">928</span>, <span class="dv">944</span>, <span class="dv">992</span></a>
<a class="sourceLine" id="cb7-38" data-line-number="38">)</a>
<a class="sourceLine" id="cb7-39" data-line-number="39"></a>
<a class="sourceLine" id="cb7-40" data-line-number="40"><span class="co"># Liste des images à préparer et à fusionner ==================================</span></a>
<a class="sourceLine" id="cb7-41" data-line-number="41"></a>
<a class="sourceLine" id="cb7-42" data-line-number="42">in.image.list &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb7-43" data-line-number="43"></a>
<a class="sourceLine" id="cb7-44" data-line-number="44">  <span class="co"># Chemin WRS p192 -----------------------------</span></a>
<a class="sourceLine" id="cb7-45" data-line-number="45"></a>
<a class="sourceLine" id="cb7-46" data-line-number="46">  <span class="dt">p192.1986 =</span> <span class="kw">list</span>(<span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/192_054/1986/LT051920541986011301T1-SC20190405164223/&quot;</span>),</a>
<a class="sourceLine" id="cb7-47" data-line-number="47">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/192_055/1986/LT051920551986011301T1-SC20190405164227/&quot;</span>),</a>
<a class="sourceLine" id="cb7-48" data-line-number="48">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/192_056/1986/LT051920561986011301T1-SC20190405164153/&quot;</span>)),</a>
<a class="sourceLine" id="cb7-49" data-line-number="49"></a>
<a class="sourceLine" id="cb7-50" data-line-number="50">  <span class="dt">p192.1987 =</span> <span class="kw">list</span>(<span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/192_054/1987/LT051920541986123101T1-SC20190405164150/&quot;</span>),</a>
<a class="sourceLine" id="cb7-51" data-line-number="51">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/192_055/1987/LT051920551986123101T1-SC20190405163521/&quot;</span>),</a>
<a class="sourceLine" id="cb7-52" data-line-number="52">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/192_056/1987/LT051920561986123101T1-SC20190405164444/&quot;</span>)),</a>
<a class="sourceLine" id="cb7-53" data-line-number="53"></a>
<a class="sourceLine" id="cb7-54" data-line-number="54">  <span class="dt">p192.1991 =</span> <span class="kw">list</span>(<span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/192_054/1991/LT041920541991010301T1-SC20190405164201/&quot;</span>),</a>
<a class="sourceLine" id="cb7-55" data-line-number="55">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/192_055/1991/LT041920551991010301T1-SC20190405165911/&quot;</span>),</a>
<a class="sourceLine" id="cb7-56" data-line-number="56">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/192_056/1991/LT041920561991010301T1-SC20190405163911/&quot;</span>)),</a>
<a class="sourceLine" id="cb7-57" data-line-number="57"></a>
<a class="sourceLine" id="cb7-58" data-line-number="58">  <span class="dt">p192.2001 =</span> <span class="kw">list</span>(<span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/192_054/2001/LE071920542000121301T1-SC20190405165521/&quot;</span>),</a>
<a class="sourceLine" id="cb7-59" data-line-number="59">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/192_055/2001/LE071920552000121301T1-SC20190405165645/&quot;</span>),</a>
<a class="sourceLine" id="cb7-60" data-line-number="60">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/192_056/2001/LE071920562000121301T1-SC20190405164029/&quot;</span>)),</a>
<a class="sourceLine" id="cb7-61" data-line-number="61"></a>
<a class="sourceLine" id="cb7-62" data-line-number="62">  <span class="dt">p192.2003 =</span> <span class="kw">list</span>(<span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/192_054/2003/LE071920542003010401T1-SC20190520111322/&quot;</span>),</a>
<a class="sourceLine" id="cb7-63" data-line-number="63">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/192_055/2003/LE071920552003010401T1-SC20190520100402/&quot;</span>),</a>
<a class="sourceLine" id="cb7-64" data-line-number="64">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/192_056/2003/LE071920562003010401T1-SC20190520100206/&quot;</span>)),</a>
<a class="sourceLine" id="cb7-65" data-line-number="65"></a>
<a class="sourceLine" id="cb7-66" data-line-number="66">  <span class="dt">p192.2005 =</span> <span class="kw">list</span>(<span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/192_054/2005/LE071920542004122401T1-SC20190405165520/&quot;</span>),</a>
<a class="sourceLine" id="cb7-67" data-line-number="67">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/192_055/2005/LE071920552004122401T1-SC20190405164050/&quot;</span>),</a>
<a class="sourceLine" id="cb7-68" data-line-number="68">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/192_056/2005/LE071920562004122401T1-SC20190405164030/&quot;</span>)),</a>
<a class="sourceLine" id="cb7-69" data-line-number="69"></a>
<a class="sourceLine" id="cb7-70" data-line-number="70">  <span class="dt">p192.2007 =</span> <span class="kw">list</span>(<span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/192_054/2007/LE071920542006123001T1-SC20190406034211/&quot;</span>),</a>
<a class="sourceLine" id="cb7-71" data-line-number="71">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/192_055/2007/LE071920552006123001T1-SC20190406034231/&quot;</span>),</a>
<a class="sourceLine" id="cb7-72" data-line-number="72">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/192_056/2007/LE071920562006123001T1-SC20190406034202/&quot;</span>)),</a>
<a class="sourceLine" id="cb7-73" data-line-number="73"></a>
<a class="sourceLine" id="cb7-74" data-line-number="74">  <span class="dt">p192.2011 =</span> <span class="kw">list</span>(<span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/192_054/2011/LE071920542011011001T1-SC20190406034214/&quot;</span>),</a>
<a class="sourceLine" id="cb7-75" data-line-number="75">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/192_055/2011/LE071920552011011001T1-SC20190406034114/&quot;</span>),</a>
<a class="sourceLine" id="cb7-76" data-line-number="76">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/192_056/2011/LE071920562011011001T1-SC20190406034155/&quot;</span>)),</a>
<a class="sourceLine" id="cb7-77" data-line-number="77"></a>
<a class="sourceLine" id="cb7-78" data-line-number="78">  <span class="dt">p192.2013 =</span> <span class="kw">list</span>(<span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/192_054/2013/LE071920542013013101T1-SC20190406034224/&quot;</span>),</a>
<a class="sourceLine" id="cb7-79" data-line-number="79">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/192_055/2013/LE071920552013013101T1-SC20190406034046/&quot;</span>),</a>
<a class="sourceLine" id="cb7-80" data-line-number="80">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/192_056/2013/LE071920562013013101T1-SC20190406034057/&quot;</span>)),</a>
<a class="sourceLine" id="cb7-81" data-line-number="81"></a>
<a class="sourceLine" id="cb7-82" data-line-number="82">  <span class="dt">p192.2015 =</span> <span class="kw">list</span>(<span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/192_054/2015/LC081920542015011301T1-SC20190405163446/&quot;</span>),</a>
<a class="sourceLine" id="cb7-83" data-line-number="83">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/192_055/2015/LC081920552015011301T1-SC20190405163723/&quot;</span>),</a>
<a class="sourceLine" id="cb7-84" data-line-number="84">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/192_056/2015/LC081920562015011301T1-SC20190405164231/&quot;</span>)),</a>
<a class="sourceLine" id="cb7-85" data-line-number="85"></a>
<a class="sourceLine" id="cb7-86" data-line-number="86">  <span class="dt">p192.2017 =</span> <span class="kw">list</span>(<span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/192_054/2017/LC081920542017021901T1-SC20190405163339/&quot;</span>),</a>
<a class="sourceLine" id="cb7-87" data-line-number="87">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/192_055/2017/LC081920552017021901T1-SC20190405163342/&quot;</span>),</a>
<a class="sourceLine" id="cb7-88" data-line-number="88">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/192_056/2017/LC081920562017021901T1-SC20190405163222/&quot;</span>)),</a>
<a class="sourceLine" id="cb7-89" data-line-number="89"></a>
<a class="sourceLine" id="cb7-90" data-line-number="90">  <span class="dt">p192.2018 =</span> <span class="kw">list</span>(<span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/192_054/2018/LC081920542018010501T1-SC20190405164304/&quot;</span>),</a>
<a class="sourceLine" id="cb7-91" data-line-number="91">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/192_055/2018/LC081920552018010501T1-SC20190405163402/&quot;</span>),</a>
<a class="sourceLine" id="cb7-92" data-line-number="92">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/192_056/2018/LC081920562018010501T1-SC20190405163250/&quot;</span>)),</a>
<a class="sourceLine" id="cb7-93" data-line-number="93"></a>
<a class="sourceLine" id="cb7-94" data-line-number="94">  <span class="dt">p192.2019 =</span> <span class="kw">list</span>(<span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/192_054/2019/LC081920542018122301T1-SC20190405164258/&quot;</span>),</a>
<a class="sourceLine" id="cb7-95" data-line-number="95">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/192_055/2019/LC081920552018122301T1-SC20190405163359/&quot;</span>),</a>
<a class="sourceLine" id="cb7-96" data-line-number="96">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/192_056/2019/LC081920562018122301T1-SC20190405163342/&quot;</span>)),</a>
<a class="sourceLine" id="cb7-97" data-line-number="97"></a>
<a class="sourceLine" id="cb7-98" data-line-number="98">  <span class="co"># Chemin WRS p193 -----------------------------</span></a>
<a class="sourceLine" id="cb7-99" data-line-number="99"></a>
<a class="sourceLine" id="cb7-100" data-line-number="100">  <span class="dt">p193.1985 =</span> <span class="kw">list</span>(<span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_052/1985/LT051930521985030601T1-SC20190520100259/&quot;</span>),</a>
<a class="sourceLine" id="cb7-101" data-line-number="101">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_053/1985/LT051930531985030601T1-SC20190520100324/&quot;</span>),</a>
<a class="sourceLine" id="cb7-102" data-line-number="102">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_054/1985/LT051930541985030601T1-SC20190520100340/&quot;</span>),</a>
<a class="sourceLine" id="cb7-103" data-line-number="103">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_055/1985/LT051930551985030601T1-SC20190520100140/&quot;</span>)),</a>
<a class="sourceLine" id="cb7-104" data-line-number="104"></a>
<a class="sourceLine" id="cb7-105" data-line-number="105">  <span class="dt">p193.1987 =</span> <span class="kw">list</span>(<span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_052/1987/LT051930521987012301T1-SC20190405182322/&quot;</span>),</a>
<a class="sourceLine" id="cb7-106" data-line-number="106">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_053/1987/LT051930531987012301T1-SC20190405182335/&quot;</span>),</a>
<a class="sourceLine" id="cb7-107" data-line-number="107">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_054/1987/LT051930541987012301T1-SC20190405182331/&quot;</span>),</a>
<a class="sourceLine" id="cb7-108" data-line-number="108">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_055/1987/LT051930551987012301T1-SC20190405182328/&quot;</span>)),</a>
<a class="sourceLine" id="cb7-109" data-line-number="109"></a>
<a class="sourceLine" id="cb7-110" data-line-number="110">  <span class="co"># Attention: là nous avons des images avec des dates différentes !</span></a>
<a class="sourceLine" id="cb7-111" data-line-number="111">  <span class="dt">p193.1990.1 =</span> <span class="kw">list</span>(<span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_052/1990/LT051930521989112801T1-SC20190520100201/&quot;</span>),</a>
<a class="sourceLine" id="cb7-112" data-line-number="112">                     <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_053/1990/LT051930531989112801T1-SC20190520100233/&quot;</span>)),</a>
<a class="sourceLine" id="cb7-113" data-line-number="113">  <span class="dt">p193.1990.2 =</span> <span class="kw">list</span>(<span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_054/1991/LT041930541991011001T1-SC20190402043117/&quot;</span>),</a>
<a class="sourceLine" id="cb7-114" data-line-number="114">                     <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_055/1991/LT041930551991011001T1-SC20190402042453/&quot;</span>)),</a>
<a class="sourceLine" id="cb7-115" data-line-number="115"></a>
<a class="sourceLine" id="cb7-116" data-line-number="116">  <span class="dt">p193.2000 =</span> <span class="kw">list</span>(<span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_052/2000/LE071930522000020401T1-SC20190520100729/&quot;</span>),</a>
<a class="sourceLine" id="cb7-117" data-line-number="117">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_053/2000/LE071930532000020401T1-SC20190520100345/&quot;</span>),</a>
<a class="sourceLine" id="cb7-118" data-line-number="118">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_054/2000/LE071930542000020401T1-SC20190402045232/&quot;</span>),</a>
<a class="sourceLine" id="cb7-119" data-line-number="119">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_055/2000/LE071930552000020401T1-SC20190402043121/&quot;</span>)),</a>
<a class="sourceLine" id="cb7-120" data-line-number="120"></a>
<a class="sourceLine" id="cb7-121" data-line-number="121">  <span class="dt">p193.2003 =</span> <span class="kw">list</span>(<span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_052/2003/LE071930522002122601T1-SC20190405182352/&quot;</span>),</a>
<a class="sourceLine" id="cb7-122" data-line-number="122">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_053/2003/LE071930532002122601T1-SC20190405182309/&quot;</span>),</a>
<a class="sourceLine" id="cb7-123" data-line-number="123">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_054/2003/LE071930542002122601T1-SC20190405182226/&quot;</span>),</a>
<a class="sourceLine" id="cb7-124" data-line-number="124">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_055/2003/LE071930552002122601T1-SC20190405190255/&quot;</span>)),</a>
<a class="sourceLine" id="cb7-125" data-line-number="125"></a>
<a class="sourceLine" id="cb7-126" data-line-number="126">  <span class="dt">p193.2005 =</span> <span class="kw">list</span>(<span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_052/2005/LE071930522005021701T1-SC20190405190117/&quot;</span>),</a>
<a class="sourceLine" id="cb7-127" data-line-number="127">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_053/2005/LE071930532005021701T1-SC20190405190003/&quot;</span>),</a>
<a class="sourceLine" id="cb7-128" data-line-number="128">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_054/2005/LE071930542005021701T1-SC20190405182210/&quot;</span>),</a>
<a class="sourceLine" id="cb7-129" data-line-number="129">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_055/2005/LE071930552005021701T1-SC20190405190021/&quot;</span>)),</a>
<a class="sourceLine" id="cb7-130" data-line-number="130"></a>
<a class="sourceLine" id="cb7-131" data-line-number="131">  <span class="dt">p193.2007 =</span> <span class="kw">list</span>(<span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_052/2007/LE071930522007012201T1-SC20190405182221/&quot;</span>),</a>
<a class="sourceLine" id="cb7-132" data-line-number="132">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_053/2007/LE071930532007012201T1-SC20190405182607/&quot;</span>),</a>
<a class="sourceLine" id="cb7-133" data-line-number="133">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_054/2007/LE071930542007012201T1-SC20190405182139/&quot;</span>),</a>
<a class="sourceLine" id="cb7-134" data-line-number="134">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_055/2007/LE071930552007012201T1-SC20190405182418/&quot;</span>)),</a>
<a class="sourceLine" id="cb7-135" data-line-number="135"></a>
<a class="sourceLine" id="cb7-136" data-line-number="136">  <span class="dt">p193.2009 =</span> <span class="kw">list</span>(<span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_052/2009/LE071930522009012701T1-SC20190405182143/&quot;</span>),</a>
<a class="sourceLine" id="cb7-137" data-line-number="137">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_053/2009/LE071930532009012701T1-SC20190405182301/&quot;</span>),</a>
<a class="sourceLine" id="cb7-138" data-line-number="138">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_054/2009/LE071930542009012701T1-SC20190405182103/&quot;</span>),</a>
<a class="sourceLine" id="cb7-139" data-line-number="139">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_055/2009/LE071930552009012701T1-SC20190405182754/&quot;</span>)),</a>
<a class="sourceLine" id="cb7-140" data-line-number="140"></a>
<a class="sourceLine" id="cb7-141" data-line-number="141">  <span class="dt">p193.2013 =</span> <span class="kw">list</span>(<span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_052/2013/LE071930522013022301T1-SC20190405182200/&quot;</span>),</a>
<a class="sourceLine" id="cb7-142" data-line-number="142">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_053/2013/LE071930532013022301T1-SC20190405182213/&quot;</span>),</a>
<a class="sourceLine" id="cb7-143" data-line-number="143">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_054/2013/LE071930542013022301T1-SC20190405182152/&quot;</span>),</a>
<a class="sourceLine" id="cb7-144" data-line-number="144">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_055/2013/LE071930552013022301T1-SC20190405182331/&quot;</span>)),</a>
<a class="sourceLine" id="cb7-145" data-line-number="145"></a>
<a class="sourceLine" id="cb7-146" data-line-number="146">  <span class="dt">p193.2015 =</span> <span class="kw">list</span>(<span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_052/2015/LC081930522015010401T1-SC20190405181512/&quot;</span>),</a>
<a class="sourceLine" id="cb7-147" data-line-number="147">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_053/2015/LC081930532015010401T1-SC20190405181751/&quot;</span>),</a>
<a class="sourceLine" id="cb7-148" data-line-number="148">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_054/2015/LC081930542015010401T1-SC20190402042510/&quot;</span>),</a>
<a class="sourceLine" id="cb7-149" data-line-number="149">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_055/2015/LC081930552015010401T1-SC20190402042446/&quot;</span>)),</a>
<a class="sourceLine" id="cb7-150" data-line-number="150"></a>
<a class="sourceLine" id="cb7-151" data-line-number="151">  <span class="dt">p193.2017 =</span> <span class="kw">list</span>(<span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_052/2017/LC081930522017012501T1-SC20190405181511/&quot;</span>),</a>
<a class="sourceLine" id="cb7-152" data-line-number="152">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_053/2017/LC081930532017012501T1-SC20190405181440/&quot;</span>),</a>
<a class="sourceLine" id="cb7-153" data-line-number="153">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_054/2017/LC081930542017012501T1-SC20190405181458/&quot;</span>),</a>
<a class="sourceLine" id="cb7-154" data-line-number="154">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_055/2017/LC081930552017012501T1-SC20190405181444/&quot;</span>)),</a>
<a class="sourceLine" id="cb7-155" data-line-number="155"></a>
<a class="sourceLine" id="cb7-156" data-line-number="156">  <span class="dt">p193.2018 =</span> <span class="kw">list</span>(<span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_052/2018/LC081930522018011201T1-SC20190405181524/&quot;</span>),</a>
<a class="sourceLine" id="cb7-157" data-line-number="157">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_053/2018/LC081930532018011201T1-SC20190405181459/&quot;</span>),</a>
<a class="sourceLine" id="cb7-158" data-line-number="158">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_054/2018/LC081930542018011201T1-SC20190405181510/&quot;</span>),</a>
<a class="sourceLine" id="cb7-159" data-line-number="159">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_055/2018/LC081930552018011201T1-SC20190405181442/&quot;</span>)),</a>
<a class="sourceLine" id="cb7-160" data-line-number="160"></a>
<a class="sourceLine" id="cb7-161" data-line-number="161">  <span class="dt">p193.2019 =</span> <span class="kw">list</span>(<span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_052/2019/LC081930522019021601T1-SC20190405183839/&quot;</span>),</a>
<a class="sourceLine" id="cb7-162" data-line-number="162">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_053/2019/LC081930532019021601T1-SC20190405181518/&quot;</span>),</a>
<a class="sourceLine" id="cb7-163" data-line-number="163">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_054/2019/LC081930542019021601T1-SC20190405183609/&quot;</span>),</a>
<a class="sourceLine" id="cb7-164" data-line-number="164">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/193_055/2019/LC081930552019021601T1-SC20190405181507/&quot;</span>)),</a>
<a class="sourceLine" id="cb7-165" data-line-number="165"></a>
<a class="sourceLine" id="cb7-166" data-line-number="166">  <span class="co"># Chemin WRS p194 -----------------------------</span></a>
<a class="sourceLine" id="cb7-167" data-line-number="167"></a>
<a class="sourceLine" id="cb7-168" data-line-number="168">  <span class="dt">p194.1986 =</span> <span class="kw">list</span>(<span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/194_052/1986/LT051940521986011101T1-SC20190405172804/&quot;</span>),</a>
<a class="sourceLine" id="cb7-169" data-line-number="169">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/194_053/1986/LT051940531986011101T1-SC20190405172758/&quot;</span>)),</a>
<a class="sourceLine" id="cb7-170" data-line-number="170"></a>
<a class="sourceLine" id="cb7-171" data-line-number="171">  <span class="dt">p194.1987 =</span> <span class="kw">list</span>(<span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/194_052/1987/LT051940521986122901T1-SC20190405172903/&quot;</span>),</a>
<a class="sourceLine" id="cb7-172" data-line-number="172">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/194_053/1987/LT051940531986122901T1-SC20190405174433/&quot;</span>)),</a>
<a class="sourceLine" id="cb7-173" data-line-number="173"></a>
<a class="sourceLine" id="cb7-174" data-line-number="174">  <span class="dt">p194.1997 =</span> <span class="kw">list</span>(<span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/194_052/1997/LT051940521997021001T1-SC20190405181746/&quot;</span>),</a>
<a class="sourceLine" id="cb7-175" data-line-number="175">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/194_053/1997/LT051940531997021001T1-SC20190405173130/&quot;</span>)),</a>
<a class="sourceLine" id="cb7-176" data-line-number="176"></a>
<a class="sourceLine" id="cb7-177" data-line-number="177">  <span class="dt">p194.2000 =</span> <span class="kw">list</span>(<span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/194_052/2000/LE071940522000012601T1-SC20190405172721/&quot;</span>),</a>
<a class="sourceLine" id="cb7-178" data-line-number="178">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/194_053/2000/LE071940532000012601T1-SC20190405172733/&quot;</span>)),</a>
<a class="sourceLine" id="cb7-179" data-line-number="179"></a>
<a class="sourceLine" id="cb7-180" data-line-number="180">  <span class="dt">p194.2003 =</span> <span class="kw">list</span>(<span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/194_052/2003/LE071940522002121701T1-SC20190405172823/&quot;</span>),</a>
<a class="sourceLine" id="cb7-181" data-line-number="181">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/194_053/2003/LE071940532002121701T1-SC20190405172739/&quot;</span>)),</a>
<a class="sourceLine" id="cb7-182" data-line-number="182"></a>
<a class="sourceLine" id="cb7-183" data-line-number="183">  <span class="dt">p194.2005 =</span> <span class="kw">list</span>(<span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/194_052/2005/LE071940522004122201T1-SC20190405172700/&quot;</span>),</a>
<a class="sourceLine" id="cb7-184" data-line-number="184">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/194_053/2005/LE071940532004122201T1-SC20190405172612/&quot;</span>)),</a>
<a class="sourceLine" id="cb7-185" data-line-number="185"></a>
<a class="sourceLine" id="cb7-186" data-line-number="186">  <span class="dt">p194.2007 =</span> <span class="kw">list</span>(<span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/194_052/2007/LT051940522007010501T1-SC20190405172919/&quot;</span>),</a>
<a class="sourceLine" id="cb7-187" data-line-number="187">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/194_053/2007/LT051940532007010501T1-SC20190405172216/&quot;</span>)),</a>
<a class="sourceLine" id="cb7-188" data-line-number="188"></a>
<a class="sourceLine" id="cb7-189" data-line-number="189">  <span class="dt">p194.2010 =</span> <span class="kw">list</span>(<span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/194_052/2010/LE071940522010012101T1-SC20190405172745/&quot;</span>),</a>
<a class="sourceLine" id="cb7-190" data-line-number="190">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/194_053/2010/LE071940532010012101T1-SC20190405173304/&quot;</span>)),</a>
<a class="sourceLine" id="cb7-191" data-line-number="191">  </a>
<a class="sourceLine" id="cb7-192" data-line-number="192">  <span class="dt">p194.2012 =</span> <span class="kw">list</span>(<span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/194_052/2012/LE071940522012011101T1-SC20190405173146/&quot;</span>),</a>
<a class="sourceLine" id="cb7-193" data-line-number="193">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/194_053/2012/LE071940532012011101T1-SC20190405172236/&quot;</span>)),</a>
<a class="sourceLine" id="cb7-194" data-line-number="194"></a>
<a class="sourceLine" id="cb7-195" data-line-number="195">  <span class="dt">p194.2015 =</span> <span class="kw">list</span>(<span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/194_052/2015/LC081940522015012701T1-SC20190405172055/&quot;</span>),</a>
<a class="sourceLine" id="cb7-196" data-line-number="196">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/194_053/2015/LC081940532015012701T1-SC20190405172042/&quot;</span>)),</a>
<a class="sourceLine" id="cb7-197" data-line-number="197"></a>
<a class="sourceLine" id="cb7-198" data-line-number="198">  <span class="dt">p194.2017 =</span> <span class="kw">list</span>(<span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/194_052/2017/LC081940522016123101T1-SC20190405172058/&quot;</span>),</a>
<a class="sourceLine" id="cb7-199" data-line-number="199">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/194_053/2017/LC081940532016123101T1-SC20190405172040/&quot;</span>)),</a>
<a class="sourceLine" id="cb7-200" data-line-number="200"></a>
<a class="sourceLine" id="cb7-201" data-line-number="201">  <span class="dt">p194.2018 =</span> <span class="kw">list</span>(<span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/194_052/2018/LC081940522017121801T1-SC20190405172038/&quot;</span>),</a>
<a class="sourceLine" id="cb7-202" data-line-number="202">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/194_053/2018/LC081940532017121801T1-SC20190405174114/&quot;</span>)),</a>
<a class="sourceLine" id="cb7-203" data-line-number="203"></a>
<a class="sourceLine" id="cb7-204" data-line-number="204">  <span class="dt">p194.2019 =</span> <span class="kw">list</span>(<span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/194_052/2019/LC081940522019012201T1-SC20190405172019/&quot;</span>),</a>
<a class="sourceLine" id="cb7-205" data-line-number="205">                   <span class="kw">paste0</span>(IN.DIR, <span class="st">&quot;/194_053/2019/LC081940532019012201T1-SC20190405172055/&quot;</span>))</a>
<a class="sourceLine" id="cb7-206" data-line-number="206"></a>
<a class="sourceLine" id="cb7-207" data-line-number="207">)</a>
<a class="sourceLine" id="cb7-208" data-line-number="208"></a>
<a class="sourceLine" id="cb7-209" data-line-number="209"><span class="co"># Fonction pour traiter et fusionner un ensemble d&#39;images Landsat =============</span></a>
<a class="sourceLine" id="cb7-210" data-line-number="210"><span class="co">#</span></a>
<a class="sourceLine" id="cb7-211" data-line-number="211"><span class="co"># @param in.image.dirs liste des répertoires des images à traiter</span></a>
<a class="sourceLine" id="cb7-212" data-line-number="212"><span class="co"># @param ext           l&#39;étendue dà utiliser pour le recadrage des images</span></a>
<a class="sourceLine" id="cb7-213" data-line-number="213"><span class="co"># @param filename      nom de fichier pour la sauvegarde de l&#39;image traitée</span></a>
<a class="sourceLine" id="cb7-214" data-line-number="214"><span class="co"># @param overwrite     retraiter et écraser des images déjà existantes</span></a>
<a class="sourceLine" id="cb7-215" data-line-number="215"><span class="co"># @param log           écrire les informations sur le processus dans un fichier</span></a>
<a class="sourceLine" id="cb7-216" data-line-number="216"><span class="co">#</span></a>
<a class="sourceLine" id="cb7-217" data-line-number="217"><span class="co"># @return              objet raster de l&#39;image traitée (invisible)</span></a>
<a class="sourceLine" id="cb7-218" data-line-number="218"><span class="co">#</span></a>
<a class="sourceLine" id="cb7-219" data-line-number="219">prepare.landsat &lt;-<span class="st"> </span><span class="cf">function</span>(in.image.dirs, </a>
<a class="sourceLine" id="cb7-220" data-line-number="220">                            <span class="dt">ext=</span><span class="ot">NULL</span>, </a>
<a class="sourceLine" id="cb7-221" data-line-number="221">                            <span class="dt">filename=</span><span class="ot">NULL</span>, </a>
<a class="sourceLine" id="cb7-222" data-line-number="222">                            <span class="dt">overwrite=</span><span class="ot">FALSE</span>, </a>
<a class="sourceLine" id="cb7-223" data-line-number="223">                            <span class="dt">log=</span><span class="ot">TRUE</span>) {</a>
<a class="sourceLine" id="cb7-224" data-line-number="224">  </a>
<a class="sourceLine" id="cb7-225" data-line-number="225">  <span class="co"># Charger le fichier, si le fichier existe et overwrite==FALSE</span></a>
<a class="sourceLine" id="cb7-226" data-line-number="226">  <span class="cf">if</span>(<span class="op">!</span><span class="kw">is.null</span>(filename) <span class="op">&amp;&amp;</span><span class="st"> </span><span class="kw">file.exists</span>(filename) <span class="op">&amp;&amp;</span><span class="st"> </span>overwrite<span class="op">==</span><span class="ot">FALSE</span>) {</a>
<a class="sourceLine" id="cb7-227" data-line-number="227">    <span class="kw">message</span>(<span class="st">&quot;- loading from file &quot;</span>, filename)</a>
<a class="sourceLine" id="cb7-228" data-line-number="228">    out.image &lt;-<span class="st"> </span><span class="kw">stack</span>(filename)</a>
<a class="sourceLine" id="cb7-229" data-line-number="229">    </a>
<a class="sourceLine" id="cb7-230" data-line-number="230">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb7-231" data-line-number="231">    </a>
<a class="sourceLine" id="cb7-232" data-line-number="232">    <span class="co"># Ouvrir le fichier journal si un nom de fichier et log==true</span></a>
<a class="sourceLine" id="cb7-233" data-line-number="233">    <span class="cf">if</span>(<span class="op">!</span><span class="kw">is.null</span>(filename) <span class="op">&amp;</span><span class="st"> </span>log<span class="op">==</span><span class="ot">TRUE</span>) {</a>
<a class="sourceLine" id="cb7-234" data-line-number="234">      <span class="kw">dir.create</span>(<span class="kw">dirname</span>(filename), <span class="dt">recursive =</span> <span class="ot">TRUE</span>, <span class="dt">showWarnings =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb7-235" data-line-number="235">      logfile &lt;-<span class="st"> </span><span class="kw">file</span>(<span class="kw">sub</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">.[[:alnum:]]+$&quot;</span>, <span class="st">&quot;.log&quot;</span>, filename), <span class="dt">open=</span><span class="st">&quot;wt&quot;</span>)</a>
<a class="sourceLine" id="cb7-236" data-line-number="236">      <span class="kw">sink</span>(logfile, <span class="dt">type=</span><span class="st">&quot;output&quot;</span>)</a>
<a class="sourceLine" id="cb7-237" data-line-number="237">      <span class="kw">sink</span>(logfile, <span class="dt">type=</span><span class="st">&quot;message&quot;</span>)</a>
<a class="sourceLine" id="cb7-238" data-line-number="238">      <span class="kw">message</span>(<span class="kw">date</span>())</a>
<a class="sourceLine" id="cb7-239" data-line-number="239">    }</a>
<a class="sourceLine" id="cb7-240" data-line-number="240">    </a>
<a class="sourceLine" id="cb7-241" data-line-number="241">    <span class="co"># Listes vides pour les images et des bandes de qualité</span></a>
<a class="sourceLine" id="cb7-242" data-line-number="242">    images &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb7-243" data-line-number="243">    qas &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb7-244" data-line-number="244">    </a>
<a class="sourceLine" id="cb7-245" data-line-number="245">    <span class="co"># Pour chaque image ... </span></a>
<a class="sourceLine" id="cb7-246" data-line-number="246">    <span class="cf">for</span>(image.dir <span class="cf">in</span> in.image.dirs) {</a>
<a class="sourceLine" id="cb7-247" data-line-number="247">      </a>
<a class="sourceLine" id="cb7-248" data-line-number="248">      image.sensor &lt;-<span class="st"> </span><span class="kw">substr</span>(<span class="kw">basename</span>(image.dir), <span class="dv">0</span>,<span class="dv">4</span>) </a>
<a class="sourceLine" id="cb7-249" data-line-number="249">      <span class="cf">if</span>(image.sensor<span class="op">==</span><span class="st">&quot;LC08&quot;</span>) {</a>
<a class="sourceLine" id="cb7-250" data-line-number="250">        regexp &lt;-<span class="st"> &quot;^.*_(pixel_qa|band2|band3|band4|band5|band6|band7|evi|msavi|nbr|nbr2|ndmi|ndvi|savi).tif$&quot;</span></a>
<a class="sourceLine" id="cb7-251" data-line-number="251">      } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb7-252" data-line-number="252">        regexp &lt;-<span class="st"> &quot;^.*_(pixel_qa|band1|band2|band3|band4|band5|band7|evi|msavi|nbr|nbr2|ndmi|ndvi|savi).tif$&quot;</span></a>
<a class="sourceLine" id="cb7-253" data-line-number="253">      }</a>
<a class="sourceLine" id="cb7-254" data-line-number="254">      image &lt;-<span class="st"> </span><span class="kw">stack</span>(<span class="kw">grep</span>(regexp, <span class="kw">dir</span>(image.dir, <span class="dt">full.names=</span><span class="ot">TRUE</span>), <span class="dt">value=</span><span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb7-255" data-line-number="255">      image.name   &lt;-<span class="st"> </span><span class="kw">substr</span>(<span class="kw">names</span>(image)[<span class="dv">1</span>], <span class="dv">1</span>, <span class="dv">40</span>)</a>
<a class="sourceLine" id="cb7-256" data-line-number="256">      image.scene  &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="kw">substr</span>(image.name, <span class="dv">11</span>, <span class="dv">13</span>), <span class="st">&quot;_&quot;</span>, <span class="kw">substr</span>(image.name, <span class="dv">14</span>, <span class="dv">16</span>))</a>
<a class="sourceLine" id="cb7-257" data-line-number="257">      image.date   &lt;-<span class="st"> </span><span class="kw">substr</span>(image.name, <span class="dv">18</span>, <span class="dv">21</span>)</a>
<a class="sourceLine" id="cb7-258" data-line-number="258">      image.path   &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">substr</span>(image.scene, <span class="dv">1</span>, <span class="dv">3</span>))</a>
<a class="sourceLine" id="cb7-259" data-line-number="259">      image.row    &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">substr</span>(image.scene, <span class="dv">5</span>, <span class="dv">7</span>))</a>
<a class="sourceLine" id="cb7-260" data-line-number="260">      </a>
<a class="sourceLine" id="cb7-261" data-line-number="261">      <span class="co"># ... renommer les couches de l&#39;image</span></a>
<a class="sourceLine" id="cb7-262" data-line-number="262">      <span class="kw">names</span>(image) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;qa&quot;</span>, SST.LSBANDS)</a>
<a class="sourceLine" id="cb7-263" data-line-number="263">      </a>
<a class="sourceLine" id="cb7-264" data-line-number="264">      <span class="kw">message</span>(<span class="st">&quot;- &quot;</span>, image.name, <span class="st">&quot;: &quot;</span>, <span class="dt">appendLF =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb7-265" data-line-number="265">      </a>
<a class="sourceLine" id="cb7-266" data-line-number="266">      <span class="co"># ... recadrer l&#39;image avec l&#39;étendue (le cas échéant)</span></a>
<a class="sourceLine" id="cb7-267" data-line-number="267">      <span class="cf">if</span>(<span class="op">!</span><span class="kw">is.null</span>(ext)) {</a>
<a class="sourceLine" id="cb7-268" data-line-number="268">        <span class="kw">message</span>(<span class="st">&quot;crop ext ... &quot;</span>, <span class="dt">appendLF =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb7-269" data-line-number="269">        image &lt;-<span class="st"> </span><span class="kw">crop</span>(image, ext)</a>
<a class="sourceLine" id="cb7-270" data-line-number="270">      }</a>
<a class="sourceLine" id="cb7-271" data-line-number="271">      </a>
<a class="sourceLine" id="cb7-272" data-line-number="272">      <span class="co"># ... recadrer et masquer avec WRS</span></a>
<a class="sourceLine" id="cb7-273" data-line-number="273">      <span class="kw">message</span>(<span class="st">&quot;crop/mask WRS2 ... &quot;</span>, <span class="dt">appendLF =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb7-274" data-line-number="274">      wrs &lt;-<span class="st"> </span><span class="kw">spTransform</span>(WRS[WRS<span class="op">$</span>PATH<span class="op">==</span>image.path <span class="op">&amp;</span><span class="st"> </span>WRS<span class="op">$</span>ROW<span class="op">==</span>image.row, ], <span class="dt">CRS=</span><span class="kw">crs</span>(image))</a>
<a class="sourceLine" id="cb7-275" data-line-number="275">      image &lt;-<span class="st"> </span><span class="kw">mask</span>(<span class="kw">crop</span>(image, wrs), wrs)</a>
<a class="sourceLine" id="cb7-276" data-line-number="276">      </a>
<a class="sourceLine" id="cb7-277" data-line-number="277">      <span class="co"># ... extraire la bande de qualité</span></a>
<a class="sourceLine" id="cb7-278" data-line-number="278">      qa &lt;-<span class="st"> </span>image[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb7-279" data-line-number="279">      image &lt;-<span class="st"> </span><span class="kw">dropLayer</span>(image, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb7-280" data-line-number="280">      </a>
<a class="sourceLine" id="cb7-281" data-line-number="281">      <span class="co"># ... supprimer les valeurs de réflectance non valides</span></a>
<a class="sourceLine" id="cb7-282" data-line-number="282">      <span class="kw">message</span>(<span class="st">&quot;clean sr ... &quot;</span>, <span class="dt">appendLF =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb7-283" data-line-number="283">      <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>) {</a>
<a class="sourceLine" id="cb7-284" data-line-number="284">        image[[i]] &lt;-<span class="st"> </span><span class="kw">reclassify</span>(image[[i]], <span class="kw">cbind</span>(<span class="op">-</span><span class="ot">Inf</span>, <span class="dv">0</span>, <span class="ot">NA</span>), <span class="dt">right=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb7-285" data-line-number="285">        image[[i]] &lt;-<span class="st"> </span><span class="kw">reclassify</span>(image[[i]], <span class="kw">cbind</span>(<span class="dv">10000</span>, <span class="ot">Inf</span>, <span class="ot">NA</span>), <span class="dt">right=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb7-286" data-line-number="286">      }</a>
<a class="sourceLine" id="cb7-287" data-line-number="287">      </a>
<a class="sourceLine" id="cb7-288" data-line-number="288">      <span class="co"># ... supprimer les valeurs d&#39;indices non valides</span></a>
<a class="sourceLine" id="cb7-289" data-line-number="289">      <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">7</span><span class="op">:</span><span class="dv">13</span>) {</a>
<a class="sourceLine" id="cb7-290" data-line-number="290">        image[[i]] &lt;-<span class="st"> </span><span class="kw">reclassify</span>(image[[i]], <span class="kw">cbind</span>(<span class="op">-</span><span class="ot">Inf</span>, <span class="dv">-10000</span>, <span class="ot">NA</span>), <span class="dt">right=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb7-291" data-line-number="291">        image[[i]] &lt;-<span class="st"> </span><span class="kw">reclassify</span>(image[[i]], <span class="kw">cbind</span>(<span class="dv">10000</span>, <span class="ot">Inf</span>, <span class="ot">NA</span>), <span class="dt">right=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb7-292" data-line-number="292">      }</a>
<a class="sourceLine" id="cb7-293" data-line-number="293"></a>
<a class="sourceLine" id="cb7-294" data-line-number="294">      <span class="co"># ... mettre l&#39;ensemble de la pile à NA là où une seule couche est NA</span></a>
<a class="sourceLine" id="cb7-295" data-line-number="295">      m &lt;-<span class="st"> </span><span class="kw">sum</span>(image)</a>
<a class="sourceLine" id="cb7-296" data-line-number="296">      image &lt;-<span class="st"> </span><span class="kw">mask</span>(image, m)</a>
<a class="sourceLine" id="cb7-297" data-line-number="297">      </a>
<a class="sourceLine" id="cb7-298" data-line-number="298">      <span class="co"># ... ajouter l&#39;image et la bande de qualité aux listes correspondantes</span></a>
<a class="sourceLine" id="cb7-299" data-line-number="299">      images[[<span class="kw">length</span>(images)<span class="op">+</span><span class="dv">1</span>]] &lt;-<span class="st"> </span>image</a>
<a class="sourceLine" id="cb7-300" data-line-number="300">      qas[[<span class="kw">length</span>(qas)<span class="op">+</span><span class="dv">1</span>]] &lt;-<span class="st"> </span>qa</a>
<a class="sourceLine" id="cb7-301" data-line-number="301">    }</a>
<a class="sourceLine" id="cb7-302" data-line-number="302">    </a>
<a class="sourceLine" id="cb7-303" data-line-number="303">    <span class="co"># Fusionner les images (scènes) dans les listes</span></a>
<a class="sourceLine" id="cb7-304" data-line-number="304">    <span class="kw">message</span>(<span class="st">&quot;- merging scenes ... &quot;</span>, <span class="dt">appendLF =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb7-305" data-line-number="305">    out.image &lt;-<span class="st"> </span><span class="kw">do.call</span>(merge, images)</a>
<a class="sourceLine" id="cb7-306" data-line-number="306">    out.qa &lt;-<span class="st"> </span><span class="kw">do.call</span>(merge, qas)</a>
<a class="sourceLine" id="cb7-307" data-line-number="307">    </a>
<a class="sourceLine" id="cb7-308" data-line-number="308">    <span class="co"># Sauvegarder l&#39;image fusionné dans un fichier</span></a>
<a class="sourceLine" id="cb7-309" data-line-number="309">    <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.null</span>(filename) <span class="op">&amp;&amp;</span><span class="st"> </span>(<span class="op">!</span><span class="kw">file.exists</span>(filename) <span class="op">||</span><span class="st"> </span>overwrite <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>)) {</a>
<a class="sourceLine" id="cb7-310" data-line-number="310">      <span class="kw">message</span>(<span class="st">&quot;writing to file &quot;</span>, filename, <span class="st">&quot; ... &quot;</span>, <span class="dt">appendLF =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb7-311" data-line-number="311">      out.image &lt;-<span class="st"> </span><span class="kw">writeRaster</span>(out.image, </a>
<a class="sourceLine" id="cb7-312" data-line-number="312">                               <span class="dt">filename =</span> filename, </a>
<a class="sourceLine" id="cb7-313" data-line-number="313">                               <span class="dt">overwrite =</span> overwrite, </a>
<a class="sourceLine" id="cb7-314" data-line-number="314">                               <span class="dt">datatype=</span><span class="st">&quot;INT2S&quot;</span>, </a>
<a class="sourceLine" id="cb7-315" data-line-number="315">                               <span class="dt">options=</span><span class="kw">c</span>(<span class="st">&quot;COMPRESS=NONE&quot;</span>))</a>
<a class="sourceLine" id="cb7-316" data-line-number="316">      <span class="kw">names</span>(out.image) &lt;-<span class="st"> </span>SST.LSBANDS</a>
<a class="sourceLine" id="cb7-317" data-line-number="317">      out.qa &lt;-<span class="st"> </span><span class="kw">writeRaster</span>(out.qa, </a>
<a class="sourceLine" id="cb7-318" data-line-number="318">                            <span class="dt">filename =</span> <span class="kw">sub</span>(<span class="st">&quot;[.]tif$&quot;</span>, <span class="kw">paste0</span>(<span class="st">&quot;_qa&quot;</span>, image.sensor, <span class="st">&quot;.tif&quot;</span>), filename), </a>
<a class="sourceLine" id="cb7-319" data-line-number="319">                            <span class="dt">overwrite =</span> overwrite, </a>
<a class="sourceLine" id="cb7-320" data-line-number="320">                            <span class="dt">datatype=</span><span class="st">&quot;INT2S&quot;</span>)</a>
<a class="sourceLine" id="cb7-321" data-line-number="321">    }</a>
<a class="sourceLine" id="cb7-322" data-line-number="322">  }</a>
<a class="sourceLine" id="cb7-323" data-line-number="323">  </a>
<a class="sourceLine" id="cb7-324" data-line-number="324">  <span class="kw">message</span>(<span class="st">&quot;done&quot;</span>)</a>
<a class="sourceLine" id="cb7-325" data-line-number="325">  <span class="kw">print</span>(out.image)</a>
<a class="sourceLine" id="cb7-326" data-line-number="326">  </a>
<a class="sourceLine" id="cb7-327" data-line-number="327">  <span class="co"># Fermer le fichier journal</span></a>
<a class="sourceLine" id="cb7-328" data-line-number="328">  <span class="cf">if</span>(<span class="op">!</span><span class="kw">is.null</span>(filename) <span class="op">&amp;</span><span class="st"> </span>log<span class="op">==</span><span class="ot">TRUE</span>) {</a>
<a class="sourceLine" id="cb7-329" data-line-number="329">    <span class="kw">sink</span>(<span class="dt">type=</span><span class="st">&quot;output&quot;</span>)</a>
<a class="sourceLine" id="cb7-330" data-line-number="330">    <span class="kw">sink</span>(<span class="dt">type=</span><span class="st">&quot;message&quot;</span>)</a>
<a class="sourceLine" id="cb7-331" data-line-number="331">  }</a>
<a class="sourceLine" id="cb7-332" data-line-number="332">  </a>
<a class="sourceLine" id="cb7-333" data-line-number="333">  <span class="co"># Retourner l&#39;image de manière invisible</span></a>
<a class="sourceLine" id="cb7-334" data-line-number="334">  <span class="kw">invisible</span>(out.image)</a>
<a class="sourceLine" id="cb7-335" data-line-number="335">  </a>
<a class="sourceLine" id="cb7-336" data-line-number="336">}</a>
<a class="sourceLine" id="cb7-337" data-line-number="337"></a>
<a class="sourceLine" id="cb7-338" data-line-number="338"></a>
<a class="sourceLine" id="cb7-339" data-line-number="339"><span class="co"># COMMENCER LE TRAITEMENT #####################################################</span></a>
<a class="sourceLine" id="cb7-340" data-line-number="340"><span class="co"># Attention, peut facilement remplir le répertoire tmp ! </span></a>
<a class="sourceLine" id="cb7-341" data-line-number="341"><span class="co"># Peut-être seulement traiter une partie des images et ensuite redémarrer R</span></a>
<a class="sourceLine" id="cb7-342" data-line-number="342"></a>
<a class="sourceLine" id="cb7-343" data-line-number="343"><span class="co"># Étendue du Togo + 5km de tampon en UTM 30 pour le chemin p194</span></a>
<a class="sourceLine" id="cb7-344" data-line-number="344">TGO.EXT<span class="fl">.30</span> &lt;-<span class="st"> </span><span class="kw">extent</span>(<span class="kw">spTransform</span>(TGO, UTM<span class="fl">.30</span>)) <span class="op">+</span><span class="st"> </span><span class="dv">10000</span></a>
<a class="sourceLine" id="cb7-345" data-line-number="345"></a>
<a class="sourceLine" id="cb7-346" data-line-number="346"><span class="co"># Pour chaque ensembles d&#39;images (année/chemin), en parallèle, ...</span></a>
<a class="sourceLine" id="cb7-347" data-line-number="347"><span class="kw">registerDoParallel</span>(CORES<span class="dv">-1</span>)</a>
<a class="sourceLine" id="cb7-348" data-line-number="348"><span class="kw">foreach</span>(<span class="dt">i=</span><span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(in.image.list)) <span class="op">%dopar%</span><span class="st"> </span>{ </a>
<a class="sourceLine" id="cb7-349" data-line-number="349">  </a>
<a class="sourceLine" id="cb7-350" data-line-number="350">  <span class="co"># ... extraire la liste des images à traiter</span></a>
<a class="sourceLine" id="cb7-351" data-line-number="351">  in.image.dirs &lt;-<span class="st"> </span>in.image.list[[i]]</a>
<a class="sourceLine" id="cb7-352" data-line-number="352">  </a>
<a class="sourceLine" id="cb7-353" data-line-number="353">  name &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">strsplit</span>(<span class="kw">names</span>(in.image.list[i]), <span class="st">&quot;[.]&quot;</span>))</a>
<a class="sourceLine" id="cb7-354" data-line-number="354">  path &lt;-<span class="st"> </span>name[<span class="dv">1</span>]   <span class="co"># p.ex. &quot;p192&quot;</span></a>
<a class="sourceLine" id="cb7-355" data-line-number="355">  year &lt;-<span class="st"> </span>name[<span class="dv">2</span>]   <span class="co"># p.ex. &quot;1986&quot;</span></a>
<a class="sourceLine" id="cb7-356" data-line-number="356">  tile &lt;-<span class="st"> </span>name[<span class="dv">3</span>]   <span class="co"># p.ex. &quot;NA&quot; (ou 1,2, ...)</span></a>
<a class="sourceLine" id="cb7-357" data-line-number="357">  </a>
<a class="sourceLine" id="cb7-358" data-line-number="358">  <span class="co"># ... étendue UTM 30 pour chemin p194 et UTM 31 pour les autres</span></a>
<a class="sourceLine" id="cb7-359" data-line-number="359">  <span class="cf">if</span>(path <span class="op">==</span><span class="st"> &quot;p194&quot;</span>) tmp.ext &lt;-<span class="st"> </span>TGO.EXT<span class="fl">.30</span> <span class="cf">else</span> tmp.ext &lt;-<span class="st"> </span>TGO.EXT</a>
<a class="sourceLine" id="cb7-360" data-line-number="360">  </a>
<a class="sourceLine" id="cb7-361" data-line-number="361">  <span class="co"># ... répertoire pour sauvegarder l&#39;image</span></a>
<a class="sourceLine" id="cb7-362" data-line-number="362">  out.image.dir &lt;-<span class="st"> </span><span class="kw">paste0</span>(OUT.DIR, <span class="st">&quot;/&quot;</span>, path)</a>
<a class="sourceLine" id="cb7-363" data-line-number="363">  <span class="cf">if</span>(<span class="op">!</span><span class="kw">dir.exists</span>(out.image.dir)) <span class="kw">dir.create</span>(out.image.dir)</a>
<a class="sourceLine" id="cb7-364" data-line-number="364">  </a>
<a class="sourceLine" id="cb7-365" data-line-number="365">  <span class="co"># ... nom du fichier</span></a>
<a class="sourceLine" id="cb7-366" data-line-number="366">  <span class="cf">if</span>(<span class="kw">is.na</span>(tile)) {</a>
<a class="sourceLine" id="cb7-367" data-line-number="367">    filename &lt;-<span class="st"> </span><span class="kw">paste0</span>(out.image.dir, <span class="st">&quot;/&quot;</span>, path, <span class="st">&quot;_&quot;</span>, year, <span class="st">&quot;.tif&quot;</span>)</a>
<a class="sourceLine" id="cb7-368" data-line-number="368">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb7-369" data-line-number="369">    filename &lt;-<span class="st"> </span><span class="kw">paste0</span>(out.image.dir, <span class="st">&quot;/&quot;</span>, path, <span class="st">&quot;_&quot;</span>, year, <span class="st">&quot;_&quot;</span>, tile, <span class="st">&quot;.tif&quot;</span>)</a>
<a class="sourceLine" id="cb7-370" data-line-number="370">  }</a>
<a class="sourceLine" id="cb7-371" data-line-number="371">  </a>
<a class="sourceLine" id="cb7-372" data-line-number="372">  <span class="co"># ... et faire le travail</span></a>
<a class="sourceLine" id="cb7-373" data-line-number="373">  <span class="kw">message</span>(<span class="st">&quot;Processing &quot;</span>, path, <span class="st">&quot;_&quot;</span>, year)</a>
<a class="sourceLine" id="cb7-374" data-line-number="374">  <span class="kw">prepare.landsat</span>(in.image.dirs, </a>
<a class="sourceLine" id="cb7-375" data-line-number="375">                  <span class="dt">ext =</span> tmp.ext, </a>
<a class="sourceLine" id="cb7-376" data-line-number="376">                  <span class="dt">filename =</span> filename, </a>
<a class="sourceLine" id="cb7-377" data-line-number="377">                  <span class="dt">overwrite=</span><span class="ot">FALSE</span>, </a>
<a class="sourceLine" id="cb7-378" data-line-number="378">                  <span class="dt">log=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb7-379" data-line-number="379">  </a>
<a class="sourceLine" id="cb7-380" data-line-number="380">}</a>
<a class="sourceLine" id="cb7-381" data-line-number="381"></a>
<a class="sourceLine" id="cb7-382" data-line-number="382"><span class="co"># Supprimer les fichiers temporaires dans le répertoir tmp</span></a>
<a class="sourceLine" id="cb7-383" data-line-number="383">tmp_dir &lt;-<span class="st"> </span><span class="kw">tempdir</span>()</a>
<a class="sourceLine" id="cb7-384" data-line-number="384">files &lt;-<span class="st"> </span><span class="kw">list.files</span>(tmp_dir, <span class="dt">full.names =</span> T, <span class="dt">recursive=</span>T)</a>
<a class="sourceLine" id="cb7-385" data-line-number="385"><span class="kw">file.remove</span>(files)</a>
<a class="sourceLine" id="cb7-386" data-line-number="386"></a>
<a class="sourceLine" id="cb7-387" data-line-number="387"><span class="co"># Fusionner les fichiers journaux </span></a>
<a class="sourceLine" id="cb7-388" data-line-number="388"><span class="cf">for</span>(dir <span class="cf">in</span> <span class="kw">dir</span>(<span class="kw">paste0</span>(OUT.DIR), <span class="dt">full.names=</span><span class="ot">TRUE</span>)) {</a>
<a class="sourceLine" id="cb7-389" data-line-number="389">  path &lt;-<span class="st"> </span><span class="kw">basename</span>(dir)</a>
<a class="sourceLine" id="cb7-390" data-line-number="390">  <span class="kw">system</span>(<span class="kw">paste0</span>(<span class="st">&quot;tail -n +1 &quot;</span>, dir, <span class="st">&quot;/*.log &gt; &quot;</span>, dir, <span class="st">&quot;/&quot;</span>, path, <span class="st">&quot;.tmp&quot;</span>))</a>
<a class="sourceLine" id="cb7-391" data-line-number="391">  <span class="kw">system</span>(<span class="kw">paste0</span>(<span class="st">&quot;rm &quot;</span>, dir, <span class="st">&quot;/*.log&quot;</span>))</a>
<a class="sourceLine" id="cb7-392" data-line-number="392">  <span class="kw">system</span>(<span class="kw">paste0</span>(<span class="st">&quot;mv &quot;</span>, dir, <span class="st">&quot;/&quot;</span>, path, <span class="st">&quot;.tmp &quot;</span>, dir, <span class="st">&quot;/&quot;</span>, path, <span class="st">&quot;.log&quot;</span>))</a>
<a class="sourceLine" id="cb7-393" data-line-number="393">}</a>
<a class="sourceLine" id="cb7-394" data-line-number="394"></a>
<a class="sourceLine" id="cb7-395" data-line-number="395"></a>
<a class="sourceLine" id="cb7-396" data-line-number="396"><span class="co"># Reprojection des images p194 de UTM 30 à UTM 31 =============================</span></a>
<a class="sourceLine" id="cb7-397" data-line-number="397">p194.dir  &lt;-<span class="st"> </span><span class="kw">paste0</span>(OUT.DIR, <span class="st">&quot;/p194&quot;</span>)</a>
<a class="sourceLine" id="cb7-398" data-line-number="398"></a>
<a class="sourceLine" id="cb7-399" data-line-number="399"><span class="co"># Pour chaque image p194, en parallèle, ...</span></a>
<a class="sourceLine" id="cb7-400" data-line-number="400"><span class="kw">registerDoParallel</span>(CORES<span class="dv">-1</span>)</a>
<a class="sourceLine" id="cb7-401" data-line-number="401"><span class="kw">foreach</span>(<span class="dt">image=</span><span class="kw">dir</span>(p194.dir, <span class="dt">pattern=</span><span class="st">&quot;.*[.]tif$&quot;</span>)) <span class="op">%dopar%</span><span class="st"> </span>{</a>
<a class="sourceLine" id="cb7-402" data-line-number="402">  </a>
<a class="sourceLine" id="cb7-403" data-line-number="403">  image  &lt;-<span class="st"> </span><span class="kw">paste0</span>(p194.dir,  <span class="st">&quot;/&quot;</span>, image)</a>
<a class="sourceLine" id="cb7-404" data-line-number="404">  image.utm30 &lt;-<span class="st"> </span><span class="kw">sub</span>(<span class="st">&quot;[.]tif$&quot;</span>, <span class="st">&quot;utm30.tif&quot;</span>, image)</a>
<a class="sourceLine" id="cb7-405" data-line-number="405">  <span class="kw">file.rename</span>(image, image.utm30)</a>
<a class="sourceLine" id="cb7-406" data-line-number="406">  </a>
<a class="sourceLine" id="cb7-407" data-line-number="407">  <span class="co"># ... transformer l&#39;image en utilisant l&#39;outil externe &quot;gdalwarp&quot;</span></a>
<a class="sourceLine" id="cb7-408" data-line-number="408">  <span class="kw">system</span>(<span class="kw">paste</span>(<span class="st">&quot;gdalwarp&quot;</span>,</a>
<a class="sourceLine" id="cb7-409" data-line-number="409">               image.utm30,</a>
<a class="sourceLine" id="cb7-410" data-line-number="410">               <span class="st">&quot;-t_srs &#39;+proj=utm +zone=31 +datum=WGS84&#39;&quot;</span>,</a>
<a class="sourceLine" id="cb7-411" data-line-number="411">               <span class="st">&quot;-tr 30 30&quot;</span>,</a>
<a class="sourceLine" id="cb7-412" data-line-number="412">               <span class="st">&quot;-te 147255 1017495 222165 1238265&quot;</span>,</a>
<a class="sourceLine" id="cb7-413" data-line-number="413">               image,</a>
<a class="sourceLine" id="cb7-414" data-line-number="414">               <span class="st">&quot;-ot &#39;Int16&#39;&quot;</span>,</a>
<a class="sourceLine" id="cb7-415" data-line-number="415">               <span class="st">&quot;-overwrite&quot;</span>))</a>
<a class="sourceLine" id="cb7-416" data-line-number="416">  </a>
<a class="sourceLine" id="cb7-417" data-line-number="417">  <span class="co"># ... supprimer l&#39;image UTM 30</span></a>
<a class="sourceLine" id="cb7-418" data-line-number="418">  <span class="kw">file.remove</span>(image.utm30)</a>
<a class="sourceLine" id="cb7-419" data-line-number="419">}</a>
<a class="sourceLine" id="cb7-420" data-line-number="420"></a>
<a class="sourceLine" id="cb7-421" data-line-number="421"></a>
<a class="sourceLine" id="cb7-422" data-line-number="422"><span class="co"># Masquer images avec bande de qualité (nuages/ombres) ========================</span></a>
<a class="sourceLine" id="cb7-423" data-line-number="423"><span class="kw">registerDoParallel</span>(CORES<span class="dv">-1</span>)</a>
<a class="sourceLine" id="cb7-424" data-line-number="424"><span class="kw">foreach</span>(<span class="dt">file=</span><span class="kw">dir</span>(OUT.DIR, <span class="dt">pattern=</span><span class="st">&quot;.*</span><span class="ch">\\</span><span class="st">_[[:digit:]]+</span><span class="ch">\\</span><span class="st">.tif$&quot;</span>, <span class="dt">full.names =</span> <span class="ot">TRUE</span>, <span class="dt">recursive=</span><span class="ot">TRUE</span>)) <span class="op">%dopar%</span><span class="st"> </span>{</a>
<a class="sourceLine" id="cb7-425" data-line-number="425">  qa    &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="kw">dir</span>(<span class="kw">dirname</span>(file), <span class="dt">pattern=</span><span class="kw">gsub</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">_&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">_&quot;</span>, <span class="kw">sub</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">.tif&quot;</span>, <span class="st">&quot;_qa*&quot;</span>, <span class="kw">basename</span>(file))), <span class="dt">full.names=</span><span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb7-426" data-line-number="426">  image &lt;-<span class="st"> </span><span class="kw">mask</span>(<span class="kw">brick</span>(file), qa <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(QA.CLOUD, QA.SHADOW, QA.WATER, QA.ICE), <span class="dt">maskvalue=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb7-427" data-line-number="427">  <span class="kw">writeRaster</span>(image, <span class="kw">sub</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">.tif&quot;</span>, <span class="st">&quot;_m.tif&quot;</span>, file), <span class="dt">overwrite =</span> <span class="ot">TRUE</span>, <span class="dt">datatype=</span><span class="st">&quot;INT2S&quot;</span>, <span class="dt">options=</span><span class="kw">c</span>(<span class="st">&quot;COMPRESS=NONE&quot;</span>))</a>
<a class="sourceLine" id="cb7-428" data-line-number="428">}</a>
<a class="sourceLine" id="cb7-429" data-line-number="429"></a>
<a class="sourceLine" id="cb7-430" data-line-number="430"></a>
<a class="sourceLine" id="cb7-431" data-line-number="431"><span class="co"># Créer des vignettes de chaque image =========================================</span></a>
<a class="sourceLine" id="cb7-432" data-line-number="432"><span class="kw">registerDoParallel</span>(CORES<span class="dv">-1</span>)</a>
<a class="sourceLine" id="cb7-433" data-line-number="433"><span class="kw">foreach</span>(<span class="dt">filename=</span><span class="kw">dir</span>(OUT.DIR, <span class="dt">pattern=</span><span class="st">&quot;p19.*[.]tif$&quot;</span>, <span class="dt">recursive=</span><span class="ot">TRUE</span>, <span class="dt">full.names=</span><span class="ot">TRUE</span>)) <span class="op">%dopar%</span><span class="st"> </span>{</a>
<a class="sourceLine" id="cb7-434" data-line-number="434">  image &lt;-<span class="st"> </span><span class="kw">brick</span>(filename)</a>
<a class="sourceLine" id="cb7-435" data-line-number="435">  <span class="kw">jpeg</span>(<span class="kw">sub</span>(<span class="st">&quot;[.]tif$&quot;</span>, <span class="st">&quot;.jpeg&quot;</span>, filename), <span class="dt">width=</span><span class="dv">1350</span>, <span class="dt">height=</span><span class="dv">3000</span>)</a>
<a class="sourceLine" id="cb7-436" data-line-number="436">  <span class="kw">par</span>(<span class="dt">plt=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb7-437" data-line-number="437">  <span class="kw">plot</span>(<span class="kw">spTransform</span>(TGO, UTM<span class="fl">.31</span>))</a>
<a class="sourceLine" id="cb7-438" data-line-number="438">  <span class="kw">plotRGB</span>(image, <span class="dt">r=</span><span class="dv">6</span>, <span class="dt">g=</span><span class="dv">5</span>, <span class="dt">b=</span><span class="dv">3</span>, <span class="dt">stretch=</span><span class="st">&quot;lin&quot;</span>, <span class="dt">add=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb7-439" data-line-number="439">  <span class="kw">plot</span>(<span class="kw">mask</span>(image[[<span class="dv">1</span>]], <span class="kw">spTransform</span>(TGO, UTM<span class="fl">.31</span>), <span class="dt">inverse=</span><span class="ot">TRUE</span>), <span class="dt">col=</span><span class="st">&quot;#FFFFFF66&quot;</span>, <span class="dt">legend=</span><span class="ot">FALSE</span>, <span class="dt">add=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb7-440" data-line-number="440">  <span class="kw">plot</span>(<span class="kw">spTransform</span>(TGO, UTM<span class="fl">.31</span>), <span class="dt">add=</span><span class="ot">TRUE</span>, <span class="dt">lwd=</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb7-441" data-line-number="441">  <span class="kw">dev.off</span>()</a>
<a class="sourceLine" id="cb7-442" data-line-number="442">}</a></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="00_STSS.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="02_Worldclim.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"search": true,
"info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
