<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4.1.4 Analyse de la précision | _main.utf8</title>
  <meta name="description" content="République Togolaise —<br />
Système Nationale de Surveillance des Forêts</div>" />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="4.1.4 Analyse de la précision | _main.utf8" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://ogardi.github.io/SNSF-Togo" />
  <meta property="og:image" content="https://ogardi.github.io/SNSF-Togoimages/NERF-Togo.png" />
  
  <meta name="github-repo" content="ogardi/NERF-Togo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4.1.4 Analyse de la précision | _main.utf8" />
  
  
  <meta name="twitter:image" content="https://ogardi.github.io/SNSF-Togoimages/NERF-Togo.png" />

<meta name="author" content="Oliver Gardi, Fifonsi Dangbo, Sophie Dzigbod, Ditorgue Bakabima" />


<meta name="date" content="2020-06-03" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="03_validate-FC-maps.html"/>
<link rel="next" href="05_analyse-FC-maps.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/kePrint-0.0.1/kePrint.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { background-color: #f8f8f8; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://ogardi.github.io/SNSF-Togo"><b>Manuel SNSF Togo</b><br>NRF v1.1 ( <i>en révision</i> )</a></li>
<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Préface</a></li>
<li class="chapter" data-level="1" data-path="00_introduction.html"><a href="00_introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="01_arrangements.html"><a href="01_arrangements.html"><i class="fa fa-check"></i><b>1.1</b> Arrangements institutionelles</a></li>
<li class="chapter" data-level="1.2" data-path="02_how-to.html"><a href="02_how-to.html"><i class="fa fa-check"></i><b>1.2</b> Pour commencer</a><ul>
<li class="chapter" data-level="1.2.1" data-path="02_how-to.html"><a href="02_how-to.html#travailler-avec-le-snsf"><i class="fa fa-check"></i><b>1.2.1</b> Travailler avec le SNSF</a></li>
<li class="chapter" data-level="1.2.2" data-path="03_commencer.html"><a href="03_commencer.html"><i class="fa fa-check"></i><b>1.2.2</b> Structure du répértoire</a></li>
<li class="chapter" data-level="1.2.3" data-path="03_commencer.html"><a href="03_commencer.html#creation-dun-nouveau-projet"><i class="fa fa-check"></i><b>1.2.3</b> Création d’un nouveau projet</a></li>
<li class="chapter" data-level="1.2.4" data-path="03_commencer.html"><a href="03_commencer.html#NRF-set-up.R"><i class="fa fa-check"></i><b>1.2.4</b> Définition des variables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="00_STSS.html"><a href="00_STSS.html"><i class="fa fa-check"></i><b>2</b> Système de Surveillance Terrestre</a><ul>
<li class="chapter" data-level="2.1" data-path="01_Landsat.html"><a href="01_Landsat.html"><i class="fa fa-check"></i><b>2.1</b> Données de base</a><ul>
<li class="chapter" data-level="2.1.1" data-path="01_Landsat.html"><a href="01_Landsat.html#SSTS-Landsat"><i class="fa fa-check"></i><b>2.1.1</b> Images Landsat</a></li>
<li class="chapter" data-level="2.1.2" data-path="02_Worldclim.html"><a href="02_Worldclim.html"><i class="fa fa-check"></i><b>2.1.2</b> WorldClim</a></li>
<li class="chapter" data-level="2.1.3" data-path="03_SRTM.html"><a href="03_SRTM.html"><i class="fa fa-check"></i><b>2.1.3</b> SRTM</a></li>
<li class="chapter" data-level="2.1.4" data-path="04_SoilGrids.html"><a href="04_SoilGrids.html"><i class="fa fa-check"></i><b>2.1.4</b> SoilGrids</a></li>
<li class="chapter" data-level="2.1.5" data-path="05_ProREDD.html"><a href="05_ProREDD.html"><i class="fa fa-check"></i><b>2.1.5</b> ProREDD</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="01_sampling-grid.html"><a href="01_sampling-grid.html"><i class="fa fa-check"></i><b>2.2</b> Collecte des données</a><ul>
<li class="chapter" data-level="2.2.1" data-path="01_sampling-grid.html"><a href="01_sampling-grid.html#reseau-dechantillonnage"><i class="fa fa-check"></i><b>2.2.1</b> Réseau d’échantillonnage</a></li>
<li class="chapter" data-level="2.2.2" data-path="02_training-plots.html"><a href="02_training-plots.html"><i class="fa fa-check"></i><b>2.2.2</b> Parcelles d’entraînement</a></li>
<li class="chapter" data-level="2.2.3" data-path="03_validation-plots.html"><a href="03_validation-plots.html"><i class="fa fa-check"></i><b>2.2.3</b> Parcelles de validation</a></li>
<li class="chapter" data-level="2.2.4" data-path="04_outil-QGIS.html"><a href="04_outil-QGIS.html"><i class="fa fa-check"></i><b>2.2.4</b> Outil QGIS</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="00_IFN.html"><a href="00_IFN.html"><i class="fa fa-check"></i><b>3</b> Inventaire Forestier National</a><ul>
<li class="chapter" data-level="3.1" data-path="01_IFN-1.html"><a href="01_IFN-1.html"><i class="fa fa-check"></i><b>3.1</b> IFN-1 (2015/16)</a><ul>
<li class="chapter" data-level="3.1.1" data-path="01_IFN-1.html"><a href="01_IFN-1.html#methode"><i class="fa fa-check"></i><b>3.1.1</b> <span>Méthode</span></a></li>
<li class="chapter" data-level="3.1.2" data-path="01_IFN-1.html"><a href="01_IFN-1.html#donnees"><i class="fa fa-check"></i><b>3.1.2</b> Données</a></li>
<li class="chapter" data-level="3.1.3" data-path="01_IFN-1.html"><a href="01_IFN-1.html#resultats"><i class="fa fa-check"></i><b>3.1.3</b> <span>Résultats</span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="00_NRF-MRV.html"><a href="00_NRF-MRV.html"><i class="fa fa-check"></i><b>4</b> Analyses NRF/MRV</a><ul>
<li class="chapter" data-level="4.1" data-path="00_analyse-FCC.html"><a href="00_analyse-FCC.html"><i class="fa fa-check"></i><b>4.1</b> Analyse surfaces forestiers</a><ul>
<li class="chapter" data-level="4.1.1" data-path="01_create-FC-maps.html"><a href="01_create-FC-maps.html"><i class="fa fa-check"></i><b>4.1.1</b> Production des cartes Forêt/Non-Forêt</a></li>
<li class="chapter" data-level="4.1.2" data-path="02_clean-FC-maps.html"><a href="02_clean-FC-maps.html"><i class="fa fa-check"></i><b>4.1.2</b> Nettoyage des cartes brutes</a></li>
<li class="chapter" data-level="4.1.3" data-path="03_validate-FC-maps.html"><a href="03_validate-FC-maps.html"><i class="fa fa-check"></i><b>4.1.3</b> Validation des cartes</a></li>
<li class="chapter" data-level="4.1.4" data-path="04_FC-maps-accuracy.html"><a href="04_FC-maps-accuracy.html"><i class="fa fa-check"></i><b>4.1.4</b> Analyse de la précision</a></li>
<li class="chapter" data-level="4.1.5" data-path="05_analyse-FC-maps.html"><a href="05_analyse-FC-maps.html"><i class="fa fa-check"></i><b>4.1.5</b> Analyse des cartes</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="00_analyse-AGB.html"><a href="00_analyse-AGB.html"><i class="fa fa-check"></i><b>4.2</b> Analyse biomasse aérienne</a><ul>
<li class="chapter" data-level="4.2.1" data-path="01_compile-IFN.html"><a href="01_compile-IFN.html"><i class="fa fa-check"></i><b>4.2.1</b> Analyse des données IFN</a></li>
<li class="chapter" data-level="4.2.2" data-path="02_create-AGB-maps.html"><a href="02_create-AGB-maps.html"><i class="fa fa-check"></i><b>4.2.2</b> Calibration et prédiction</a></li>
<li class="chapter" data-level="4.2.3" data-path="03_clean-AGB-maps.html"><a href="03_clean-AGB-maps.html"><i class="fa fa-check"></i><b>4.2.3</b> Nettoyage des cartes brutes</a></li>
<li class="chapter" data-level="4.2.4" data-path="04_analyze-AGB-maps.html"><a href="04_analyze-AGB-maps.html"><i class="fa fa-check"></i><b>4.2.4</b> Production des résultats</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/ogardi/SNSF-Togo">Dépôt du code sur GitHub</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><div class="line-block">République Togolaise —<br />
Système Nationale de Surveillance des Forêts</div></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="FCC-map-precision" class="section level3">
<h3><span class="header-section-number">4.1.4</span> Analyse de la précision</h3>
<p>La précision des cartes est déterminée selon la procédure de <a href="https://www.sciencedirect.com/science/article/abs/pii/S0034425714000704">Olofsson et al. (2014)</a>. Le script utilisé est basé sur une <a href="https://github.com/openforis/accuracy-assessment/blob/master/Rscripts/error_matrix_analysis.R">implémentation des méthodes dans OpenForis</a>.</p>
<p>Le calcul de la précision se fait sur la matrice d’erreur d’une part et les surfaces couvertes par les catégories correspondantes d’autre part. Avec les informations sur les surfaces, la matrice d’erreur est extrapolée en une <strong>matrice d’erreur proportionnelle</strong>, qui indique dans les cellules les proportions de la surface totale. Sur cette base les indices de précision sont calculés: concrètement la précision globale, le Kappa de Cohen, la précision du producteur et la précision de l’utilisateur, y compris la variance et l’intervalle de confiance à 95 %. D’autre part, la matrice d’erreur proportionnelle est extrapolée à la superficie totale pour obtenir des estimations de superficie des différentes catégories, y compris les erreurs types et les intervalles de confiance.</p>
<div id="example-5" class="section level4 unnumbered">
<h4>Example</h4>
<p><strong>Le nombre de pixels cartographiés et matrice d’erreur des transitions de l’occupation du sol 2003 – 2018</strong>. Dans les colonnes sont les classes attribuées par les photo-interprètes, dans les lignes les classes selon les cartes forêt/non-forêt nettoyées.</p>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Pixels</th>
<th align="right">xFxF</th>
<th align="right">xFxN</th>
<th align="right">xNxF</th>
<th align="right">xNxN</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><strong>xFxF</strong></td>
<td align="right">12 590 594</td>
<td align="right"><strong>536</strong></td>
<td align="right">52</td>
<td align="right">80</td>
<td align="right">105</td>
</tr>
<tr class="even">
<td align="left"><strong>xFxN</strong></td>
<td align="right">2 509 971</td>
<td align="right">36</td>
<td align="right"><strong>80</strong></td>
<td align="right">3</td>
<td align="right">52</td>
</tr>
<tr class="odd">
<td align="left"><strong>xNxF</strong></td>
<td align="right">1 637 331</td>
<td align="right">23</td>
<td align="right">0</td>
<td align="right"><strong>73</strong></td>
<td align="right">29</td>
</tr>
<tr class="even">
<td align="left"><strong>xNxN</strong></td>
<td align="right">46 599 650</td>
<td align="right">35</td>
<td align="right">84</td>
<td align="right">50</td>
<td align="right"><strong>1175</strong></td>
</tr>
</tbody>
</table>
<p><strong>La matrice d’erreur proportionelle aux surfaces cartographiées</strong>. La somme de tous les cellules est 1 (100%).</p>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th></th>
<th align="right">xFxF</th>
<th align="right">xFxN</th>
<th align="right">xNxF</th>
<th align="right">xNxN</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><strong>xFxF</strong></td>
<td>                   </td>
<td align="right"><strong>0.138</strong></td>
<td align="right">0.013</td>
<td align="right">0.021</td>
<td align="right">0.027</td>
</tr>
<tr class="even">
<td align="left"><strong>xFxN</strong></td>
<td></td>
<td align="right">0.008</td>
<td align="right"><strong>0.019</strong></td>
<td align="right">0.001</td>
<td align="right">0.012</td>
</tr>
<tr class="odd">
<td align="left"><strong>xNxF</strong></td>
<td></td>
<td align="right">0.005</td>
<td align="right">0</td>
<td align="right"><strong>0.015</strong></td>
<td align="right">0.006</td>
</tr>
<tr class="even">
<td align="left"><strong>xNxN</strong></td>
<td></td>
<td align="right">0.019</td>
<td align="right">0.046</td>
<td align="right">0.027</td>
<td align="right"><strong>0.643</strong></td>
</tr>
</tbody>
</table>
<p>Les <strong>indices de précision globales</strong> sont:</p>
<ul>
<li><p>Précision globale: 81.5% (± 1.5% intervalle de confiance)</p></li>
<li><p>Cohen’s Kappa: 59.3%</p></li>
</ul>
<p><strong>Indices de précision et le surfaces estimées par catégories</strong> (± intervalle de confiance à 95%)</p>
<table>
<colgroup>
<col width="9%" />
<col width="16%" />
<col width="13%" />
<col width="13%" />
<col width="16%" />
<col width="15%" />
<col width="18%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Surface cartes</th>
<th align="right">Prop. cartes</th>
<th align="right">Proportion ajustée</th>
<th align="right">Surface ajustée</th>
<th align="right">Précision utilisateur</th>
<th align="right">Précision producteur</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><strong>xFxF</strong></td>
<td align="right">1’133’153</td>
<td align="right">0.20</td>
<td align="right">0.17 ± 0.01</td>
<td align="right">969’621 ± 54’104</td>
<td align="right">0.69 ± 0.03</td>
<td align="right">0.81 ± 0.03</td>
</tr>
<tr class="even">
<td align="left"><strong>xFxN</strong></td>
<td align="right">225’897</td>
<td align="right">0.04</td>
<td align="right">0.08 ± 0.01</td>
<td align="right">444’034 ± 60’300</td>
<td align="right">0.47 ± 0.08</td>
<td align="right">0.24 ± 0.04</td>
</tr>
<tr class="odd">
<td align="left"><strong>xNxF</strong></td>
<td align="right">147’360</td>
<td align="right">0.03</td>
<td align="right">0.06 ± 0.01</td>
<td align="right">363’320 ± 50’777</td>
<td align="right">0.58 ± 0.09</td>
<td align="right">0.24 ± 0.04</td>
</tr>
<tr class="even">
<td align="left"><strong>xNxN</strong></td>
<td align="right">4’193’969</td>
<td align="right">0.74</td>
<td align="right">0.69 ± 0.01</td>
<td align="right">3’923’405 ± 81’517</td>
<td align="right">0.87 ± 0.02</td>
<td align="right">0.94 ± 0.01</td>
</tr>
</tbody>
</table>
</div>
<div id="mcf04_fc-maps-accuracy.r" class="section level4 unnumbered">
<h4><em>MCF/04_fc-maps-accuracy.R</em></h4>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="co">##########################################################################</span></a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="co"># NERF_Togo/FCC/7_fc-maps-accuracy.R: validate clean forest cover maps</span></a>
<a class="sourceLine" id="cb19-3" data-line-number="3"><span class="co"># ------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb19-4" data-line-number="4"><span class="co"># Bern University of Applied Sciences</span></a>
<a class="sourceLine" id="cb19-5" data-line-number="5"><span class="co"># Oliver Gardi, &lt;oliver.gardi@bfh.ch&gt;</span></a>
<a class="sourceLine" id="cb19-6" data-line-number="6"><span class="co"># 20 May 2019</span></a>
<a class="sourceLine" id="cb19-7" data-line-number="7"></a>
<a class="sourceLine" id="cb19-8" data-line-number="8"><span class="co"># based on OpenForis implementation of Olofsson et al. (2014), written by</span></a>
<a class="sourceLine" id="cb19-9" data-line-number="9"><span class="co"># Antonia Ortmann, 20 October, 2014</span></a>
<a class="sourceLine" id="cb19-10" data-line-number="10"><span class="co"># Source: https://github.com/openforis/accuracy-assessment/blob/master/Rscripts/error_matrix_analysis.R</span></a>
<a class="sourceLine" id="cb19-11" data-line-number="11"></a>
<a class="sourceLine" id="cb19-12" data-line-number="12">VALSET &lt;-<span class="st"> &quot;FC30_flex&quot;</span></a>
<a class="sourceLine" id="cb19-13" data-line-number="13"></a>
<a class="sourceLine" id="cb19-14" data-line-number="14"><span class="co"># Function for estimating accuracies ----------------------------------</span></a>
<a class="sourceLine" id="cb19-15" data-line-number="15">  </a>
<a class="sourceLine" id="cb19-16" data-line-number="16">accuracy.estimate &lt;-<span class="st"> </span><span class="cf">function</span>(areas.map, error.matrix, <span class="dt">filename=</span><span class="ot">NULL</span>, <span class="dt">pixelsize=</span><span class="dv">30</span><span class="op">^</span><span class="dv">2</span><span class="op">/</span><span class="dv">10000</span>) {</a>
<a class="sourceLine" id="cb19-17" data-line-number="17">  </a>
<a class="sourceLine" id="cb19-18" data-line-number="18">  <span class="co"># remove &quot;x&quot; from the category </span></a>
<a class="sourceLine" id="cb19-19" data-line-number="19">  <span class="kw">colnames</span>(error.matrix) &lt;-<span class="st"> </span><span class="kw">rownames</span>(error.matrix) &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="kw">colnames</span>(error.matrix))</a>
<a class="sourceLine" id="cb19-20" data-line-number="20">  </a>
<a class="sourceLine" id="cb19-21" data-line-number="21">  <span class="co"># match category order</span></a>
<a class="sourceLine" id="cb19-22" data-line-number="22">  maparea         &lt;-<span class="st"> </span>areas.map[<span class="kw">match</span>(<span class="kw">rownames</span>(error.matrix), <span class="kw">names</span>(areas.map))]</a>
<a class="sourceLine" id="cb19-23" data-line-number="23">  ma              &lt;-<span class="st"> </span>error.matrix</a>
<a class="sourceLine" id="cb19-24" data-line-number="24">  dyn             &lt;-<span class="st"> </span><span class="kw">names</span>(maparea)</a>
<a class="sourceLine" id="cb19-25" data-line-number="25">  </a>
<a class="sourceLine" id="cb19-26" data-line-number="26">  <span class="co"># calculate the area proportions for each map class</span></a>
<a class="sourceLine" id="cb19-27" data-line-number="27">  aoi &lt;-<span class="st"> </span><span class="kw">sum</span>(maparea)</a>
<a class="sourceLine" id="cb19-28" data-line-number="28">  propmaparea &lt;-<span class="st"> </span>maparea<span class="op">/</span>aoi</a>
<a class="sourceLine" id="cb19-29" data-line-number="29">  </a>
<a class="sourceLine" id="cb19-30" data-line-number="30">  <span class="co"># convert the absolute cross tab into a probability cross tab</span></a>
<a class="sourceLine" id="cb19-31" data-line-number="31">  ni. &lt;-<span class="st"> </span><span class="kw">rowSums</span>(ma)                  <span class="co"># number of reference points per map class</span></a>
<a class="sourceLine" id="cb19-32" data-line-number="32">  propma &lt;-<span class="st">  </span><span class="kw">as.matrix</span>(ma<span class="op">/</span>ni. <span class="op">*</span><span class="st"> </span><span class="kw">as.vector</span>(propmaparea))</a>
<a class="sourceLine" id="cb19-33" data-line-number="33">  propma[<span class="kw">is.nan</span>(propma)] &lt;-<span class="st"> </span><span class="dv">0</span>          <span class="co"># for classes with ni. = 0</span></a>
<a class="sourceLine" id="cb19-34" data-line-number="34">  </a>
<a class="sourceLine" id="cb19-35" data-line-number="35">  <span class="co"># estimate the accuracies now</span></a>
<a class="sourceLine" id="cb19-36" data-line-number="36">  OA &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">diag</span>(propma))              <span class="co"># overall accuracy (Eq. 1 in Olofsson et al. 2014)</span></a>
<a class="sourceLine" id="cb19-37" data-line-number="37">  pe &lt;-<span class="st"> </span><span class="dv">0</span>                              <span class="co"># Agreement by chance ...</span></a>
<a class="sourceLine" id="cb19-38" data-line-number="38">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(dyn)) {</a>
<a class="sourceLine" id="cb19-39" data-line-number="39">    pe &lt;-<span class="st"> </span>pe <span class="op">+</span><span class="st"> </span><span class="kw">sum</span>(propma[i,]) <span class="op">*</span><span class="st"> </span><span class="kw">sum</span>(propma[,i])</a>
<a class="sourceLine" id="cb19-40" data-line-number="40">  }</a>
<a class="sourceLine" id="cb19-41" data-line-number="41">  K  &lt;-<span class="st"> </span>(OA <span class="op">-</span><span class="st"> </span>pe) <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>pe)           <span class="co"># ... for Cohen&#39;s Kappa</span></a>
<a class="sourceLine" id="cb19-42" data-line-number="42">  UA &lt;-<span class="st"> </span><span class="kw">diag</span>(propma) <span class="op">/</span><span class="st"> </span><span class="kw">rowSums</span>(propma) <span class="co"># user&#39;s accuracy (Eq. 2 in Olofsson et al. 2014)</span></a>
<a class="sourceLine" id="cb19-43" data-line-number="43">  PA &lt;-<span class="st"> </span><span class="kw">diag</span>(propma) <span class="op">/</span><span class="st"> </span><span class="kw">colSums</span>(propma) <span class="co"># producer&#39;s accuracy (Eq. 3 in Olofsson et al. 2014)</span></a>
<a class="sourceLine" id="cb19-44" data-line-number="44">  </a>
<a class="sourceLine" id="cb19-45" data-line-number="45">  <span class="co"># estimate confidence intervals for the accuracies</span></a>
<a class="sourceLine" id="cb19-46" data-line-number="46">  V_OA &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">as.vector</span>(propmaparea)<span class="op">^</span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>UA <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>UA) <span class="op">/</span><span class="st"> </span>(ni. <span class="op">-</span><span class="st"> </span><span class="dv">1</span>), <span class="dt">na.rm=</span>T)  <span class="co"># variance of overall accuracy (Eq. 5 in Olofsson et al. 2014)</span></a>
<a class="sourceLine" id="cb19-47" data-line-number="47">  V_UA &lt;-<span class="st"> </span>UA <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>UA) <span class="op">/</span><span class="st"> </span>(<span class="kw">rowSums</span>(ma) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="co"># variance of user&#39;s accuracy (Eq. 6 in Olofsson et al. 2014)</span></a>
<a class="sourceLine" id="cb19-48" data-line-number="48">  </a>
<a class="sourceLine" id="cb19-49" data-line-number="49">  <span class="co"># variance of producer&#39;s accuracy (Eq. 7 in Olofsson et al. 2014)</span></a>
<a class="sourceLine" id="cb19-50" data-line-number="50">  N.j &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="dv">0</span>, <span class="dt">dim=</span><span class="kw">length</span>(dyn))</a>
<a class="sourceLine" id="cb19-51" data-line-number="51">  aftersumsign &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="dv">0</span>, <span class="dt">dim=</span><span class="kw">length</span>(dyn))</a>
<a class="sourceLine" id="cb19-52" data-line-number="52">  <span class="cf">for</span>(cj <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(dyn)) {</a>
<a class="sourceLine" id="cb19-53" data-line-number="53">    N.j[cj] &lt;-<span class="st"> </span><span class="kw">sum</span>(maparea <span class="op">/</span><span class="st"> </span>ni. <span class="op">*</span><span class="st"> </span>ma[, cj], <span class="dt">na.rm=</span>T)</a>
<a class="sourceLine" id="cb19-54" data-line-number="54">    aftersumsign[cj] &lt;-<span class="st"> </span><span class="kw">sum</span>(maparea[<span class="op">-</span>cj]<span class="op">^</span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>ma[<span class="op">-</span>cj, cj] <span class="op">/</span><span class="st"> </span>ni.[<span class="op">-</span>cj] <span class="op">*</span><span class="st"> </span>( <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>ma[<span class="op">-</span>cj, cj] <span class="op">/</span><span class="st"> </span>ni.[<span class="op">-</span>cj]) <span class="op">/</span><span class="st"> </span>(ni.[<span class="op">-</span>cj] <span class="op">-</span><span class="st"> </span><span class="dv">1</span>), <span class="dt">na.rm =</span> T)</a>
<a class="sourceLine" id="cb19-55" data-line-number="55">  }</a>
<a class="sourceLine" id="cb19-56" data-line-number="56">  V_PA &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span>N.j<span class="op">^</span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>( </a>
<a class="sourceLine" id="cb19-57" data-line-number="57">    maparea<span class="op">^</span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>PA)<span class="op">^</span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>UA <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>UA) <span class="op">/</span><span class="st"> </span>(ni.<span class="op">-</span><span class="dv">1</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-58" data-line-number="58"><span class="st">      </span>PA<span class="op">^</span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>aftersumsign</a>
<a class="sourceLine" id="cb19-59" data-line-number="59">  ) </a>
<a class="sourceLine" id="cb19-60" data-line-number="60">  V_PA[<span class="kw">is.nan</span>(V_PA)] &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb19-61" data-line-number="61">  </a>
<a class="sourceLine" id="cb19-62" data-line-number="62">  <span class="co"># proportional area estimation</span></a>
<a class="sourceLine" id="cb19-63" data-line-number="63">  propAreaEst &lt;-<span class="st"> </span><span class="kw">colSums</span>(propma)        <span class="co"># proportion of area (Eq. 8 in Olofsson et al. 2014)</span></a>
<a class="sourceLine" id="cb19-64" data-line-number="64">  AreaEst &lt;-<span class="st"> </span>propAreaEst <span class="op">*</span><span class="st"> </span><span class="kw">sum</span>(maparea) <span class="co"># estimated area</span></a>
<a class="sourceLine" id="cb19-65" data-line-number="65">  </a>
<a class="sourceLine" id="cb19-66" data-line-number="66">  <span class="co"># standard errors of the area estimation (Eq. 10 in Olofsson et al. 2014)</span></a>
<a class="sourceLine" id="cb19-67" data-line-number="67">  V_propAreaEst &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="dv">0</span>, <span class="dt">dim=</span><span class="kw">length</span>(dyn))</a>
<a class="sourceLine" id="cb19-68" data-line-number="68">  <span class="cf">for</span> (cj <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(dyn)) {</a>
<a class="sourceLine" id="cb19-69" data-line-number="69">    V_propAreaEst[cj] &lt;-<span class="st"> </span><span class="kw">sum</span>((<span class="kw">as.vector</span>(propmaparea) <span class="op">*</span><span class="st"> </span>propma[, cj] <span class="op">-</span><span class="st"> </span>propma[, cj] <span class="op">^</span><span class="st"> </span><span class="dv">2</span>) <span class="op">/</span><span class="st"> </span>( <span class="kw">rowSums</span>(ma) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>))</a>
<a class="sourceLine" id="cb19-70" data-line-number="70">  }</a>
<a class="sourceLine" id="cb19-71" data-line-number="71">  V_propAreaEst[<span class="kw">is.na</span>(V_propAreaEst)] &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb19-72" data-line-number="72">  </a>
<a class="sourceLine" id="cb19-73" data-line-number="73">  <span class="co"># produce result tables</span></a>
<a class="sourceLine" id="cb19-74" data-line-number="74">  </a>
<a class="sourceLine" id="cb19-75" data-line-number="75">  res &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb19-76" data-line-number="76">  res<span class="op">$</span>PREDICTED_PX      &lt;-<span class="st"> </span><span class="kw">as.table</span>(maparea)</a>
<a class="sourceLine" id="cb19-77" data-line-number="77">  res<span class="op">$</span>ERROR_MATRIX      &lt;-<span class="st"> </span>ma</a>
<a class="sourceLine" id="cb19-78" data-line-number="78">  res<span class="op">$</span>ERROR_MATRIX_PROP &lt;-<span class="st"> </span><span class="kw">round</span>(propma, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb19-79" data-line-number="79">  res<span class="op">$</span>OVERALL_ACC       &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">accuracy=</span><span class="kw">round</span>(<span class="kw">c</span>(OA, K), <span class="dv">3</span>), </a>
<a class="sourceLine" id="cb19-80" data-line-number="80">                                      <span class="dt">CI=</span><span class="kw">round</span>(<span class="kw">c</span>(<span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(V_OA), <span class="ot">NA</span>), <span class="dv">3</span>),</a>
<a class="sourceLine" id="cb19-81" data-line-number="81">                                      <span class="dt">row.names=</span><span class="kw">c</span>(<span class="st">&quot;OA&quot;</span>, <span class="st">&quot;Kappa&quot;</span>))</a>
<a class="sourceLine" id="cb19-82" data-line-number="82">  res<span class="op">$</span>CLASSES_ACC &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">maparea=</span><span class="kw">round</span>(maparea <span class="op">*</span><span class="st"> </span>pixelsize, <span class="dv">3</span>)) <span class="co"># in ha</span></a>
<a class="sourceLine" id="cb19-83" data-line-number="83">  res<span class="op">$</span>CLASSES_ACC<span class="op">$</span>prop_maparea    &lt;-<span class="st"> </span><span class="kw">round</span>(propmaparea, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb19-84" data-line-number="84">  res<span class="op">$</span>CLASSES_ACC<span class="op">$</span>adj_proparea    &lt;-<span class="st"> </span><span class="kw">round</span>(propAreaEst, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb19-85" data-line-number="85">  res<span class="op">$</span>CLASSES_ACC<span class="op">$</span>CI_adj_proparea &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(V_propAreaEst), <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb19-86" data-line-number="86">  res<span class="op">$</span>CLASSES_ACC<span class="op">$</span>adj_area        &lt;-<span class="st"> </span><span class="kw">round</span>(propAreaEst <span class="op">*</span><span class="st"> </span>aoi <span class="op">*</span><span class="st"> </span>pixelsize, <span class="dv">3</span>) <span class="co"># in ha</span></a>
<a class="sourceLine" id="cb19-87" data-line-number="87">  res<span class="op">$</span>CLASSES_ACC<span class="op">$</span>CI_adj_area     &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(V_propAreaEst) <span class="op">*</span><span class="st"> </span>aoi <span class="op">*</span><span class="st"> </span>pixelsize, <span class="dv">3</span>) <span class="co"># in ha</span></a>
<a class="sourceLine" id="cb19-88" data-line-number="88">  res<span class="op">$</span>CLASSES_ACC<span class="op">$</span>UA              &lt;-<span class="st"> </span><span class="kw">round</span>(UA, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb19-89" data-line-number="89">  res<span class="op">$</span>CLASSES_ACC<span class="op">$</span>CI_UA           &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(V_UA), <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb19-90" data-line-number="90">  res<span class="op">$</span>CLASSES_ACC<span class="op">$</span>PA              &lt;-<span class="st"> </span><span class="kw">round</span>(PA, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb19-91" data-line-number="91">  res<span class="op">$</span>CLASSES_ACC<span class="op">$</span>CI_PA           &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(V_PA), <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb19-92" data-line-number="92">  </a>
<a class="sourceLine" id="cb19-93" data-line-number="93">  <span class="co"># write results to Excel File</span></a>
<a class="sourceLine" id="cb19-94" data-line-number="94">  <span class="cf">if</span>(<span class="op">!</span><span class="kw">is.null</span>(filename)) {</a>
<a class="sourceLine" id="cb19-95" data-line-number="95">    <span class="kw">write.xlsx</span>(res,</a>
<a class="sourceLine" id="cb19-96" data-line-number="96">               <span class="dt">file=</span>filename,</a>
<a class="sourceLine" id="cb19-97" data-line-number="97">               <span class="dt">col.names=</span><span class="ot">TRUE</span>, <span class="dt">row.names=</span><span class="ot">TRUE</span>, <span class="dt">overwrite=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb19-98" data-line-number="98">  }</a>
<a class="sourceLine" id="cb19-99" data-line-number="99">  </a>
<a class="sourceLine" id="cb19-100" data-line-number="100">  <span class="kw">return</span>(res)</a>
<a class="sourceLine" id="cb19-101" data-line-number="101">  </a>
<a class="sourceLine" id="cb19-102" data-line-number="102">}</a>
<a class="sourceLine" id="cb19-103" data-line-number="103"></a>
<a class="sourceLine" id="cb19-104" data-line-number="104"></a>
<a class="sourceLine" id="cb19-105" data-line-number="105"><span class="co"># DO THE WORK ----------------------------------</span></a>
<a class="sourceLine" id="cb19-106" data-line-number="106"></a>
<a class="sourceLine" id="cb19-107" data-line-number="107"><span class="co"># load the error matrices (R object ct)</span></a>
<a class="sourceLine" id="cb19-108" data-line-number="108"><span class="kw">load</span>(<span class="kw">paste0</span>(FCC.VAL.DIR, <span class="st">&quot;/ConfTab_&quot;</span>, VALSET, <span class="st">&quot;.RData&quot;</span>))</a>
<a class="sourceLine" id="cb19-109" data-line-number="109"></a>
<a class="sourceLine" id="cb19-110" data-line-number="110"><span class="co"># load the predictions and convert &quot;potential regeneration (2)&quot; to &quot;non-forest (3)&quot;</span></a>
<a class="sourceLine" id="cb19-111" data-line-number="111">fc<span class="fl">.2003</span> &lt;-<span class="st"> </span><span class="kw">brick</span>(<span class="kw">paste0</span>(FCC.CLN.DIR, <span class="st">&quot;/FC30/TGO/TGO_2003_F30cf.tif&quot;</span>)); fc<span class="fl">.2003</span>[fc<span class="fl">.2003</span><span class="op">==</span><span class="dv">2</span>] &lt;-<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb19-112" data-line-number="112">fc<span class="fl">.2015</span> &lt;-<span class="st"> </span><span class="kw">brick</span>(<span class="kw">paste0</span>(FCC.CLN.DIR, <span class="st">&quot;/FC30/TGO/TGO_2015_F30cf.tif&quot;</span>)); fc<span class="fl">.2015</span>[fc<span class="fl">.2015</span><span class="op">==</span><span class="dv">2</span>] &lt;-<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb19-113" data-line-number="113">fc<span class="fl">.2018</span> &lt;-<span class="st"> </span><span class="kw">brick</span>(<span class="kw">paste0</span>(FCC.CLN.DIR, <span class="st">&quot;/FC30/TGO/TGO_2018_F30cf.tif&quot;</span>)); fc<span class="fl">.2018</span>[fc<span class="fl">.2018</span><span class="op">==</span><span class="dv">2</span>] &lt;-<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb19-114" data-line-number="114"></a>
<a class="sourceLine" id="cb19-115" data-line-number="115"><span class="co"># create 3-date transition map </span></a>
<a class="sourceLine" id="cb19-116" data-line-number="116">fcc  &lt;-<span class="st">  </span><span class="dv">100</span> <span class="op">*</span><span class="st"> </span>fc<span class="fl">.2003</span> <span class="op">+</span><span class="st"> </span><span class="dv">10</span> <span class="op">*</span><span class="st"> </span>fc<span class="fl">.2015</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">*</span><span class="st"> </span>fc<span class="fl">.2018</span></a>
<a class="sourceLine" id="cb19-117" data-line-number="117"></a>
<a class="sourceLine" id="cb19-118" data-line-number="118"><span class="co"># get pixel counts (takes time) and separate for different dates / transitions</span></a>
<a class="sourceLine" id="cb19-119" data-line-number="119">freq &lt;-<span class="st"> </span><span class="kw">table</span>(fcc[])</a>
<a class="sourceLine" id="cb19-120" data-line-number="120">tmp &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(freq); <span class="kw">names</span>(tmp) &lt;-<span class="st"> </span><span class="kw">names</span>(freq); freq &lt;-<span class="st"> </span>tmp</a>
<a class="sourceLine" id="cb19-121" data-line-number="121"></a>
<a class="sourceLine" id="cb19-122" data-line-number="122">freq.<span class="dv">03</span>.<span class="fl">15.18</span>        &lt;-<span class="st"> </span><span class="kw">c</span>(freq[<span class="st">&quot;111&quot;</span>], freq[<span class="st">&quot;113&quot;</span>], freq[<span class="st">&quot;131&quot;</span>], freq[<span class="st">&quot;133&quot;</span>], freq[<span class="st">&quot;311&quot;</span>], freq[<span class="st">&quot;313&quot;</span>], freq[<span class="st">&quot;331&quot;</span>], freq[<span class="st">&quot;333&quot;</span>])</a>
<a class="sourceLine" id="cb19-123" data-line-number="123"><span class="kw">names</span>(freq.<span class="dv">03</span>.<span class="fl">15.18</span>) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;111&quot;</span>, <span class="st">&quot;113&quot;</span>, <span class="st">&quot;131&quot;</span>, <span class="st">&quot;133&quot;</span>, <span class="st">&quot;311&quot;</span>, <span class="st">&quot;313&quot;</span>, <span class="st">&quot;331&quot;</span>, <span class="st">&quot;333&quot;</span>); freq.<span class="dv">03</span>.<span class="fl">15.18</span>[<span class="kw">is.na</span>(freq.<span class="dv">03</span>.<span class="fl">15.18</span>)] &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb19-124" data-line-number="124"></a>
<a class="sourceLine" id="cb19-125" data-line-number="125">freq.<span class="fl">03.18</span>        &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">sum</span>(freq[<span class="st">&quot;111&quot;</span>],freq[<span class="st">&quot;131&quot;</span>], <span class="dt">na.rm=</span>T), <span class="kw">sum</span>(freq[<span class="st">&quot;113&quot;</span>],freq[<span class="st">&quot;133&quot;</span>], <span class="dt">na.rm=</span>T),</a>
<a class="sourceLine" id="cb19-126" data-line-number="126">                       <span class="kw">sum</span>(freq[<span class="st">&quot;311&quot;</span>],freq[<span class="st">&quot;331&quot;</span>], <span class="dt">na.rm=</span>T), <span class="kw">sum</span>(freq[<span class="st">&quot;313&quot;</span>],freq[<span class="st">&quot;333&quot;</span>], <span class="dt">na.rm=</span>T))</a>
<a class="sourceLine" id="cb19-127" data-line-number="127"><span class="kw">names</span>(freq.<span class="fl">03.18</span>) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;11&quot;</span>, <span class="st">&quot;13&quot;</span>, <span class="st">&quot;31&quot;</span>, <span class="st">&quot;33&quot;</span>); freq.<span class="fl">03.18</span>[<span class="kw">is.na</span>(freq.<span class="fl">03.18</span>)] &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb19-128" data-line-number="128"></a>
<a class="sourceLine" id="cb19-129" data-line-number="129">freq.<span class="fl">03.15</span>        &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">sum</span>(freq[<span class="st">&quot;111&quot;</span>],freq[<span class="st">&quot;113&quot;</span>], <span class="dt">na.rm=</span>T), <span class="kw">sum</span>(freq[<span class="st">&quot;131&quot;</span>],freq[<span class="st">&quot;133&quot;</span>], <span class="dt">na.rm=</span>T),</a>
<a class="sourceLine" id="cb19-130" data-line-number="130">                       <span class="kw">sum</span>(freq[<span class="st">&quot;311&quot;</span>],freq[<span class="st">&quot;313&quot;</span>], <span class="dt">na.rm=</span>T), <span class="kw">sum</span>(freq[<span class="st">&quot;331&quot;</span>],freq[<span class="st">&quot;333&quot;</span>], <span class="dt">na.rm=</span>T))</a>
<a class="sourceLine" id="cb19-131" data-line-number="131"><span class="kw">names</span>(freq.<span class="fl">03.15</span>) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;11&quot;</span>, <span class="st">&quot;13&quot;</span>, <span class="st">&quot;31&quot;</span>, <span class="st">&quot;33&quot;</span>); freq.<span class="fl">03.15</span>[<span class="kw">is.na</span>(freq.<span class="fl">03.15</span>)] &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb19-132" data-line-number="132"></a>
<a class="sourceLine" id="cb19-133" data-line-number="133">freq.<span class="fl">15.18</span>        &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">sum</span>(freq[<span class="st">&quot;111&quot;</span>],freq[<span class="st">&quot;311&quot;</span>], <span class="dt">na.rm=</span>T), <span class="kw">sum</span>(freq[<span class="st">&quot;113&quot;</span>],freq[<span class="st">&quot;313&quot;</span>], <span class="dt">na.rm=</span>T),</a>
<a class="sourceLine" id="cb19-134" data-line-number="134">                       <span class="kw">sum</span>(freq[<span class="st">&quot;131&quot;</span>],freq[<span class="st">&quot;331&quot;</span>], <span class="dt">na.rm=</span>T), <span class="kw">sum</span>(freq[<span class="st">&quot;133&quot;</span>],freq[<span class="st">&quot;333&quot;</span>], <span class="dt">na.rm=</span>T))</a>
<a class="sourceLine" id="cb19-135" data-line-number="135"><span class="kw">names</span>(freq.<span class="fl">15.18</span>) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;11&quot;</span>, <span class="st">&quot;13&quot;</span>, <span class="st">&quot;31&quot;</span>, <span class="st">&quot;33&quot;</span>); freq.<span class="fl">15.18</span>[<span class="kw">is.na</span>(freq.<span class="fl">15.18</span>)] &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb19-136" data-line-number="136"></a>
<a class="sourceLine" id="cb19-137" data-line-number="137">freq<span class="fl">.03</span>           &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">sum</span>(freq[<span class="st">&quot;111&quot;</span>],freq[<span class="st">&quot;131&quot;</span>], freq[<span class="st">&quot;113&quot;</span>],freq[<span class="st">&quot;133&quot;</span>], <span class="dt">na.rm=</span>T),</a>
<a class="sourceLine" id="cb19-138" data-line-number="138">                       <span class="kw">sum</span>(freq[<span class="st">&quot;311&quot;</span>],freq[<span class="st">&quot;331&quot;</span>], freq[<span class="st">&quot;313&quot;</span>],freq[<span class="st">&quot;333&quot;</span>], <span class="dt">na.rm=</span>T))</a>
<a class="sourceLine" id="cb19-139" data-line-number="139"><span class="kw">names</span>(freq<span class="fl">.03</span>)    &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;3&quot;</span>); freq<span class="fl">.03</span>[<span class="kw">is.na</span>(freq<span class="fl">.03</span>)] &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb19-140" data-line-number="140">  </a>
<a class="sourceLine" id="cb19-141" data-line-number="141">freq<span class="fl">.15</span>           &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">sum</span>(freq[<span class="st">&quot;111&quot;</span>],freq[<span class="st">&quot;311&quot;</span>], freq[<span class="st">&quot;113&quot;</span>],freq[<span class="st">&quot;313&quot;</span>], <span class="dt">na.rm=</span>T),</a>
<a class="sourceLine" id="cb19-142" data-line-number="142">                       <span class="kw">sum</span>(freq[<span class="st">&quot;131&quot;</span>],freq[<span class="st">&quot;331&quot;</span>], freq[<span class="st">&quot;133&quot;</span>],freq[<span class="st">&quot;333&quot;</span>], <span class="dt">na.rm=</span>T))</a>
<a class="sourceLine" id="cb19-143" data-line-number="143"><span class="kw">names</span>(freq<span class="fl">.15</span>)    &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;3&quot;</span>); freq<span class="fl">.15</span>[<span class="kw">is.na</span>(freq<span class="fl">.15</span>)] &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb19-144" data-line-number="144"></a>
<a class="sourceLine" id="cb19-145" data-line-number="145">freq<span class="fl">.18</span>           &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">sum</span>(freq[<span class="st">&quot;111&quot;</span>],freq[<span class="st">&quot;311&quot;</span>], freq[<span class="st">&quot;131&quot;</span>],freq[<span class="st">&quot;331&quot;</span>], <span class="dt">na.rm=</span>T),</a>
<a class="sourceLine" id="cb19-146" data-line-number="146">                       <span class="kw">sum</span>(freq[<span class="st">&quot;113&quot;</span>],freq[<span class="st">&quot;313&quot;</span>], freq[<span class="st">&quot;133&quot;</span>],freq[<span class="st">&quot;333&quot;</span>], <span class="dt">na.rm=</span>T))</a>
<a class="sourceLine" id="cb19-147" data-line-number="147"><span class="kw">names</span>(freq<span class="fl">.18</span>)    &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;3&quot;</span>); freq<span class="fl">.18</span>[<span class="kw">is.na</span>(freq<span class="fl">.18</span>)] &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb19-148" data-line-number="148"></a>
<a class="sourceLine" id="cb19-149" data-line-number="149"><span class="co"># create accuracy maps ------------------------------------</span></a>
<a class="sourceLine" id="cb19-150" data-line-number="150"></a>
<a class="sourceLine" id="cb19-151" data-line-number="151"><span class="kw">accuracy.estimate</span>(freq<span class="fl">.18</span>, ct<span class="op">$</span>MAP_VAL<span class="fl">.18</span>c<span class="op">$</span>table , <span class="dt">filename=</span><span class="kw">paste0</span>(FCC.VAL.DIR, <span class="st">&quot;/&quot;</span>, VALSET, <span class="st">&quot;_Acc_18.xlsx&quot;</span>))</a>
<a class="sourceLine" id="cb19-152" data-line-number="152"><span class="kw">accuracy.estimate</span>(freq<span class="fl">.15</span>, ct<span class="op">$</span>MAP_VAL<span class="fl">.15</span>c<span class="op">$</span>table , <span class="dt">filename=</span><span class="kw">paste0</span>(FCC.VAL.DIR, <span class="st">&quot;/&quot;</span>, VALSET, <span class="st">&quot;_Acc_15.xlsx&quot;</span>))</a>
<a class="sourceLine" id="cb19-153" data-line-number="153"><span class="kw">accuracy.estimate</span>(freq<span class="fl">.03</span>, ct<span class="op">$</span>MAP_VAL<span class="fl">.03</span>c<span class="op">$</span>table , <span class="dt">filename=</span><span class="kw">paste0</span>(FCC.VAL.DIR, <span class="st">&quot;/&quot;</span>, VALSET, <span class="st">&quot;_Acc_03.xlsx&quot;</span>))</a>
<a class="sourceLine" id="cb19-154" data-line-number="154"></a>
<a class="sourceLine" id="cb19-155" data-line-number="155"><span class="kw">accuracy.estimate</span>(freq.<span class="fl">03.15</span>, ct<span class="op">$</span>MAP_VAL.<span class="fl">03.15</span>c<span class="op">$</span>table , <span class="dt">filename=</span><span class="kw">paste0</span>(FCC.VAL.DIR, <span class="st">&quot;/&quot;</span>, VALSET, <span class="st">&quot;_Acc_03-15.xlsx&quot;</span>))</a>
<a class="sourceLine" id="cb19-156" data-line-number="156"><span class="kw">accuracy.estimate</span>(freq.<span class="fl">15.18</span>, ct<span class="op">$</span>MAP_VAL.<span class="fl">15.18</span>c<span class="op">$</span>table , <span class="dt">filename=</span><span class="kw">paste0</span>(FCC.VAL.DIR, <span class="st">&quot;/&quot;</span>, VALSET, <span class="st">&quot;_Acc_15-18.xlsx&quot;</span>))</a>
<a class="sourceLine" id="cb19-157" data-line-number="157"><span class="kw">accuracy.estimate</span>(freq.<span class="fl">03.18</span>, ct<span class="op">$</span>MAP_VAL.<span class="fl">03.18</span>c<span class="op">$</span>table , <span class="dt">filename=</span><span class="kw">paste0</span>(FCC.VAL.DIR, <span class="st">&quot;/&quot;</span>, VALSET, <span class="st">&quot;_Acc_03-18.xlsx&quot;</span>))</a>
<a class="sourceLine" id="cb19-158" data-line-number="158"></a>
<a class="sourceLine" id="cb19-159" data-line-number="159"><span class="kw">accuracy.estimate</span>(freq.<span class="dv">03</span>.<span class="fl">15.18</span>, ct<span class="op">$</span>MAP_VAL.<span class="dv">03</span>.<span class="fl">15.18</span>c<span class="op">$</span>table , <span class="dt">filename=</span><span class="kw">paste0</span>(FCC.VAL.DIR, <span class="st">&quot;/&quot;</span>, VALSET, <span class="st">&quot;_Acc_03-15-18.xlsx&quot;</span>))</a>
<a class="sourceLine" id="cb19-160" data-line-number="160"></a>
<a class="sourceLine" id="cb19-161" data-line-number="161"><span class="co"># calculate forest cover, loss and gains ---------------------</span></a>
<a class="sourceLine" id="cb19-162" data-line-number="162"></a>
<a class="sourceLine" id="cb19-163" data-line-number="163">res &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">year     =</span> <span class="kw">c</span>(<span class="dv">2003</span>,         <span class="dv">2015</span>,             <span class="dv">2018</span>),</a>
<a class="sourceLine" id="cb19-164" data-line-number="164">                  <span class="dt">total.ha =</span> <span class="kw">c</span>(freq<span class="fl">.03</span>[<span class="st">&quot;1&quot;</span>], freq<span class="fl">.15</span>[<span class="st">&quot;1&quot;</span>],     freq<span class="fl">.18</span>[<span class="st">&quot;1&quot;</span>])     <span class="op">*</span><span class="st"> </span><span class="dv">30</span><span class="op">^</span><span class="dv">2</span><span class="op">/</span><span class="dv">10000</span>,</a>
<a class="sourceLine" id="cb19-165" data-line-number="165">                  <span class="dt">defor.ha =</span> <span class="kw">c</span>(<span class="ot">NA</span>,           freq.<span class="fl">03.15</span>[<span class="st">&quot;13&quot;</span>], freq.<span class="fl">15.18</span>[<span class="st">&quot;13&quot;</span>]) <span class="op">*</span><span class="st"> </span><span class="dv">30</span><span class="op">^</span><span class="dv">2</span><span class="op">/</span><span class="dv">10000</span>,</a>
<a class="sourceLine" id="cb19-166" data-line-number="166">                  <span class="dt">regen.ha =</span> <span class="kw">c</span>(<span class="ot">NA</span>,           freq.<span class="fl">03.15</span>[<span class="st">&quot;31&quot;</span>], freq.<span class="fl">15.18</span>[<span class="st">&quot;31&quot;</span>]) <span class="op">*</span><span class="st"> </span><span class="dv">30</span><span class="op">^</span><span class="dv">2</span><span class="op">/</span><span class="dv">10000</span>)</a>
<a class="sourceLine" id="cb19-167" data-line-number="167">                  </a>
<a class="sourceLine" id="cb19-168" data-line-number="168"></a>
<a class="sourceLine" id="cb19-169" data-line-number="169"></a>
<a class="sourceLine" id="cb19-170" data-line-number="170"></a>
<a class="sourceLine" id="cb19-171" data-line-number="171"><span class="co"># Example from Olofsson et al. (2014)</span></a>
<a class="sourceLine" id="cb19-172" data-line-number="172"><span class="co"># -----------------------------------</span></a>
<a class="sourceLine" id="cb19-173" data-line-number="173"><span class="co"># ct &lt;- matrix(data=c(66,  0,   5,   4,</span></a>
<a class="sourceLine" id="cb19-174" data-line-number="174"><span class="co">#                     0, 55,   8,  12,</span></a>
<a class="sourceLine" id="cb19-175" data-line-number="175"><span class="co">#                     1,  0, 153,  11,</span></a>
<a class="sourceLine" id="cb19-176" data-line-number="176"><span class="co">#                     2,  1,   9, 313),</span></a>
<a class="sourceLine" id="cb19-177" data-line-number="177"><span class="co">#              nrow=4,</span></a>
<a class="sourceLine" id="cb19-178" data-line-number="178"><span class="co">#              byrow=TRUE,</span></a>
<a class="sourceLine" id="cb19-179" data-line-number="179"><span class="co">#              dimnames = list(Prediction=c(&quot;FN&quot;, &quot;NF&quot;, &quot;FF&quot;, &quot;NN&quot;), Reference=c(&quot;FN&quot;, &quot;NF&quot;, &quot;FF&quot;, &quot;NN&quot;)))</span></a>
<a class="sourceLine" id="cb19-180" data-line-number="180"><span class="co"># </span></a>
<a class="sourceLine" id="cb19-181" data-line-number="181"><span class="co"># px &lt;- c(FN=200000, NF=150000, FF=3200000, NN=6450000)</span></a>
<a class="sourceLine" id="cb19-182" data-line-number="182"><span class="co"># </span></a>
<a class="sourceLine" id="cb19-183" data-line-number="183"><span class="co"># accuracy.estimate(px, ct)</span></a></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="03_validate-FC-maps.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="05_analyse-FC-maps.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"search": true,
"info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
