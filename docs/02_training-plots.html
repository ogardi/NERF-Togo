<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2.2.2 Parcelles d’entraînement | SNSF-Togo_Manuel.utf8</title>
  <meta name="description" content="République Togolaise —<br />
Système Nationale de Surveillance des Forêts</div>" />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="2.2.2 Parcelles d’entraînement | SNSF-Togo_Manuel.utf8" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://ogardi.github.io/SNSF-Togo" />
  <meta property="og:image" content="https://ogardi.github.io/SNSF-Togoimages/NERF-Togo.png" />
  
  <meta name="github-repo" content="ogardi/NERF-Togo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2.2.2 Parcelles d’entraînement | SNSF-Togo_Manuel.utf8" />
  
  
  <meta name="twitter:image" content="https://ogardi.github.io/SNSF-Togoimages/NERF-Togo.png" />

<meta name="author" content="Oliver Gardi, Fifonsi Dangbo, Sophie Dzigbod, Ditorgue Bakabima" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="01_sampling-grid.html"/>
<link rel="next" href="03_validation-plots.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/kePrint-0.0.1/kePrint.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { background-color: #f8f8f8; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://ogardi.github.io/SNSF-Togo"><b>Manuel SNSF Togo</b><br>NRF v1.1 ( <i>en révision</i> )</a></li>
<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Préface</a></li>
<li class="chapter" data-level="1" data-path="00_introduction.html"><a href="00_introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="01_arrangements.html"><a href="01_arrangements.html"><i class="fa fa-check"></i><b>1.1</b> Arrangements institutionelles</a></li>
<li class="chapter" data-level="1.2" data-path="02_how-to.html"><a href="02_how-to.html"><i class="fa fa-check"></i><b>1.2</b> Pour commencer</a><ul>
<li class="chapter" data-level="1.2.1" data-path="02_how-to.html"><a href="02_how-to.html#travailler-avec-le-snsf"><i class="fa fa-check"></i><b>1.2.1</b> Travailler avec le SNSF</a></li>
<li class="chapter" data-level="1.2.2" data-path="03_commencer.html"><a href="03_commencer.html"><i class="fa fa-check"></i><b>1.2.2</b> Structure du répértoire</a></li>
<li class="chapter" data-level="1.2.3" data-path="03_commencer.html"><a href="03_commencer.html#creation-dun-nouveau-projet"><i class="fa fa-check"></i><b>1.2.3</b> Création d’un nouveau projet</a></li>
<li class="chapter" data-level="1.2.4" data-path="03_commencer.html"><a href="03_commencer.html#NRF-set-up.R"><i class="fa fa-check"></i><b>1.2.4</b> Définition des variables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="00_STSS.html"><a href="00_STSS.html"><i class="fa fa-check"></i><b>2</b> Système de Surveillance Terrestre</a><ul>
<li class="chapter" data-level="2.1" data-path="01_Landsat.html"><a href="01_Landsat.html"><i class="fa fa-check"></i><b>2.1</b> Données de base</a><ul>
<li class="chapter" data-level="2.1.1" data-path="01_Landsat.html"><a href="01_Landsat.html#SSTS-Landsat"><i class="fa fa-check"></i><b>2.1.1</b> Images Landsat</a></li>
<li class="chapter" data-level="2.1.2" data-path="02_Worldclim.html"><a href="02_Worldclim.html"><i class="fa fa-check"></i><b>2.1.2</b> WorldClim</a></li>
<li class="chapter" data-level="2.1.3" data-path="03_SRTM.html"><a href="03_SRTM.html"><i class="fa fa-check"></i><b>2.1.3</b> SRTM</a></li>
<li class="chapter" data-level="2.1.4" data-path="04_SoilGrids.html"><a href="04_SoilGrids.html"><i class="fa fa-check"></i><b>2.1.4</b> SoilGrids</a></li>
<li class="chapter" data-level="2.1.5" data-path="05_ProREDD.html"><a href="05_ProREDD.html"><i class="fa fa-check"></i><b>2.1.5</b> ProREDD</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="01_sampling-grid.html"><a href="01_sampling-grid.html"><i class="fa fa-check"></i><b>2.2</b> Collecte des données</a><ul>
<li class="chapter" data-level="2.2.1" data-path="01_sampling-grid.html"><a href="01_sampling-grid.html#reseau-dechantillonnage"><i class="fa fa-check"></i><b>2.2.1</b> Réseau d’échantillonnage</a></li>
<li class="chapter" data-level="2.2.2" data-path="02_training-plots.html"><a href="02_training-plots.html"><i class="fa fa-check"></i><b>2.2.2</b> Parcelles d’entraînement</a></li>
<li class="chapter" data-level="2.2.3" data-path="03_validation-plots.html"><a href="03_validation-plots.html"><i class="fa fa-check"></i><b>2.2.3</b> Parcelles de validation</a></li>
<li class="chapter" data-level="2.2.4" data-path="04_outil-QGIS.html"><a href="04_outil-QGIS.html"><i class="fa fa-check"></i><b>2.2.4</b> Outil QGIS</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="00_IFN.html"><a href="00_IFN.html"><i class="fa fa-check"></i><b>3</b> Inventaire Forestier National</a><ul>
<li class="chapter" data-level="3.1" data-path="01_IFN-1.html"><a href="01_IFN-1.html"><i class="fa fa-check"></i><b>3.1</b> IFN-1 (2015/16)</a><ul>
<li class="chapter" data-level="3.1.1" data-path="01_IFN-1.html"><a href="01_IFN-1.html#methode"><i class="fa fa-check"></i><b>3.1.1</b> <span>Méthode</span></a></li>
<li class="chapter" data-level="3.1.2" data-path="01_IFN-1.html"><a href="01_IFN-1.html#donnees"><i class="fa fa-check"></i><b>3.1.2</b> Données</a></li>
<li class="chapter" data-level="3.1.3" data-path="01_IFN-1.html"><a href="01_IFN-1.html#resultats"><i class="fa fa-check"></i><b>3.1.3</b> <span>Résultats</span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="00_NRF-MRV.html"><a href="00_NRF-MRV.html"><i class="fa fa-check"></i><b>4</b> Analyses NRF/MRV</a><ul>
<li class="chapter" data-level="4.1" data-path="00_analyse-FCC.html"><a href="00_analyse-FCC.html"><i class="fa fa-check"></i><b>4.1</b> Analyse surfaces forestiers</a><ul>
<li class="chapter" data-level="4.1.1" data-path="01_create-FC-maps.html"><a href="01_create-FC-maps.html"><i class="fa fa-check"></i><b>4.1.1</b> Production des cartes Forêt/Non-Forêt</a></li>
<li class="chapter" data-level="4.1.2" data-path="02_clean-FC-maps.html"><a href="02_clean-FC-maps.html"><i class="fa fa-check"></i><b>4.1.2</b> Nettoyage des cartes brutes</a></li>
<li class="chapter" data-level="4.1.3" data-path="03_validate-FC-maps.html"><a href="03_validate-FC-maps.html"><i class="fa fa-check"></i><b>4.1.3</b> Validation des cartes</a></li>
<li class="chapter" data-level="4.1.4" data-path="04_FC-maps-accuracy.html"><a href="04_FC-maps-accuracy.html"><i class="fa fa-check"></i><b>4.1.4</b> Analyse de la précision</a></li>
<li class="chapter" data-level="4.1.5" data-path="05_analyse-FC-maps.html"><a href="05_analyse-FC-maps.html"><i class="fa fa-check"></i><b>4.1.5</b> Analyse des cartes</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="00_analyse-AGB.html"><a href="00_analyse-AGB.html"><i class="fa fa-check"></i><b>4.2</b> Analyse biomasse aérienne</a><ul>
<li class="chapter" data-level="4.2.1" data-path="01_compile-IFN.html"><a href="01_compile-IFN.html"><i class="fa fa-check"></i><b>4.2.1</b> Analyse des données IFN</a></li>
<li class="chapter" data-level="4.2.2" data-path="02_create-AGB-maps.html"><a href="02_create-AGB-maps.html"><i class="fa fa-check"></i><b>4.2.2</b> Calibration et prédiction</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="00_analyse-ER.html"><a href="00_analyse-ER.html"><i class="fa fa-check"></i><b>4.3</b> Analyse émissions/séquestrations</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/ogardi/SNSF-Togo">Dépôt du code sur GitHub</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><div class="line-block">République Togolaise —<br />
Système Nationale de Surveillance des Forêts</div></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="SSTS-training-plots" class="section level3">
<h3><span class="header-section-number">2.2.2</span> Parcelles d’entraînement</h3>
<div id="echantillonnage" class="section level4">
<h4><span class="header-section-number">2.2.2.1</span> Échantillonnage</h4>
<p>Les parcelles d’entraînement sont sélectionnées de manière à couvrir la plus large gamme possible de couverture végétale sur l’ensemble du territoire du Togo. À cette fin, le <strong>NDVI comme indicateur du couvert végétal</strong> est attribué à tout les points du réseau d’échantillonnage et stratifiées en 10 classes NDVI. Un échantillon aléatoire spatialement équilibré de 1 500 échantillons est ensuite tiré de chaque strate NDVI (generalized random tesselation).</p>
</div>
<div id="SSTS-couverture-houppiers" class="section level4">
<h4><span class="header-section-number">2.2.2.2</span> Couverture des houppiers</h4>
<p>Pour détérminer la couverture des houppiers une <strong>grille de 7 x 7 points</strong> est définit à l’intérieur de chaque parcelles d’échantillonage. Pour chaque point de ce grille, les photo-interprètes détérminent sur base des images de très haute résolution disponible en GoogleEarth, si <strong>le point touche l’houppier d’un arbre ou non</strong>. La couverture des houppiers est en suite détérminé par le nombre des points qui tombent sur un arbre par rapport au nombre total des points (n = 49).</p>
<p><img src="images/SSTS-tree-cover.png" /></p>
<p>L’attribution est fait par les photo-interprètes en QGIS, avec l’image GoogleEarth comme carte de base. La source et la date d’acquistion de l’image GoogleEarth utilisé est également enregistré. Elle est obtenu par GoogleEarth Pro (plugin QGIS <a href="https://plugins.qgis.org/plugins/send2google_earth/"><code>send2google_earth</code></a>).</p>
</div>
<div id="script-r-01_ssts02_bdd_srccreate-train-plots.r" class="section level4 unnumbered">
<h4>Script R: <code>01_SSTS/02_BdD/_src/create-train-plots.R</code></h4>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="co">###############################################################################</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="co"># create-train-plots.R: Créer un ensemble de parcelles d&#39;entraînement</span></a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="co"># -----------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="co"># Bern University of Applied Sciences</span></a>
<a class="sourceLine" id="cb13-5" data-line-number="5"><span class="co"># Oliver Gardi, &lt;oliver.gardi@bfh.ch&gt;</span></a>
<a class="sourceLine" id="cb13-6" data-line-number="6"><span class="co"># 13 Mai 2020</span></a>
<a class="sourceLine" id="cb13-7" data-line-number="7"></a>
<a class="sourceLine" id="cb13-8" data-line-number="8"><span class="co"># Préparation des variables ===================================================</span></a>
<a class="sourceLine" id="cb13-9" data-line-number="9"></a>
<a class="sourceLine" id="cb13-10" data-line-number="10">OUT.DIR &lt;-<span class="st"> </span><span class="kw">paste0</span>(DIR.SST.BDD, <span class="st">&quot;/02_train-plots/empty&quot;</span>)</a>
<a class="sourceLine" id="cb13-11" data-line-number="11"><span class="cf">if</span>(<span class="op">!</span><span class="kw">dir.exists</span>(OUT.DIR)) <span class="kw">dir.create</span>(OUT.DIR, <span class="dt">recursive=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb13-12" data-line-number="12"></a>
<a class="sourceLine" id="cb13-13" data-line-number="13"><span class="co"># Charger la grille d&#39;échantillonnage du SSTS</span></a>
<a class="sourceLine" id="cb13-14" data-line-number="14">frame.points &lt;-<span class="st"> </span><span class="kw">readOGR</span>(<span class="kw">paste0</span>(DIR.SST.BDD, <span class="st">&quot;/01_reseau-SSTS/TGO_frame_480m.shp&quot;</span>))</a>
<a class="sourceLine" id="cb13-15" data-line-number="15"></a>
<a class="sourceLine" id="cb13-16" data-line-number="16"><span class="co"># Charger NDVI 2018 masquée (sans nuages, ombre, ...)</span></a>
<a class="sourceLine" id="cb13-17" data-line-number="17">ndvi.band &lt;-<span class="st"> </span><span class="kw">which</span>(SST.LSBANDS <span class="op">==</span><span class="st"> &quot;ndvi&quot;</span>)</a>
<a class="sourceLine" id="cb13-18" data-line-number="18">ndvi &lt;-<span class="st"> </span><span class="kw">merge</span>(<span class="kw">raster</span>(<span class="kw">paste0</span>(DIR.SST.DAT, <span class="st">&quot;/Landsat/p192/p192_2018_m.tif&quot;</span>), <span class="dt">band=</span>ndvi.band), </a>
<a class="sourceLine" id="cb13-19" data-line-number="19">              <span class="kw">raster</span>(<span class="kw">paste0</span>(DIR.SST.DAT, <span class="st">&quot;/Landsat/p193/p193_2018_m.tif&quot;</span>), <span class="dt">band=</span>ndvi.band),</a>
<a class="sourceLine" id="cb13-20" data-line-number="20">              <span class="kw">raster</span>(<span class="kw">paste0</span>(DIR.SST.DAT, <span class="st">&quot;/Landsat/p194/p194_2018_m.tif&quot;</span>), <span class="dt">band=</span>ndvi.band))</a>
<a class="sourceLine" id="cb13-21" data-line-number="21">  </a>
<a class="sourceLine" id="cb13-22" data-line-number="22"><span class="co"># Extraire le NDVI pour chaque parcelle et le découper en 10 strates</span></a>
<a class="sourceLine" id="cb13-23" data-line-number="23">frame.points<span class="op">$</span>ndvi   &lt;-<span class="st"> </span>raster<span class="op">::</span><span class="kw">extract</span>(ndvi, frame.points)</a>
<a class="sourceLine" id="cb13-24" data-line-number="24">frame.points<span class="op">$</span>ndvi_c &lt;-<span class="st"> </span><span class="kw">cut</span>(frame.points<span class="op">$</span>ndvi, <span class="dv">10</span>, <span class="dt">labels=</span><span class="kw">paste0</span>(<span class="st">&quot;s&quot;</span>, <span class="dv">0</span><span class="op">:</span><span class="dv">9</span>))</a>
<a class="sourceLine" id="cb13-25" data-line-number="25"></a>
<a class="sourceLine" id="cb13-26" data-line-number="26"></a>
<a class="sourceLine" id="cb13-27" data-line-number="27"><span class="co"># Echantillonnage des parcelles d&#39;entraînement ================================</span></a>
<a class="sourceLine" id="cb13-28" data-line-number="28"></a>
<a class="sourceLine" id="cb13-29" data-line-number="29"><span class="co"># Initialiser le générateur de nombres aléatoires</span></a>
<a class="sourceLine" id="cb13-30" data-line-number="30"><span class="kw">set.seed</span>(RSEED)</a>
<a class="sourceLine" id="cb13-31" data-line-number="31"></a>
<a class="sourceLine" id="cb13-32" data-line-number="32"><span class="co"># Définition d&#39;échantillonnage (1500 échantillons par strate NDVI s0 - s9)</span></a>
<a class="sourceLine" id="cb13-33" data-line-number="33">Dsgn.grt &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;s0&quot;</span>=<span class="kw">list</span>(<span class="dt">panel=</span><span class="kw">c</span>(<span class="dt">PanelOne=</span><span class="dv">1500</span>), <span class="dt">seltype=</span><span class="st">&quot;Equal&quot;</span>),</a>
<a class="sourceLine" id="cb13-34" data-line-number="34">                 <span class="st">&quot;s1&quot;</span>=<span class="kw">list</span>(<span class="dt">panel=</span><span class="kw">c</span>(<span class="dt">PanelOne=</span><span class="dv">1500</span>), <span class="dt">seltype=</span><span class="st">&quot;Equal&quot;</span>),</a>
<a class="sourceLine" id="cb13-35" data-line-number="35">                 <span class="st">&quot;s2&quot;</span>=<span class="kw">list</span>(<span class="dt">panel=</span><span class="kw">c</span>(<span class="dt">PanelOne=</span><span class="dv">1500</span>), <span class="dt">seltype=</span><span class="st">&quot;Equal&quot;</span>),</a>
<a class="sourceLine" id="cb13-36" data-line-number="36">                 <span class="st">&quot;s3&quot;</span>=<span class="kw">list</span>(<span class="dt">panel=</span><span class="kw">c</span>(<span class="dt">PanelOne=</span><span class="dv">1500</span>), <span class="dt">seltype=</span><span class="st">&quot;Equal&quot;</span>),</a>
<a class="sourceLine" id="cb13-37" data-line-number="37">                 <span class="st">&quot;s4&quot;</span>=<span class="kw">list</span>(<span class="dt">panel=</span><span class="kw">c</span>(<span class="dt">PanelOne=</span><span class="dv">1500</span>), <span class="dt">seltype=</span><span class="st">&quot;Equal&quot;</span>),</a>
<a class="sourceLine" id="cb13-38" data-line-number="38">                 <span class="st">&quot;s5&quot;</span>=<span class="kw">list</span>(<span class="dt">panel=</span><span class="kw">c</span>(<span class="dt">PanelOne=</span><span class="dv">1500</span>), <span class="dt">seltype=</span><span class="st">&quot;Equal&quot;</span>),</a>
<a class="sourceLine" id="cb13-39" data-line-number="39">                 <span class="st">&quot;s6&quot;</span>=<span class="kw">list</span>(<span class="dt">panel=</span><span class="kw">c</span>(<span class="dt">PanelOne=</span><span class="dv">1500</span>), <span class="dt">seltype=</span><span class="st">&quot;Equal&quot;</span>),</a>
<a class="sourceLine" id="cb13-40" data-line-number="40">                 <span class="st">&quot;s7&quot;</span>=<span class="kw">list</span>(<span class="dt">panel=</span><span class="kw">c</span>(<span class="dt">PanelOne=</span><span class="dv">1500</span>), <span class="dt">seltype=</span><span class="st">&quot;Equal&quot;</span>),</a>
<a class="sourceLine" id="cb13-41" data-line-number="41">                 <span class="st">&quot;s8&quot;</span>=<span class="kw">list</span>(<span class="dt">panel=</span><span class="kw">c</span>(<span class="dt">PanelOne=</span><span class="dv">1500</span>), <span class="dt">seltype=</span><span class="st">&quot;Equal&quot;</span>),</a>
<a class="sourceLine" id="cb13-42" data-line-number="42">                 <span class="st">&quot;s9&quot;</span>=<span class="kw">list</span>(<span class="dt">panel=</span><span class="kw">c</span>(<span class="dt">PanelOne=</span><span class="dv">1500</span>), <span class="dt">seltype=</span><span class="st">&quot;Equal&quot;</span>)</a>
<a class="sourceLine" id="cb13-43" data-line-number="43">)</a>
<a class="sourceLine" id="cb13-44" data-line-number="44"></a>
<a class="sourceLine" id="cb13-45" data-line-number="45"><span class="co"># Échantillonnage spatialement équilibrée (Generalized Random Tesselation)</span></a>
<a class="sourceLine" id="cb13-46" data-line-number="46">train.points &lt;-<span class="st"> </span><span class="kw">grts</span>(<span class="dt">sp.object=</span>frame.points,  <span class="co"># grille d&#39;échantillonnage</span></a>
<a class="sourceLine" id="cb13-47" data-line-number="47">                     <span class="dt">src.frame=</span><span class="st">&quot;sp.object&quot;</span>,   <span class="co"># type de grille (objet spatiale)</span></a>
<a class="sourceLine" id="cb13-48" data-line-number="48">                     <span class="dt">design=</span>Dsgn.grt,         <span class="co"># définition d&#39;échantillonnage</span></a>
<a class="sourceLine" id="cb13-49" data-line-number="49">                     <span class="dt">stratum=</span><span class="st">&quot;ndvi_c&quot;</span>,        <span class="co"># colonne avec strate</span></a>
<a class="sourceLine" id="cb13-50" data-line-number="50">                     <span class="dt">type.frame=</span><span class="st">&quot;finite&quot;</span>,     <span class="co"># type d&#39;échantillonnage</span></a>
<a class="sourceLine" id="cb13-51" data-line-number="51">                     <span class="dt">DesignID=</span><span class="st">&quot;train&quot;</span>         <span class="co"># préfixe pour chaque point</span></a>
<a class="sourceLine" id="cb13-52" data-line-number="52">)</a>
<a class="sourceLine" id="cb13-53" data-line-number="53"></a>
<a class="sourceLine" id="cb13-54" data-line-number="54"><span class="co"># Appliquer le système de référence des coordonnées </span></a>
<a class="sourceLine" id="cb13-55" data-line-number="55"><span class="kw">proj4string</span>(train.points) &lt;-<span class="st"> </span><span class="kw">proj4string</span>(frame.points)</a>
<a class="sourceLine" id="cb13-56" data-line-number="56"></a>
<a class="sourceLine" id="cb13-57" data-line-number="57"><span class="co"># Mélanger les points d&#39;entraînement et ajouter un identifiant</span></a>
<a class="sourceLine" id="cb13-58" data-line-number="58">train.points &lt;-<span class="st"> </span>train.points[<span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(train.points)), ]</a>
<a class="sourceLine" id="cb13-59" data-line-number="59">train.points<span class="op">$</span>SAMPLEID &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;trn-&quot;</span>, <span class="kw">str_pad</span>(<span class="dt">string=</span><span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(train.points), </a>
<a class="sourceLine" id="cb13-60" data-line-number="60">                                                <span class="dt">width =</span> <span class="dv">4</span>, </a>
<a class="sourceLine" id="cb13-61" data-line-number="61">                                                <span class="dt">pad =</span> <span class="st">&quot;0&quot;</span>, </a>
<a class="sourceLine" id="cb13-62" data-line-number="62">                                                <span class="dt">side =</span> <span class="st">&quot;left&quot;</span>))</a>
<a class="sourceLine" id="cb13-63" data-line-number="63"></a>
<a class="sourceLine" id="cb13-64" data-line-number="64"></a>
<a class="sourceLine" id="cb13-65" data-line-number="65"><span class="co"># Conversion des points en parcelles et ajouter des attributs =================</span></a>
<a class="sourceLine" id="cb13-66" data-line-number="66"></a>
<a class="sourceLine" id="cb13-67" data-line-number="67"><span class="co"># Grille Landsat</span></a>
<a class="sourceLine" id="cb13-68" data-line-number="68">landsat.grid &lt;-<span class="st"> </span><span class="kw">raster</span>(ndvi)</a>
<a class="sourceLine" id="cb13-69" data-line-number="69"><span class="kw">values</span>(landsat.grid) &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb13-70" data-line-number="70"></a>
<a class="sourceLine" id="cb13-71" data-line-number="71"><span class="co"># Selectionner les pixels Landsat correspondantes et convertir en polygone</span></a>
<a class="sourceLine" id="cb13-72" data-line-number="72">train.plots &lt;-<span class="st"> </span><span class="kw">rasterToPolygons</span>(<span class="kw">mask</span>(landsat.grid, train.points))</a>
<a class="sourceLine" id="cb13-73" data-line-number="73"></a>
<a class="sourceLine" id="cb13-74" data-line-number="74"><span class="co"># Extraire les attributs des points d&#39;entraînement ...</span></a>
<a class="sourceLine" id="cb13-75" data-line-number="75">train.plots<span class="op">@</span>data &lt;-<span class="st"> </span><span class="kw">over</span>(train.plots, </a>
<a class="sourceLine" id="cb13-76" data-line-number="76">                         train.points[, <span class="kw">c</span>(<span class="st">&quot;PLOTID&quot;</span>, <span class="st">&quot;SAMPLEID&quot;</span>, </a>
<a class="sourceLine" id="cb13-77" data-line-number="77">                                          <span class="st">&quot;xcoords&quot;</span>, <span class="st">&quot;ycoords&quot;</span>, </a>
<a class="sourceLine" id="cb13-78" data-line-number="78">                                          <span class="st">&quot;ndvi&quot;</span>, <span class="st">&quot;stratum&quot;</span>)])</a>
<a class="sourceLine" id="cb13-79" data-line-number="79"></a>
<a class="sourceLine" id="cb13-80" data-line-number="80"><span class="co"># ... et compléter avec autres attributs</span></a>
<a class="sourceLine" id="cb13-81" data-line-number="81">train.plots<span class="op">$</span>ccov                            &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="ot">NA</span>)  <span class="co"># couverture houppiers</span></a>
<a class="sourceLine" id="cb13-82" data-line-number="82">train.plots<span class="op">$</span>img_src &lt;-<span class="st"> </span>train.plots<span class="op">$</span>img_date &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="ot">NA</span>)  <span class="co"># source et date d&#39;image </span></a>
<a class="sourceLine" id="cb13-83" data-line-number="83">train.plots<span class="op">$</span>author  &lt;-<span class="st"> </span>train.plots<span class="op">$</span>mod_date &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="ot">NA</span>)  <span class="co"># auteur et date</span></a>
<a class="sourceLine" id="cb13-84" data-line-number="84"></a>
<a class="sourceLine" id="cb13-85" data-line-number="85"><span class="co"># Sauvegarder parcelles sous format Shapefile et KML</span></a>
<a class="sourceLine" id="cb13-86" data-line-number="86"><span class="kw">writeOGR</span>(train.plots, <span class="dt">dsn=</span>OUT.DIR, <span class="dt">layer=</span><span class="st">&quot;COV_parcelles&quot;</span>, <span class="dt">driver=</span><span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="dt">overwrite=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb13-87" data-line-number="87"><span class="kw">writeKML</span>(train.plots, <span class="dt">kmlname=</span><span class="st">&quot;COV_parcelles&quot;</span>, <span class="dt">filename=</span><span class="kw">paste0</span>(OUT.DIR, <span class="st">&quot;/COV_parcelles.kml&quot;</span>))</a>
<a class="sourceLine" id="cb13-88" data-line-number="88"></a>
<a class="sourceLine" id="cb13-89" data-line-number="89"></a>
<a class="sourceLine" id="cb13-90" data-line-number="90"><span class="co"># Créer une grille d&#39;échantillon 7x7 dans chaque parcelle =====================</span></a>
<a class="sourceLine" id="cb13-91" data-line-number="91"></a>
<a class="sourceLine" id="cb13-92" data-line-number="92"><span class="co"># Détérminer la grille</span></a>
<a class="sourceLine" id="cb13-93" data-line-number="93">grid.size &lt;-<span class="st"> </span><span class="dv">7</span></a>
<a class="sourceLine" id="cb13-94" data-line-number="94">res &lt;-<span class="st"> </span><span class="kw">res</span>(landsat.grid)[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb13-95" data-line-number="95">offset &lt;-<span class="st"> </span><span class="kw">c</span>(res<span class="op">/</span>grid.size<span class="op">/</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>(<span class="dv">0</span><span class="op">:</span>(grid.size<span class="dv">-1</span>))<span class="op">*</span>res<span class="op">/</span>grid.size)</a>
<a class="sourceLine" id="cb13-96" data-line-number="96"></a>
<a class="sourceLine" id="cb13-97" data-line-number="97"><span class="co"># Diviser les parcelles pour un traitement parallèle</span></a>
<a class="sourceLine" id="cb13-98" data-line-number="98">subsets &lt;-<span class="st"> </span><span class="kw">split</span>(train.plots, <span class="dt">f=</span><span class="dv">1</span><span class="op">:</span>(CORES<span class="dv">-1</span>))</a>
<a class="sourceLine" id="cb13-99" data-line-number="99"><span class="kw">registerDoParallel</span>(CORES<span class="dv">-1</span>)</a>
<a class="sourceLine" id="cb13-100" data-line-number="100">train.grids &lt;-<span class="st"> </span><span class="kw">foreach</span>(<span class="dt">subset=</span>subsets, <span class="dt">.combine=</span>rbind, <span class="dt">.multicombine=</span><span class="ot">TRUE</span>) <span class="op">%dopar%</span><span class="st"> </span>{ </a>
<a class="sourceLine" id="cb13-101" data-line-number="101">  <span class="co"># Créer un couche de points vides ...</span></a>
<a class="sourceLine" id="cb13-102" data-line-number="102">  grids &lt;-<span class="st"> </span><span class="kw">SpatialPointsDataFrame</span>(<span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="dv">0</span>, <span class="dt">y =</span> <span class="dv">0</span>), </a>
<a class="sourceLine" id="cb13-103" data-line-number="103">                                  <span class="dt">data=</span><span class="kw">data.frame</span>(<span class="dt">PLOTID =</span> <span class="dv">0</span>, </a>
<a class="sourceLine" id="cb13-104" data-line-number="104">                                                  <span class="dt">SAMPLEID =</span> <span class="dv">0</span>, </a>
<a class="sourceLine" id="cb13-105" data-line-number="105">                                                  <span class="dt">GRIDPOINT =</span> <span class="dv">0</span>))[<span class="op">-</span><span class="dv">1</span>,]</a>
<a class="sourceLine" id="cb13-106" data-line-number="106">  <span class="co"># ... et ajoute la grille d&#39;échantillon pour chaque parcelle</span></a>
<a class="sourceLine" id="cb13-107" data-line-number="107">  <span class="cf">for</span>(p <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(subset)) {</a>
<a class="sourceLine" id="cb13-108" data-line-number="108">    plot &lt;-<span class="st"> </span>subset[p,]</a>
<a class="sourceLine" id="cb13-109" data-line-number="109">    ext &lt;-<span class="st"> </span><span class="kw">extent</span>(plot)</a>
<a class="sourceLine" id="cb13-110" data-line-number="110">    grids &lt;-<span class="st"> </span><span class="kw">bind</span>(grids, <span class="kw">SpatialPointsDataFrame</span>(<span class="kw">expand.grid</span>(ext<span class="op">@</span>xmin<span class="op">+</span>offset, ext<span class="op">@</span>ymin<span class="op">+</span>offset), </a>
<a class="sourceLine" id="cb13-111" data-line-number="111">                                                <span class="dt">data=</span><span class="kw">data.frame</span>(<span class="dt">PLOTID =</span> plot<span class="op">$</span>PLOTID, </a>
<a class="sourceLine" id="cb13-112" data-line-number="112">                                                                <span class="dt">SAMPLEID =</span> plot<span class="op">$</span>SAMPLEID, </a>
<a class="sourceLine" id="cb13-113" data-line-number="113">                                                                <span class="dt">GRIDPOINT =</span> <span class="dv">1</span><span class="op">:</span>grid.size<span class="op">^</span><span class="dv">2</span>)))</a>
<a class="sourceLine" id="cb13-114" data-line-number="114">  }</a>
<a class="sourceLine" id="cb13-115" data-line-number="115">  grids</a>
<a class="sourceLine" id="cb13-116" data-line-number="116">}</a>
<a class="sourceLine" id="cb13-117" data-line-number="117"></a>
<a class="sourceLine" id="cb13-118" data-line-number="118"><span class="co"># Appliquer le système de référence des coordonnées</span></a>
<a class="sourceLine" id="cb13-119" data-line-number="119"><span class="kw">proj4string</span>(train.grids) &lt;-<span class="st"> </span><span class="kw">proj4string</span>(train.plots)</a>
<a class="sourceLine" id="cb13-120" data-line-number="120"></a>
<a class="sourceLine" id="cb13-121" data-line-number="121"><span class="co"># Ajouter un attribut &quot;arbre&quot; (1: oui, 0: non)</span></a>
<a class="sourceLine" id="cb13-122" data-line-number="122">train.grids<span class="op">$</span>tree &lt;-<span class="st"> </span><span class="kw">as.integer</span>(<span class="ot">NA</span>)</a>
<a class="sourceLine" id="cb13-123" data-line-number="123"></a>
<a class="sourceLine" id="cb13-124" data-line-number="124"><span class="co"># Sauveguarder les grille d&#39;échantillon sous format Shapefile</span></a>
<a class="sourceLine" id="cb13-125" data-line-number="125"><span class="kw">writeOGR</span>(train.grids, <span class="dt">dsn=</span>OUT.DIR, <span class="dt">layer=</span><span class="st">&quot;COV_parcelles_grid&quot;</span>, </a>
<a class="sourceLine" id="cb13-126" data-line-number="126">         <span class="dt">driver=</span><span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="dt">overwrite=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb13-127" data-line-number="127"></a>
<a class="sourceLine" id="cb13-128" data-line-number="128"></a>
<a class="sourceLine" id="cb13-129" data-line-number="129"><span class="co"># Diviser parcelles et grilles d&#39;échantillon en 10 sous-ensembles =============</span></a>
<a class="sourceLine" id="cb13-130" data-line-number="130"><span class="co"># pour le traitement par différents photo-interprètes</span></a>
<a class="sourceLine" id="cb13-131" data-line-number="131"></a>
<a class="sourceLine" id="cb13-132" data-line-number="132">subsets &lt;-<span class="st"> </span><span class="kw">split</span>(train.plots, <span class="dt">f=</span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb13-133" data-line-number="133"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(subsets)) {</a>
<a class="sourceLine" id="cb13-134" data-line-number="134">  <span class="co"># Sauvegarder parcelles sous format Shapefile et KML</span></a>
<a class="sourceLine" id="cb13-135" data-line-number="135">  <span class="kw">writeOGR</span>(subsets[[i]], <span class="dt">dsn=</span>OUT.DIR, <span class="dt">layer=</span><span class="kw">paste0</span>(<span class="st">&quot;COV_parcelles_&quot;</span>, i), </a>
<a class="sourceLine" id="cb13-136" data-line-number="136">           <span class="dt">driver=</span><span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="dt">overwrite=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb13-137" data-line-number="137">  <span class="kw">writeKML</span>(subsets[[i]], <span class="dt">kmlname=</span><span class="kw">paste0</span>(<span class="st">&quot;COV_parcelles_&quot;</span>, i) , </a>
<a class="sourceLine" id="cb13-138" data-line-number="138">           <span class="dt">filename=</span><span class="kw">paste0</span>(OUT.DIR, <span class="st">&quot;/COV_parcelles_&quot;</span>, i, <span class="st">&quot;.kml&quot;</span>))</a>
<a class="sourceLine" id="cb13-139" data-line-number="139">  <span class="co"># Sauvegarder les grilles correspondantes sous format Shapefile</span></a>
<a class="sourceLine" id="cb13-140" data-line-number="140">  subset.grids &lt;-<span class="st"> </span>train.grids[train.grids<span class="op">$</span>PLOTID <span class="op">%in%</span><span class="st"> </span>subsets[[i]]<span class="op">$</span>PLOTID,]</a>
<a class="sourceLine" id="cb13-141" data-line-number="141">  <span class="kw">writeOGR</span>(subset.grids, <span class="dt">dsn=</span>OUT.DIR, <span class="dt">layer=</span><span class="kw">paste0</span>(<span class="st">&quot;COV_parcelles_&quot;</span>, i, <span class="st">&quot;_grid&quot;</span>), </a>
<a class="sourceLine" id="cb13-142" data-line-number="142">           <span class="dt">driver=</span><span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="dt">overwrite=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb13-143" data-line-number="143">}</a></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="01_sampling-grid.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="03_validation-plots.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["SNSF-Togo_Manuel.pdf"],
"toc": {
"collapse": "subsection",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"search": true,
"info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
